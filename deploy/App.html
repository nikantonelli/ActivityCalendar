<!DOCTYPE html>
<html>
<head>
    <title>calendar</title>

    <script type="text/javascript" src="/apps/2.0/sdk-debug.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",items:[{xtype:"container",id:"feedbacktext",html:"Fetching data...."}],rallyTaskStore:null,rallyStoryStore:null,calendarPanel:null,rallyCustomFieldPrefix:"c_",rallyRequiredCustomFields:[{CalName:"StartDate",RallyName:"c_StartDate",Type:"Date"},{CalName:"EndDate",RallyName:"c_EndDate",Type:"Date"},{CalName:"Colour",RallyName:"c_CoachState",Type:"Integer"}],_getRallyName:function(name){return _.result(_.findWhere(this.rallyRequiredCustomFields,{CalName:name}),"RallyName")},launch:function(){var app=this,myCtxt=Rally.environment.getContext(),myProj=myCtxt.getProject();myProj.Children.Count>0&&(app.TeamPresent=!0),Ext.getCmp("feedbacktext").destroy(),app.rallyTaskStore=Ext.data.StoreManager.lookup("eventStorage"),app.rallyTaskStore||(app.rallyTaskStore=Ext.create("Rally.data.wsapi.Store",{storeId:"taskStorage",model:"task",autoLoad:!0,listeners:{load:app._tasksLoaded,scope:app},filters:[{property:"State",operator:"<",value:"Completed"}],fetch:!0}),Ext.util.Observable.capture(app.rallyTaskStore,function(event){console.log("store",event,arguments)}))},_tasksLoaded:function(){var app=this,eventStore=Ext.create("Extensible.calendar.data.EventStore",{storeId:"eventStorage",data:app._convertToEventStore(app,app.rallyTaskStore.getRecords()),model:"Extensible.calendar.data.EventModel",proxy:{type:"memory",storeId:"eventStorage"},autoLoad:!1,listeners:{add:app._newEvent,update:app._updateEvent,scope:app},scope:app});Ext.util.Observable.capture(eventStore,function(event){console.log(event,arguments)}),this._createCalendarStore(this,eventStore)},_newEvent:function(store,records,index,eOpts){_.each(records,function(rec){var rsd=this._getRallyName("StartDate"),red=this._getRallyName("EndDate"),newRecord={Name:rec.get("Title"),WorkProduct:rec.get("CalendarId"),Project:Rally.environment.getContext().getProject()},inst=this.rallyTaskStore.add(newRecord);rec.get("IsAllDay")===!0?(inst[0].set(rsd,Ext.Date.clearTime(rec.get("StartDate"))),inst[0].set(red,Ext.Date.clearTime(rec.get("EndDate")))):(inst[0].set(rsd,rec.get("StartDate")),inst[0].set(red,rec.get("EndDate"))),this.rallyTaskStore.sync().then({success:function(){console.log("Create success",arguments)},failure:function(){console.log("Create failed",arguments)}})},this)},_updateEvent:function(store,rec,oper,modifiedList,eOpts){if(modifiedList){var task=this.rallyTaskStore.findRecord("ObjectID",rec.get("EventId")),rsd=this._getRallyName("StartDate"),red=this._getRallyName("EndDate");task?(_.each(modifiedList,function(fld){switch(fld){case"Title":task.set("Name",rec.get("Title"));break;case"Colour":rec.set("Color",this._lookupTaskColour(rec.get("Colour"),1)),task.set("DisplayColor",this._lookupTaskColour(rec.get("Colour"),2)),task.set(this._getRallyName("Colour"),rec.get("Colour"));break;case"IsAllDay":rec.set("Duration",0),rec.set("StartDate",Ext.Date.clearTime(rec.get("StartDate"))),rec.set("EndDate",Ext.Date.clearTime(rec.get("EndDate"))),task.set(rsd,Ext.Date.clearTime(rec.get("StartDate"))),task.set(red,Ext.Date.clearTime(rec.get("EndDate")));break;case"Notes":task.set("Notes",rec.get("Notes"));break;default:console.log("Unknown Field changed: "+fld)}},this),this.rallyTaskStore.sync().then({success:function(){console.log("Update success",arguments)},failure:function(){console.log("Update failed",arguments)}},this)):console.log("Failed to find event"+rec.get("Title"))}},_removeEvent:function(store,rec,index,isMove,eOpts){var task=this.rallyTaskStore.findRecord("ObjectID",Ext.get(rec).elements[0].get("EventId"));task.destroy().then({success:function(task){console.log("Delete success",arguments)},failure:function(){console.log("Delete failed",arguments)}},this)},_lookupTaskColour:function(colour,mode){var result=null,defaultVal=null,colours=[{value:"#105cab",Title:"No Travel",Colour:1},{value:"#ff1010",Title:"Committed",Colour:2},{value:"#107c1e",Title:"Available",Colour:3},{value:"#4a1d7e",Title:"Sales",Colour:4},{value:"#df1a7b",Title:"Other",Colour:5},{value:"#ee6c19",Title:"Tentative",Colour:6},{value:"#f9a814",Title:"Unused1",Colour:7},{value:"#fce205",Title:"Travel",Colour:8},{value:"#848689",Title:"PTO",Colour:9},{value:"#21a2e0",Title:"Planning",Colour:10},{value:"#202020",Title:"Unavailable",Colour:11}];switch(mode){case 0:result=_.result(_.findWhere(colours,{value:colour}),"Colour"),defaultVal=3;break;case 1:result=_.result(_.findWhere(colours,{Title:colour}),"Colour"),defaultVal=3;break;case 2:result=_.result(_.findWhere(colours,{Title:colour}),"value"),defaultVal="#107c1e";break;case 3:result=_.result(_.findWhere(colours,{Colour:colour}),"Title"),defaultVal="Available";break;default:}return result?result:defaultVal},_lookupStoryColour:function(colourString){var colours=[{value:"#105cab",Title:"Initial Contact",Colour:1},{value:"#21a2e0",Title:"Prospect",Colour:2},{value:"",Title:"Unavailable",Colour:11}];return _.result(_.findWhere(colours,{value:colourString}),"Colour")},_convertToEventStore:function(app,data){var evts=[],rsd=null,red=null;return _.each(data,function(rec){rsd=rec.get(app._getRallyName("StartDate")),red=rec.get(app._getRallyName("EndDate")),!red&!rsd&&Rally.ui.notify.Notifier.showError({message:"Overriding Dates to today for "+rec.get("FormattedID")+": "+rec.get("Name")}),rsd&&!red&&(Rally.ui.notify.Notifier.showWarning({message:"Please set End Date for "+rec.get("FormattedID")+": "+rec.get("Name")}),red=Ext.Date.clone(rsd)),red&&!rsd&&(Rally.ui.notify.Notifier.showWarning({message:"Please set Start Date for "+rec.get("FormattedID")+": "+rec.get("Name")}),rsd=Ext.Date.clone(red)),rsd=rsd?rsd:new Date(Ext.Date.now()),red=red?red:new Date(Ext.Date.now()),evts.push(new Extensible.calendar.data.EventModel({CalendarId:rec.get("WorkProduct")._ref,EventId:rec.get("ObjectID"),Title:rec.get("Name"),StartDate:rsd,EndDate:red,Color:app._lookupTaskColour(rec.get(app._getRallyName("Colour")),1),Colour:rec.get(app._getRallyName("Colour")),Url:Rally.util.Ref.getUrl(rec.get("_ref")),Notes:rec.get("Notes"),IsAllDay:Ext.Date.isEqual(rsd,red)||Ext.Date.getDayOfYear(rsd)!=Ext.Date.getDayOfYear(red)}))}),evts},_createCalendarStore:function(app,eventStore){app.rallyStoryStore=Ext.create("Rally.data.wsapi.Store",{model:"userstory",autoLoad:!0,fetch:!0,filters:[{property:"ScheduleState",operator:"<",value:"Accepted"}],listeners:{load:function(store,data,success){if(success){var cals=[];_.each(data,function(rec){cals.push(new Extensible.calendar.data.CalendarModel({CalendarId:rec.get("_ref"),Title:rec.get("Name"),Description:rec.get("FormattedID"),Notes:rec.get("Description"),Color:app._lookupStoryColour(rec.get("DisplayColor"))}))});var calendarStore=Ext.create("Extensible.calendar.data.MemoryCalendarStore",{data:cals});app.calendarPanel=Ext.create("Extensible.calendar.CalendarPanel",{calendarStore:calendarStore,monitorResize:!0,eventStore:eventStore,id:app.id+"-cal-pnl",title:"Activities",frame:!0,width:1024,height:768}),app.add(app.calendarPanel)}}}}),Ext.util.Observable.capture(app.rallyStoryStore,function(event){console.log("stories",event,arguments)})}});
                Ext.define("Extensible",{singleton:!0,version:"1.6.0-rc.1",versionDetails:{major:1,minor:6,patch:0},extVersion:"4.0.1",hasBorderRadius:Ext.supports.CSS3BorderRadius,log:function(s){},getScrollWidth:function(){return Ext.getScrollbarSize?Ext.getScrollbarSize().width:Ext.getScrollBarWidth()},constructor:function(){Ext.onReady(function(){3>this.getScrollWidth()&&Ext.getBody().addCls("x-no-scrollbar"),Ext.isWindows&&Ext.getBody().addCls("x-win"),Ext.getVersion("extjs").isLessThan("4.1")&&Ext.getBody().addCls("x-4-0")},this)},Date:{use24HourTime:!1,diff:function(start,end,unit){var denom=1,diff=end.getTime()-start.getTime();return"s"===unit||"seconds"===unit?denom=1e3:"m"===unit||"minutes"===unit?denom=6e4:("h"===unit||"hours"===unit)&&(denom=36e5),Math.round(diff/denom)},diffDays:function(start,end){var day=864e5,clear=Ext.Date.clearTime,timezoneOffset=1e3*60*(start.getTimezoneOffset()-end.getTimezoneOffset()),diff=clear(end,!0).getTime()-clear(start,!0).getTime()+timezoneOffset,days=Math.round(diff/day);return days},copyTime:function(fromDt,toDt){var dt=Ext.Date.clone(toDt);return dt.setHours(fromDt.getHours(),fromDt.getMinutes(),fromDt.getSeconds(),fromDt.getMilliseconds()),dt},compare:function(dt1,dt2,precise){var d1=dt1,d2=dt2;return precise!==!0&&(d1=Ext.Date.clone(dt1),d1.setMilliseconds(0),d2=Ext.Date.clone(dt2),d2.setMilliseconds(0)),d2.getTime()-d1.getTime()},maxOrMin:function(max){for(var dt=max?0:Number.MAX_VALUE,i=0,args=arguments[1],ln=args.length;ln>i;i++)dt=Math[max?"max":"min"](dt,args[i].getTime());return new Date(dt)},max:function(){return this.maxOrMin.apply(this,[!0,arguments])},min:function(){return this.maxOrMin.apply(this,[!1,arguments])},isInRange:function(dt,rangeStart,rangeEnd){return dt>=rangeStart&&rangeEnd>=dt},rangesOverlap:function(start1,end1,start2,end2){var startsInRange=start1>=start2&&end2>=start1,endsInRange=end1>=start2&&end2>=end1,spansRange=start2>=start1&&end1>=end2;return startsInRange||endsInRange||spansRange},isWeekend:function(dt){return 0===dt.getDay()%6},isWeekday:function(dt){return 0!==dt.getDay()%6},isMidnight:function(dt){return 0===dt.getHours()&&0===dt.getMinutes()},isToday:function(dt){return 0===this.diffDays(dt,this.today())},today:function(){return Ext.Date.clearTime(new Date)},add:function(dt,o){if(!o)return dt;var ExtDate=Ext.Date,dateAdd=ExtDate.add,newDt=ExtDate.clone(dt);return o.years&&(newDt=dateAdd(newDt,ExtDate.YEAR,o.years)),o.months&&(newDt=dateAdd(newDt,ExtDate.MONTH,o.months)),o.weeks&&(o.days=(o.days||0)+7*o.weeks),o.days&&(newDt=dateAdd(newDt,ExtDate.DAY,o.days)),o.hours&&(newDt=dateAdd(newDt,ExtDate.HOUR,o.hours)),o.minutes&&(newDt=dateAdd(newDt,ExtDate.MINUTE,o.minutes)),o.seconds&&(newDt=dateAdd(newDt,ExtDate.SECOND,o.seconds)),o.millis&&(newDt=dateAdd(newDt,ExtDate.MILLI,o.millis)),o.clearTime?ExtDate.clearTime(newDt):newDt},clearTime:function(dt,clone){return Ext.Date.clearTime(dt,clone)}}}),Ext.require(["Ext.picker.Color","Ext.form.Basic","Ext.data.proxy.Memory"]),Extensible.applyOverrides=function(){var extVersion=Ext.getVersion("extjs");Ext.layout.container.AbstractCard&&Ext.layout.container.AbstractCard.override({renderChildren:function(){this.deferredRender||(this.getActiveItem(),this.callParent())}}),Ext.Component.override({getId:function(){var me=this,xtype;return me.id||(xtype=me.getXType(),xtype=xtype?xtype.replace(/[\.,\s]/g,"-"):"ext-comp",me.id=xtype+"-"+me.getAutoId()),me.id}}),Ext.picker&&Ext.picker.Color&&Ext.picker.Color.override({constructor:function(){this.renderTpl=this.renderTpl||Ext.create("Ext.XTemplate",'<tpl for="colors"><a href="#" class="color-{.}" hidefocus="on"><em><span style="background:#{.}" unselectable="on">&#160;</span></em></a></tpl>'),this.callParent(arguments)}}),extVersion.isLessThan("4.1")&&Ext.data&&Ext.data.reader&&Ext.data.reader.Reader&&Ext.data.reader.Reader.override({extractData:function(root){var me=this,values=[],records=[],Model=me.model,i=0,length=root.length,node,id,record;for(!root.length&&Ext.isObject(root)&&(root=[root],length=1);length>i;i++)node=root[i],values=me.extractValues(node),id=me.getId(values),record=new Model(values,id,node),records.push(record),me.implicitIncludes&&me.readAssociated(record,node);return records}}),Ext.form&&Ext.form.Basic&&Ext.form.Basic.override({reset:function(){var me=this;return me.getFields().each(function(f){f.reset()}),me}}),Ext.data&&Ext.data.proxy&&Ext.data.proxy.Memory&&Ext.data.proxy.Memory.override({updateOperation:function(operation,callback,scope){Ext.each(operation.records,function(rec){rec.commit()}),operation.setCompleted(),operation.setSuccessful(),Ext.callback(callback,scope||this,[operation])},create:function(){this.updateOperation.apply(this,arguments)},update:function(){this.updateOperation.apply(this,arguments)},destroy:function(){this.updateOperation.apply(this,arguments)}}),extVersion.isLessThan("4.1")&&Ext.form&&Ext.form.CheckboxGroup&&Ext.form.CheckboxGroup.override({resetOriginalValue:function(){var me=this;me.eachBox(function(box){box.resetOriginalValue()}),me.originalValue=me.getValue(),me.checkDirty()}})},Ext.onReady(Extensible.applyOverrides),Ext.define("Extensible.lang.Number",{statics:{getOrdinalSuffix:function(num){if(!Ext.isNumber(num))return"";switch(num){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}}}},function(){Extensible.Number=Extensible.lang.Number}),Ext.define("Extensible.data.Model",{extend:"Ext.data.Model",requires:["Ext.util.MixedCollection"],mappingClass:null,mappingIdProperty:null,inheritableStatics:{reconfigure:function(){var proto=this.prototype,mappings=Ext.ClassManager.get(proto.mappingClass||""),idProperty=proto.mappingIdProperty,prop,fields=[],i=0,len=0;if(!mappings)throw"The mappingClass for "+this.$className+" is undefined or invalid";proto.idProperty=idProperty||proto.idProperty||"id";for(prop in mappings)mappings.hasOwnProperty(prop)&&fields.push(mappings[prop]);for(proto.fields.clear(),len=fields.length;len>i;i++)proto.fields.add(Ext.create("Ext.data.Field",fields[i]));return this}},clone:function(preserveId){var copy=Ext.create(this.$className),dataProp=this.persistenceProperty;return copy[dataProp]=Ext.Object.merge({},this[dataProp]),preserveId!==!0&&delete copy[dataProp][this.idProperty],copy}}),Ext.define("Extensible.form.recurrence.Rule",{config:{dateValueFormat:"Ymd\\THis\\Z",rule:null,startDate:null,frequency:null,count:null,until:null,interval:1,byDay:null,byDayWeekdays:null,byMonthDay:null,byMonth:null,strings:{dayNamesShort:{SU:"Sun",MO:"Mon",TU:"Tue",WE:"Wed",TH:"Thu",FR:"Fri",SA:"Sat"},dayNamesShortByIndex:{0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat"},dayNamesLong:{SU:"Sunday",MO:"Monday",TU:"Tuesday",WE:"Wednesday",TH:"Thursday",FR:"Friday",SA:"Saturday"},ordinals:{1:"first",2:"second",3:"third",4:"fourth",5:"fifth",6:"sixth"},frequency:{none:"Does not repeat",daily:"Daily",weekly:"Weekly",weekdays:"Every weekday (Mon-Fri)",monthly:"Monthly",yearly:"Yearly"},every:"Every",days:"days",weeks:"weeks",weekdays:"weekdays",months:"months",years:"years",time:"time",times:"times",until:"until",untilFormat:"M j, Y",and:"and",on:"on",onDay:"on day",onDayPostfix:"",onThe:"on the",onTheLast:"on the last",onTheLastDay:"on the last day",of:"of",monthFormat:"F",monthDayFormat:"F j"}},byDayNames:["SU","MO","TU","WE","TH","FR","SA"],constructor:function(config){return this.initConfig(config)},init:function(){var me=this;me.startDate=null,me.frequency=null,me.count=null,me.until=null,me.interval=1,me.byDay=null,me.byDayWeekdays=null,me.byDayNthWeekday=null,me.byMonthDay=null,me.byMonth=null},applyStartDate:function(dt){this.startDate=new Date(dt)},applyFrequency:function(freq){this.init(),this.frequency=freq},applyCount:function(count){this.until=null,this.count=count},applyUntil:function(until){this.count=this.until=null,Ext.isDate(until)?this.until=until:"string"==typeof until&&(this.until=this.parseDate(until))},parseDate:function(dateString,options){options=options||{};try{var date=Ext.Date.parse(dateString,options.format||this.dateValueFormat,options.strict);if(date)return date}catch(ex){}return options.defaultValue||new Date},formatDate:function(date){return Ext.Date.format(date,this.dateValueFormat)},applyByDay:function(byDay){var me=this;if(me.byMonthDay=null,me.byDayWeekdays=null,me.byDayNthWeekday=null,"string"==typeof byDay){me.byDay=byDay;var n=parseInt(byDay,10);Ext.isNumber(n)?me.byDayNthWeekday=-1===n?{number:n,weekday:byDay.substr(2,2)}:{number:n,weekday:byDay.substr(1,2)}:me.byDayWeekdays=byDay.split(",")}else Array.isArray(byDay)?(me.byDay=byDay.join(","),me.byDayWeekdays=byDay):Ext.isObject(byDay)&&(me.byDay=byDay.number+byDay.weekday,me.byDayNthWeekday=byDay)},getByDayNthWeekday:function(){return this.byDayNthWeekday},applyByMonthDay:function(day){this.byDay=null,this.byDayWeekdays=null,this.byDayNthWeekday=null,this.byMonthDay=day},getRule:function(){var rule=[],me=this;return me.frequency?(rule.push("FREQ="+me.frequency),1!==me.interval&&rule.push("INTERVAL="+me.interval),me.byDay&&rule.push("BYDAY="+me.byDay),me.byMonthDay&&rule.push("BYMONTHDAY="+me.byMonthDay),me.byMonth&&rule.push("BYMONTH="+me.byMonth),me.count&&rule.push("COUNT="+me.count),me.until&&rule.push("UNTIL="+Ext.Date.format(me.until,me.dateValueFormat)),rule.join(";")+";"):""},applyRule:function(rRule){var rrParams,nbParams,p,v,i=0,me=this;if(!rRule)return this.init(),void 0;for(rrParams=rRule.split(";"),nbParams=rrParams.length;nbParams>i;i++)if(p=rrParams[i].split("="),"FREQ"===p[0]){me.setFrequency(p[1]);break}for(i=0;nbParams>i;i++)switch(p=rrParams[i].split("="),v=p[1],p[0]){case"INTERVAL":me.setInterval(parseInt(v,10));break;case"COUNT":me.setCount(parseInt(v,10));break;case"UNTIL":me.setUntil(v);break;case"BYDAY":me.setByDay(v);break;case"BYMONTHDAY":me.setByMonthDay(parseInt(v,10));break;case"BYMONTH":me.setByMonth(parseInt(v,10))}},getDescription:function(startDate){var me=this,desc=[],freq=me.frequency?Ext.String.capitalize(me.frequency.toLowerCase()):"";return startDate=startDate||this.startDate,freq&&me["getDescription"+freq]&&me["getDescription"+freq](desc,startDate),me.getDescriptionCount(desc,startDate),me.getDescriptionUntil(desc,startDate),desc.join("")},getDescriptionDaily:function(desc,startDate){var me=this,strings=me.strings;1===me.interval?desc.push(strings.frequency.daily):desc.push(strings.every," ",me.interval," ",strings.days)},getDescriptionWeekly:function(desc,startDate){var me=this,strings=me.strings;if(1===me.interval?desc.push(strings.frequency.weekly):desc.push(strings.every," ",me.interval," ",strings.weeks),me.byDayWeekdays){var len=me.byDayWeekdays.length;desc.push(" ",strings.on," ");for(var i=0;len>i;i++)i>0&&len-1>i?desc.push(", "):len>1&&i===len-1&&desc.push(" ",strings.and," "),len>2?desc.push(strings.dayNamesShort[me.byDayWeekdays[i]]):desc.push(strings.dayNamesLong[me.byDayWeekdays[i]])}else startDate&&desc.push(" ",strings.on," ",strings.dayNamesLong[me.byDayNames[startDate.getDay()]])},getDescriptionWeekdays:function(desc,startDate){1===this.interval?desc.push(this.strings.frequency.weekdays):desc.push(this.strings.every," ",this.interval," ",this.strings.weekdays)},getDescriptionMonthly:function(desc,startDate){var me=this,strings=me.strings;1===me.interval?desc.push(strings.frequency.monthly):desc.push(strings.every," ",me.interval," ",strings.months),me.byMonthDay>0?desc.push(" "+strings.onDay+" "+me.byMonthDay+strings.onDayPostfix):-1===me.byMonthDay?desc.push(" "+strings.onTheLastDay):me.byDayNthWeekday&&(me.byDayNthWeekday.number>0?desc.push(" ",strings.onThe," ",strings.ordinals[me.byDayNthWeekday.number]," ",strings.dayNamesLong[me.byDayNthWeekday.weekday]):desc.push(" "+strings.onTheLast+" "+strings.dayNamesLong[me.byDayNthWeekday.weekday]))},getDescriptionYearly:function(desc,startDate){var me=this,strings=me.strings;1===me.interval?desc.push(strings.frequency.yearly):desc.push(strings.every," ",me.interval," ",strings.years),startDate&&(-1===me.byMonthDay?desc.push(" ",strings.onTheLastDay," ",strings.of," ",Ext.Date.format(startDate,strings.monthFormat)):me.byDayNthWeekday?me.byDayNthWeekday.number>0?desc.push(" ",strings.onThe," ",strings.ordinals[me.byDayNthWeekday.number]," ",strings.dayNamesLong[me.byDayNthWeekday.weekday]," ",strings.of," ",Ext.Date.format(startDate,strings.monthFormat)):desc.push(" ",strings.onTheLast," ",strings.dayNamesLong[me.byDayNthWeekday.weekday]," ",strings.of," ",Ext.Date.format(startDate,strings.monthFormat)):desc.push(" ",strings.on," ",Ext.Date.format(startDate,strings.monthDayFormat)))},getDescriptionCount:function(desc,startDate){this.count&&desc.push(", ",this.count," ",1===this.count?this.strings.time:this.strings.times)},getDescriptionUntil:function(desc,startDate){this.until&&desc.push(", ",this.strings.until," ",Ext.Date.format(this.until,this.strings.untilFormat))}}),Ext.define("Extensible.form.recurrence.Parser",{extend:"Extensible.form.recurrence.Rule",singleton:!0}),Ext.define("Extensible.form.recurrence.AbstractOption",{extend:"Ext.form.FieldContainer",requires:["Extensible.form.recurrence.Rule"],mixins:{field:"Ext.form.field.Field"},layout:"hbox",defaults:{margins:"0 5 0 0"},rrule:void 0,startDate:void 0,startDay:0,maxEndDate:new Date("12/31/9999"),key:void 0,optionDelimiter:";",initComponent:function(){var me=this;me.addEvents("change"),me.initRRule(),me.items=me.getItemConfigs(),me.callParent(arguments),me.initRefs(),me.initField()},initRRule:function(){var me=this;me.rrule=me.rrule||Ext.create("Extensible.form.recurrence.Rule"),me.startDate=me.startDate||me.rrule.startDate||Extensible.Date.today(),me.rrule.startDate||me.rrule.setStartDate(me.startDate)},afterRender:function(){this.callParent(arguments),this.updateLabel()},initRefs:Ext.emptyFn,setFrequency:function(freq){this.frequency=freq},setStartDate:function(dt){return this.startDate=dt,this},getStartDate:function(){return this.startDate||Extensible.Date.today()},getDefaultValue:function(){return""},preSetValue:function(v,readyField){var me=this;return v||(v=me.getDefaultValue()),readyField?(me.value=v,!0):(me.on("afterrender",function(){me.setValue(v)},me,{single:!0}),!1)}}),Ext.define("Extensible.form.recurrence.option.Duration",{extend:"Extensible.form.recurrence.AbstractOption",alias:"widget.extensible.recurrence-duration",requires:["Ext.form.Label","Ext.form.field.ComboBox","Ext.form.field.Number","Ext.form.field.Date"],minOccurrences:1,maxOccurrences:999,defaultEndDateOffset:5,minDateOffset:1,endDateWidth:120,strings:{andContinuing:"and continuing",occurrences:"occurrences",forever:"forever",forText:"for",until:"until"},cls:"extensible-recur-duration",getItemConfigs:function(){var me=this;return[me.getContinuingLabelConfig(),me.getDurationComboConfig(),me.getDurationDateFieldConfig(),me.getDurationNumberFieldConfig(),me.getOccurrencesLabelConfig()]},getContinuingLabelConfig:function(){return{xtype:"label",text:this.strings.andContinuing}},getDurationComboConfig:function(){var me=this;return{xtype:"combo",itemId:me.id+"-duration-combo",mode:"local",width:85,triggerAction:"all",forceSelection:!0,value:me.strings.forever,store:[me.strings.forever,me.strings.forText,me.strings.until],listeners:{change:Ext.bind(me.onComboChange,me)}}},getDurationDateFieldConfig:function(){var me=this,startDate=me.getStartDate();return{xtype:"datefield",itemId:me.id+"-duration-date",showToday:!1,width:me.endDateWidth,format:me.endDateFormat||Ext.form.field.Date.prototype.format,startDay:this.startDay,maxValue:me.maxEndDate,allowBlank:!1,hidden:!0,minValue:Ext.Date.add(startDate,Ext.Date.DAY,me.minDateOffset),value:me.getDefaultEndDate(startDate),listeners:{change:Ext.bind(me.onEndDateChange,me)}}},getDurationNumberFieldConfig:function(){var me=this;return{xtype:"numberfield",itemId:me.id+"-duration-num",value:5,width:55,minValue:me.minOccurrences,maxValue:me.maxOccurrences,allowBlank:!1,hidden:!0,listeners:{change:Ext.bind(me.onOccurrenceCountChange,me)}}},getOccurrencesLabelConfig:function(){return{xtype:"label",itemId:this.id+"-duration-num-label",text:this.strings.occurrences,hidden:!0}},initRefs:function(){var me=this;me.untilCombo=me.down("#"+me.id+"-duration-combo"),me.untilDateField=me.down("#"+me.id+"-duration-date"),me.untilNumberField=me.down("#"+me.id+"-duration-num"),me.untilNumberLabel=me.down("#"+me.id+"-duration-num-label")},onComboChange:function(combo,value){this.toggleFields(value),this.checkChange()},toggleFields:function(toShow){var me=this;me.untilCombo.setValue(toShow),toShow===me.strings.until?(me.untilDateField.getValue()||me.initUntilDate(),me.untilDateField.show()):(me.untilDateField.hide(),me.untilDateIsSet=!1),toShow===me.strings.forText?(me.untilNumberField.show(),me.untilNumberLabel.show()):(me.untilNumberField.hide(),me.untilNumberLabel.hide())},onOccurrenceCountChange:function(field,value,oldValue){this.checkChange()},onEndDateChange:function(field,value,oldValue){this.checkChange()},setStartDate:function(dt){var me=this,value=me.getValue();return dt.getTime()!==me.startDate.getTime()&&(me.callParent(arguments),me.untilDateField.setMinValue(dt),(!value||dt>me.untilDateField.getValue())&&me.initUntilDate(dt)),me},setFrequency:function(){return this.callParent(arguments),this.initUntilDate(),this},initUntilDate:function(startDate){if(!this.untilDateIsSet){this.untilDateIsSet=!0;var endDate=this.getDefaultEndDate(startDate||this.getStartDate());this.untilDateField.setValue(endDate)}return this},getDefaultEndDate:function(startDate){var options={},unit;switch(this.frequency){case"WEEKLY":case"WEEKDAYS":unit="weeks";break;case"MONTHLY":unit="months";break;case"YEARLY":unit="years";break;default:unit="days"}return options[unit]=this.defaultEndDateOffset,Extensible.Date.add(startDate,options)},getValue:function(){var me=this;if(me.untilCombo){if(me.untilNumberField.isVisible())return"COUNT="+me.untilNumberField.getValue();if(me.untilDateField.isVisible())return"UNTIL="+me.rrule.formatDate(this.adjustUntilDateValue(me.untilDateField.getValue()))}return""},adjustUntilDateValue:function(untilDate){return Extensible.Date.add(untilDate,{days:1,seconds:-1})},setValue:function(v){var me=this;if(!me.preSetValue(v,me.untilCombo))return me;if(!v)return me.toggleFields(me.strings.forever),me;var options=Ext.isArray(v)?v:v.split(me.optionDelimiter),didSetValue=!1,parts;return Ext.each(options,function(option){return parts=option.split("="),"COUNT"===parts[0]?(me.untilNumberField.setValue(parts[1]),me.toggleFields(me.strings.forText),didSetValue=!0,void 0):"UNTIL"===parts[0]?(me.untilDateField.setValue(me.rrule.parseDate(parts[1])),me.untilDateField.validate(),me.toggleFields(me.strings.until),didSetValue=!0,void 0):void 0},me),didSetValue||me.toggleFields(me.strings.forever),me}}),Ext.define("Extensible.form.recurrence.option.Interval",{extend:"Extensible.form.recurrence.AbstractOption",alias:"widget.extensible.recurrence-interval",dateLabelFormat:"l, F j",unit:"day",minValue:1,maxValue:999,startDateWidth:120,strings:{repeatEvery:"Repeat every",beginning:"beginning",day:"day",days:"days",week:"week",weeks:"weeks",month:"month",months:"months",year:"year",years:"years"},cls:"extensible-recur-interval",initComponent:function(){this.addEvents("startchange"),this.callParent(arguments)},getItemConfigs:function(){return[this.getRepeatEveryLabelConfig(),this.getIntervalComboConfig(),this.getBeginDateLabelConfig(),this.getBeginDateFieldConfig()]},getRepeatEveryLabelConfig:function(){return{xtype:"label",text:this.strings.repeatEvery}},getIntervalComboConfig:function(){var me=this;return{xtype:"numberfield",itemId:me.id+"-interval",value:1,width:55,minValue:me.minValue,maxValue:me.maxValue,allowBlank:!1,enableKeyEvents:!0,listeners:{change:Ext.bind(me.onIntervalChange,me)}}},getBeginDateLabelConfig:function(){return{xtype:"label",itemId:this.id+"-date-label"}},getBeginDateFieldConfig:function(){var me=this,startDate=me.getStartDate();return{xtype:"datefield",itemId:me.id+"-start-date",width:me.startDateWidth,startDay:this.startDay,maxValue:me.maxEndDate,allowBlank:!1,value:startDate,listeners:{change:Ext.bind(me.onStartDateChange,me)}}},initRefs:function(){var me=this;me.intervalField=me.down("#"+me.id+"-interval"),me.dateLabel=me.down("#"+me.id+"-date-label"),me.startDateField=me.down("#"+me.id+"-start-date")},onIntervalChange:function(field,value,oldValue){this.checkChange(),this.updateLabel()},onStartDateChange:function(field,value,oldValue){this.checkChange(),this.fireEvent("startchange",this,value,oldValue)},getValue:function(){return this.intervalField?"INTERVAL="+this.intervalField.getValue():""},setValue:function(v){var me=this;if(!me.preSetValue(v,me.intervalField))return me;if(!v)return me.intervalField.setValue(me.minValue),me;var options=Ext.isArray(v)?v:v.split(me.optionDelimiter),parts;return Ext.each(options,function(option){return parts=option.split("="),"INTERVAL"===parts[0]?(me.intervalField.setValue(parts[1]),me.updateLabel(),void 0):void 0},me),me},setStartDate:function(dt){return this.startDate=dt,this.startDateField.setValue(dt),this},setUnit:function(unit){return this.unit=unit,this.updateLabel(),this},updateLabel:function(unit){var me=this;if(me.intervalField){var s=1===me.intervalField.getValue()?"":"s";me.unit=unit?unit.toLowerCase():me.unit||"day",me.dateLabel&&me.dateLabel.update(me.strings[me.unit+s]+" "+me.strings.beginning)}return me}}),Ext.define("Extensible.form.recurrence.option.Monthly",{extend:"Extensible.form.recurrence.AbstractOption",alias:"widget.extensible.recurrence-monthly",requires:["Ext.form.field.ComboBox","Extensible.lang.Number"],cls:"extensible-recur-monthly",nthComboWidth:150,strings:{onThe:"on the",ofEach:"of each",inText:"in",day:"day",month:"month",year:"year",last:"last",lastDay:"last day",monthDayDateFormat:"jS",nthWeekdayDateFormat:"S"},afterRender:function(){this.callParent(arguments),this.initNthCombo()},getItemConfigs:function(){return[this.getOnTheLabelConfig(),this.getNthComboConfig(),this.getOfEachLabelConfig()]},getOnTheLabelConfig:function(){return{xtype:"label",text:this.strings.onThe}},getNthComboConfig:function(){return{xtype:"combobox",itemId:this.id+"-nth-combo",queryMode:"local",width:this.nthComboWidth,triggerAction:"all",forceSelection:!0,displayField:"text",valueField:"value",store:Ext.create("Ext.data.ArrayStore",{fields:["text","value"],idIndex:0,data:[]}),listeners:{change:Ext.bind(this.onComboChange,this)}}},getPeriodString:function(){return this.strings.month},getOfEachLabelConfig:function(){return{xtype:"label",text:this.strings.ofEach+" "+this.getPeriodString()}},initRefs:function(){this.nthCombo=this.down("#"+this.id+"-nth-combo")},onComboChange:function(combo,value){this.checkChange()},setStartDate:function(dt){return dt.getTime()!==this.startDate.getTime()&&(this.callParent(arguments),this.initNthCombo()),this},initNthCombo:function(){if(this.rendered){var me=this,combo=me.nthCombo,store=combo.store,dt=me.getStartDate(),lastDayOfMonth=Ext.Date.getLastDateOfMonth(dt).getDate(),monthDayText=Ext.Date.format(dt,me.strings.monthDayDateFormat)+" "+me.strings.day,dayNum=dt.getDate(),dayIndex=Math.ceil(dayNum/7),dayNameAbbreviated=Extensible.form.recurrence.Parser.byDayNames[dt.getDay()],tempDate=new Date(2e3,0,dayIndex),dayOfWeekText=dayIndex+Ext.Date.format(tempDate,me.strings.nthWeekdayDateFormat)+Ext.Date.format(dt," l"),yearlyText=me.isYearly?" "+me.strings.inText+" "+Ext.Date.format(dt,"F"):"",byMonthValue=me.isYearly?"BYMONTH="+Ext.Date.format(dt,"n"):"",delimiter=me.isYearly?me.optionDelimiter:"",data=[[monthDayText+yearlyText,me.isYearly?byMonthValue:"BYMONTHDAY="+dayNum],[dayOfWeekText+yearlyText,byMonthValue+delimiter+"BYDAY="+dayIndex+dayNameAbbreviated]],idx=store.find("value",combo.getValue());return 7>lastDayOfMonth-dayNum&&data.push([me.strings.last+" "+Ext.Date.format(dt,"l")+yearlyText,byMonthValue+delimiter+"BYDAY=-1"+dayNameAbbreviated]),lastDayOfMonth===dayNum&&data.push([me.strings.lastDay+yearlyText,byMonthValue+delimiter+"BYMONTHDAY=-1"]),store.removeAll(),combo.clearValue(),store.loadData(data),idx>data.length-1&&(idx=data.length-1),combo.setValue(store.getAt(idx>-1?idx:0).data.value),me}},getValue:function(){var me=this;return me.nthCombo?me.nthCombo.getValue():""},setValue:function(v){var me=this;if(!me.preSetValue(v,me.nthCombo))return me;if(!v){var defaultItem=me.nthCombo.store.getAt(0);return defaultItem&&me.nthCombo.setValue(defaultItem.data.value),me}var options=Ext.isArray(v)?v:v.split(me.optionDelimiter),parts,values=[];return Ext.each(options,function(option){parts=option.split("="),"BYMONTH"===parts[0]&&values.unshift(option),("BYMONTHDAY"===parts[0]||"BYDAY"===parts[0])&&values.push(option)},me),values.length&&me.nthCombo.setValue(values.join(me.optionDelimiter)),me}}),Ext.define("Extensible.form.recurrence.option.Weekly",{extend:"Extensible.form.recurrence.AbstractOption",alias:"widget.extensible.recurrence-weekly",requires:["Ext.form.field.Checkbox","Ext.form.CheckboxGroup","Extensible.form.recurrence.Parser"],startDay:0,dayValueDelimiter:",",cls:"extensible-recur-weekly",strings:{on:"on"},getCheckboxGroupItems:function(){for(var weekdaysId=Extensible.form.recurrence.Parser.byDayNames,weekdaysText=Extensible.form.recurrence.Parser.strings.dayNamesShortByIndex,checkboxArray=[],i=this.startDay,n=0;7>n;n++)checkboxArray[n]={boxLabel:weekdaysText[i],name:weekdaysId[i],id:this.id+"-"+weekdaysId[i]},i=6===i?0:i+1;return checkboxArray},getItemConfigs:function(){var id=this.id;return[{xtype:"label",text:this.strings.on+":"},{xtype:"checkboxgroup",itemId:id+"-days",flex:1,items:this.getCheckboxGroupItems(),listeners:{change:Ext.bind(this.onSelectionChange,this)}}]},initValue:function(){this.callParent(arguments),this.value||this.selectByDate()},initRefs:function(){this.daysCheckboxGroup=this.down("#"+this.id+"-days")},onSelectionChange:function(field,value,oldValue){this.checkChange(),this.updateLabel()},selectByDate:function(dt){var day=Ext.Date.format(dt||this.getStartDate(),"D").substring(0,2).toUpperCase();this.setValue("BYDAY="+day)},clearValue:function(){this.value=void 0,this.daysCheckboxGroup&&this.daysCheckboxGroup.setValue({SU:0,MO:0,TU:0,WE:0,TH:0,FR:0,SA:0})},getValue:function(){var me=this;if(me.daysCheckboxGroup){var fieldValue=me.daysCheckboxGroup.getValue(),days=[],property;for(property in fieldValue)fieldValue.hasOwnProperty(property)&&days.push(property);return days.length>0?"BYDAY="+days.join(me.dayValueDelimiter):""}return""},setValue:function(v){var me=this;if(!me.preSetValue(v,me.daysCheckboxGroup))return me;if(me.daysCheckboxGroup.setValue(null),!v)return me;var options=Ext.isArray(v)?v:v.split(me.optionDelimiter),compositeValue={},parts,days;return Ext.each(options,function(option){return parts=option.split("="),"BYDAY"===parts[0]?(days=parts[1].split(me.dayValueDelimiter),Ext.each(days,function(day){compositeValue[day]=!0},me),me.daysCheckboxGroup.setValue(compositeValue),void 0):void 0},me),me}}),Ext.define("Extensible.form.recurrence.option.Yearly",{extend:"Extensible.form.recurrence.option.Monthly",alias:"widget.extensible.recurrence-yearly",cls:"extensible-recur-yearly",nthComboWidth:200,isYearly:!0,getPeriodString:function(){return this.strings.year}}),Ext.define("Extensible.form.recurrence.FrequencyCombo",{extend:"Ext.form.field.ComboBox",alias:"widget.extensible.recurrence-frequency",requires:["Ext.data.ArrayStore","Extensible.form.recurrence.Parser"],fieldLabel:"Repeats",queryMode:"local",triggerAction:"all",forceSelection:!0,displayField:"pattern",valueField:"id",cls:"extensible-recur-frequency",initComponent:function(){var me=this;me.addEvents("frequencychange");var freq=Extensible.form.recurrence.Parser.strings.frequency;me.frequencyOptions=me.frequencyOptions||[["NONE",freq.none],["DAILY",freq.daily],["WEEKDAYS",freq.weekdays],["WEEKLY",freq.weekly],["MONTHLY",freq.monthly],["YEARLY",freq.yearly]],me.store=me.store||Ext.create("Ext.data.ArrayStore",{fields:["id","pattern"],idIndex:0,data:me.frequencyOptions}),me.on("select",me.onSelect,me),me.callParent(arguments)},onSelect:function(combo,records){this.fireEvent("frequencychange",records[0].data.id)}}),Ext.define("Extensible.form.recurrence.Fieldset",{extend:"Ext.form.FieldContainer",alias:"widget.extensible.recurrencefield",mixins:{field:"Ext.form.field.Field"},requires:["Ext.form.Label","Extensible.form.recurrence.Rule","Extensible.form.recurrence.FrequencyCombo","Extensible.form.recurrence.option.Interval","Extensible.form.recurrence.option.Weekly","Extensible.form.recurrence.option.Monthly","Extensible.form.recurrence.option.Yearly","Extensible.form.recurrence.option.Duration"],rrule:void 0,startDate:void 0,startDay:0,options:["daily","weekly","weekdays","monthly","yearly"],displayStyle:"field",fieldLabel:"Repeats",fieldContainerWidth:400,monitorChanges:!0,cls:"extensible-recur-field",frequencyWidth:null,layout:"anchor",defaults:{anchor:"100%"},initComponent:function(){var me=this;me.height&&"field"!==me.displayStyle||(delete me.height,me.autoHeight=!0),this.addEvents("startchange"),me.initRRule(),me.items=[{xtype:"extensible.recurrence-frequency",hideLabel:!0,width:this.frequencyWidth,itemId:this.id+"-frequency",listeners:{frequencychange:{fn:this.onFrequencyChange,scope:this}}},{xtype:"container",itemId:this.id+"-inner-ct",cls:"extensible-recur-inner-ct",autoHeight:!0,layout:"anchor",hideMode:"offsets",hidden:!0,width:this.fieldContainerWidth,defaults:{hidden:!0,rrule:me.rrule},items:[{xtype:"extensible.recurrence-interval",itemId:this.id+"-interval"},{xtype:"extensible.recurrence-weekly",itemId:this.id+"-weekly",startDay:this.startDay},{xtype:"extensible.recurrence-monthly",itemId:this.id+"-monthly"},{xtype:"extensible.recurrence-yearly",itemId:this.id+"-yearly"},{xtype:"extensible.recurrence-duration",itemId:this.id+"-duration",startDay:this.startDay}]}],me.callParent(arguments),me.initField()},initRRule:function(){var me=this;me.rrule=me.rrule||Ext.create("Extensible.form.recurrence.Rule"),me.startDate=me.startDate||me.rrule.startDate||Extensible.Date.today(),me.rrule.startDate||me.rrule.setStartDate(me.startDate)},afterRender:function(){this.callParent(arguments),this.initRefs()},initRefs:function(){var me=this,id=me.id;me.innerContainer=me.down("#"+id+"-inner-ct"),me.frequencyCombo=me.down("#"+id+"-frequency"),me.intervalField=me.down("#"+id+"-interval"),me.weeklyField=me.down("#"+id+"-weekly"),me.monthlyField=me.down("#"+id+"-monthly"),me.yearlyField=me.down("#"+id+"-yearly"),me.durationField=me.down("#"+id+"-duration"),me.initChangeEvents()},initChangeEvents:function(){var me=this;me.intervalField.on("startchange",me.onStartDateChange,me),me.intervalField.on("change",me.onChange,me),me.weeklyField.on("change",me.onChange,me),me.monthlyField.on("change",me.onChange,me),me.yearlyField.on("change",me.onChange,me),me.durationField.on("change",me.onChange,me)},onStartDateChange:function(interval,newDate,oldDate){this.fireEvent("startchange",this,newDate,oldDate)},onChange:function(){this.fireEvent("change",this,this.getValue())},onFrequencyChange:function(freq){this.setFrequency(freq),this.onChange()},initValue:function(){var me=this;me.originalValue=me.lastValue=me.value,me.suspendCheckChange++,me.setStartDate(me.startDate),void 0!==me.value?me.setValue(me.value):void 0!==me.frequency?me.setValue("FREQ="+me.frequency):me.setValue(""),me.suspendCheckChange--,Ext.defer(me.doLayout,1,me),me.onChange()},setStartDate:function(dt){var me=this;return me.startDate=dt,me.innerContainer?me.innerContainer.items.each(function(item){item.setStartDate&&item.setStartDate(dt)}):me.on("afterrender",function(){me.setStartDate(dt)},me,{single:!0}),me},getStartDate:function(){return this.startDate},isRecurring:function(){return""!==this.getValue()},getValue:function(){if(!this.innerContainer)return this.value;if("NONE"===this.frequency)return"";var values,itemValue;return values="WEEKDAYS"===this.frequency?["FREQ=WEEKLY","BYDAY=MO,TU,WE,TH,FR"]:["FREQ="+this.frequency],this.innerContainer.items.each(function(item){item.isVisible()&&item.getValue&&(itemValue=item.getValue(),this.includeItemValue(itemValue)&&values.push(itemValue))
},this),values.length>1?values.join(";"):values[0]},includeItemValue:function(value){if(value){if("INTERVAL=1"===value)return!1;var day=Ext.Date.format(this.startDate,"D").substring(0,2).toUpperCase();return value==="BYDAY="+day?!1:!0}return!1},getDescription:function(){return this.rrule.setRule(this.getValue()).getDescription()},setValue:function(value){var me=this;if(me.value=value&&"NONE"!==value?value:"",!me.frequencyCombo||!me.innerContainer)return me.on("afterrender",function(){me.setValue(value)},me,{single:!0}),void 0;var parts=me.value.split(";");return""===me.value?me.setFrequency("NONE"):Ext.each(parts,function(part){if(part.indexOf("FREQ")>-1){var freq=part.split("=")[1];return me.setFrequency(freq),me.checkChange(),void 0}},me),me.innerContainer.items.each(function(item){item.setValue&&item.setValue(me.value)}),me.checkChange(),me},setFrequency:function(freq){var me=this;return me.frequency=freq,me.frequencyCombo?(me.frequencyCombo.setValue(freq),me.showOptions(freq),this.innerContainer.items.each(function(item){item.setFrequency(freq)})):me.on("afterrender",function(){me.frequencyCombo.setValue(freq),me.showOptions(freq)},me,{single:!0}),me},showOptions:function(freq){var me=this,unit="day";switch("NONE"===freq?me.innerContainer.hide():(me.intervalField.show(),me.durationField.show(),me.innerContainer.show()),freq){case"DAILY":case"WEEKDAYS":me.weeklyField.hide(),me.monthlyField.hide(),me.yearlyField.hide(),"WEEKDAYS"===freq&&(unit="week");break;case"WEEKLY":me.weeklyField.show(),me.monthlyField.hide(),me.yearlyField.hide(),unit="week";break;case"MONTHLY":me.monthlyField.show(),me.weeklyField.hide(),me.yearlyField.hide(),unit="month";break;case"YEARLY":me.yearlyField.show(),me.weeklyField.hide(),me.monthlyField.hide(),unit="year"}me.intervalField.updateLabel(unit)}}),Ext.define("Extensible.form.recurrence.RangeEditPanel",{extend:"Ext.form.Panel",alias:"widget.extensible.recurrence-rangeeditpanel",cls:"extensible-recur-edit-options",headerText:"There are multiple events in this series. How would you like your changes applied?",optionSingleButtonText:"Single",optionSingleDescription:"Apply to this event only. No other events in the series will be affected.",optionFutureButtonText:"Future",optionFutureDescription:"Apply to this and all following events only. Past events will be unaffected.",optionAllButtonText:"All Events",optionAllDescription:"Apply to every event in this series.",editModes:{SINGLE:"single",FUTURE:"future",ALL:"all"},border:!1,layout:{type:"vbox",align:"stretch"},initComponent:function(){var me=this;me.editMode=me.editMode||me.editModes.ALL,me.items=[me.getHeaderConfig(),me.getOptionPanelConfig(),me.getSummaryConfig()],me.callParent(arguments)},getHeaderConfig:function(){return{xtype:"component",html:this.headerText,height:55,padding:15}},getSummaryConfig:function(){return{xtype:"component",itemId:this.id+"-summary",html:this.optionAllDescription,flex:1,padding:15}},getOptionPanelConfig:function(){return{xtype:"panel",border:!1,layout:{type:"hbox",pack:"center"},items:this.getOptionButtonConfigs()}},getOptionButtonConfigs:function(){var me=this,defaultConfig={xtype:"button",iconAlign:"top",enableToggle:!0,scale:"large",width:80,toggleGroup:"recur-toggle",toggleHandler:me.onToggle,scope:me},items=[Ext.apply({itemId:me.id+"-single",text:me.optionSingleButtonText,iconCls:"recur-edit-single",pressed:me.editMode===me.editModes.SINGLE},defaultConfig),Ext.apply({itemId:me.id+"-future",text:me.optionFutureButtonText,iconCls:"recur-edit-future",pressed:me.editMode===me.editModes.FUTURE},defaultConfig),Ext.apply({itemId:me.id+"-all",text:me.optionAllButtonText,iconCls:"recur-edit-all",pressed:me.editMode===me.editModes.ALL},defaultConfig)];return items},getEditMode:function(){return this.editMode},showEditModes:function(modes){modes=modes||[];var me=this,i=0,btn,len=modes.length;for(me.down("#"+me.id+"-single")[len?"hide":"show"](),me.down("#"+me.id+"-future")[len?"hide":"show"](),me.down("#"+me.id+"-all")[len?"hide":"show"]();len>i;i++)btn=me.down("#"+me.id+"-"+modes[i]),btn&&btn.show()},onToggle:function(btn){var me=this,summaryEl=me.getComponent(me.id+"-summary").getEl();btn.itemId===me.id+"-single"?(summaryEl.update(me.optionSingleDescription),me.editMode=me.editModes.SINGLE):btn.itemId===me.id+"-future"?(summaryEl.update(me.optionFutureDescription),me.editMode=me.editModes.FUTURE):(summaryEl.update(me.optionAllDescription),me.editMode=me.editModes.ALL)}}),Ext.define("Extensible.form.recurrence.RangeEditWindow",{extend:"Ext.window.Window",alias:"widget.extensible.recurrence-rangeeditwindow",id:"ext-cal-rangeeditwin",requires:["Extensible.form.recurrence.RangeEditPanel"],title:"Recurring Event Options",width:350,height:240,saveButtonText:"Save",cancelButtonText:"Cancel",closeAction:"hide",modal:!0,resizable:!1,constrain:!0,buttonAlign:"right",layout:"fit",formPanelConfig:{border:!1},initComponent:function(){this.items=[{xtype:"extensible.recurrence-rangeeditpanel",itemId:this.id+"-recur-panel"}],this.fbar=this.getFooterBarConfig(),this.callParent(arguments)},getRangeEditPanel:function(){return this.down("#"+this.id+"-recur-panel")},prompt:function(o){this.callbackFunction=Ext.bind(o.callback,o.scope||this),this.getRangeEditPanel().showEditModes(o.editModes),this.show()},getFooterBarConfig:function(){var cfg=["->",{text:this.saveButtonText,itemId:this.id+"-save-btn",disabled:!1,handler:this.onSaveAction,scope:this},{text:this.cancelButtonText,itemId:this.id+"-cancel-btn",disabled:!1,handler:this.onCancelAction,scope:this}];return cfg},onSaveAction:function(){var mode=this.getComponent(this.id+"-recur-panel").getEditMode();this.callbackFunction(mode),this.close()},onCancelAction:function(){this.callbackFunction(!1),this.close()}}),Ext.ns("Extensible.calendar.data"),Extensible.calendar.data.EventMappings={EventId:{name:"EventId",mapping:"id",type:"string"},CalendarId:{name:"CalendarId",mapping:"cid",type:"string"},Title:{name:"Title",mapping:"title",type:"string"},StartDate:{name:"StartDate",mapping:"start",type:"date",dateFormat:"c"},EndDate:{name:"EndDate",mapping:"end",type:"date",dateFormat:"c"},Location:{name:"Location",mapping:"loc",type:"string"},Notes:{name:"Notes",mapping:"notes",type:"string"},Url:{name:"Url",mapping:"url",type:"string"},IsAllDay:{name:"IsAllDay",mapping:"ad",type:"boolean"},Reminder:{name:"Reminder",mapping:"rem",type:"string"},Colour:{name:"Colour",mapping:"colour",type:"string"},Color:{name:"Color",mapping:"color",type:"int"},RRule:{name:"RRule",mapping:"rrule",type:"string",useNull:!0},Duration:{name:"Duration",mapping:"duration",defaultValue:-1,useNull:!0,type:"int"},OriginalEventId:{name:"OriginalEventId",mapping:"origid",type:"string",useNull:!0},RSeriesStartDate:{name:"RSeriesStartDate",mapping:"rsstart",type:"date",dateFormat:"c",useNull:!0},RInstanceStartDate:{name:"RInstanceStartDate",mapping:"ristart",type:"date",dateFormat:"c",useNull:!0},REditMode:{name:"REditMode",mapping:"redit",type:"string",useNull:!0}},Ext.ns("Extensible.calendar.data"),Extensible.calendar.data.CalendarMappings={CalendarId:{name:"CalendarId",mapping:"_ref",type:"string"},Title:{name:"Title",mapping:"Name",type:"string"},Description:{name:"Description",mapping:"Desription",type:"string"},ColorId:{name:"ColorId",mapping:"DisplayColor",type:"int"},IsHidden:{name:"IsHidden",mapping:"hidden",type:"boolean"}},Ext.define("Extensible.calendar.template.BoxLayout",{extend:"Ext.XTemplate",requires:["Ext.Date"],firstWeekDateFormat:"D j",otherWeeksDateFormat:"j",singleDayDateFormat:"l, F j, Y",multiDayFirstDayFormat:"M j, Y",multiDayMonthStartFormat:"M j",constructor:function(config){Ext.apply(this,config);var weekLinkTpl=this.showWeekLinks?'<div id="{weekLinkId}" class="ext-cal-week-link">{weekNum}</div>':"";Extensible.calendar.template.BoxLayout.superclass.constructor.call(this,'<tpl for="weeks">','<div id="{[this.id]}-wk-{[xindex-1]}" class="ext-cal-wk-ct" style="top:{[this.getRowTop(xindex, xcount)]}%; height:{[this.getRowHeight(xcount)]}%;">',weekLinkTpl,'<table class="ext-cal-bg-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for=".">','<td id="{[this.id]}-day-{date:date("Ymd")}" class="{cellCls}">&#160;</td>',"</tpl>","</tr>","</tbody>","</table>",'<table class="ext-cal-evt-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for=".">','<td id="{[this.id]}-ev-day-{date:date("Ymd")}" class="{titleCls}"><div>{title}</div></td>',"</tpl>","</tr>","</tbody>","</table>","</div>","</tpl>",{getRowTop:function(i,ln){return(i-1)*(100/ln)},getRowHeight:function(ln){return 100/ln}})},applyTemplate:function(o){Ext.apply(this,o);for(var w=0,title="",first=!0,isToday=!1,showMonth=!1,prevMonth=!1,nextMonth=!1,isWeekend=!1,weekendCls=o.weekendCls,prevMonthCls=o.prevMonthCls,nextMonthCls=o.nextMonthCls,todayCls=o.todayCls,weeks=[[]],today=Extensible.Date.today(),dt=Ext.Date.clone(this.viewStart),thisMonth=this.startDate.getMonth();(this.weekCount>w||-1===this.weekCount)&&!(dt>this.viewEnd);w++){weeks[w]=[];for(var d=0;this.dayCount>d;d++){if(isToday=dt.getTime()===today.getTime(),showMonth=first||1===dt.getDate(),prevMonth=thisMonth>dt.getMonth()&&-1===this.weekCount,nextMonth=dt.getMonth()>thisMonth&&-1===this.weekCount,isWeekend=0===dt.getDay()%6,1===dt.getDay()&&(weeks[w].weekNum=this.showWeekNumbers?Ext.Date.format(dt,"W"):"&#160;",weeks[w].weekLinkId="ext-cal-week-"+Ext.Date.format(dt,"Ymd")),showMonth)title=isToday?this.getTodayText():Ext.Date.format(dt,1===this.dayCount?this.singleDayDateFormat:first?this.multiDayFirstDayFormat:this.multiDayMonthStartFormat);else{var dayFmt=0===w&&this.showHeader!==!0?this.firstWeekDateFormat:this.otherWeeksDateFormat;title=isToday?this.getTodayText():Ext.Date.format(dt,dayFmt)}weeks[w].push({title:title,date:Ext.Date.clone(dt),titleCls:"ext-cal-dtitle "+(isToday?" ext-cal-dtitle-today":"")+(0===w?" ext-cal-dtitle-first":"")+(prevMonth?" ext-cal-dtitle-prev":"")+(nextMonth?" ext-cal-dtitle-next":""),cellCls:"ext-cal-day "+(isToday?" "+todayCls:"")+(0===d?" ext-cal-day-first":"")+(prevMonth?" "+prevMonthCls:"")+(nextMonth?" "+nextMonthCls:"")+(isWeekend&&weekendCls?" "+weekendCls:"")}),dt=Extensible.Date.add(dt,{days:1}),first=!1}}return Ext.getVersion("extjs").isLessThan("4.1")?Extensible.calendar.template.BoxLayout.superclass.applyTemplate.call(this,{weeks:weeks}):this.applyOut({weeks:weeks},[]).join("")},getTodayText:function(){var timeFmt=Extensible.Date.use24HourTime?"G:i ":"g:ia ",todayText=this.showTodayText!==!1?this.todayText:"",timeText=this.showTime!==!1?' <span id="'+this.id+'-clock" class="ext-cal-dtitle-time" aria-live="off">'+Ext.Date.format(new Date,timeFmt)+"</span>":"",separator=todayText.length>0||timeText.length>0?" &#8212; ":"";if(1===this.dayCount)return Ext.Date.format(new Date,this.singleDayDateFormat)+separator+todayText+timeText;var fmt=1===this.weekCount?this.firstWeekDateFormat:this.otherWeeksDateFormat;return todayText.length>0?todayText+timeText:Ext.Date.format(new Date,fmt)+timeText}},function(){this.createAlias("apply","applyTemplate")}),Ext.define("Extensible.calendar.template.DayHeader",{extend:"Ext.XTemplate",requires:["Extensible.calendar.template.BoxLayout"],constructor:function(config){Ext.apply(this,config),this.allDayTpl=Ext.create("Extensible.calendar.template.BoxLayout",config),this.allDayTpl.compile(),Extensible.calendar.template.DayHeader.superclass.constructor.call(this,'<div class="ext-cal-hd-ct">','<table class="ext-cal-hd-days-tbl" cellspacing="0" cellpadding="0">',"<tbody>","<tr>",'<td class="ext-cal-gutter"></td>','<td class="ext-cal-hd-days-td"><div class="ext-cal-hd-ad-inner">{allDayTpl}</div></td>','<td class="ext-cal-gutter-rt"></td>',"</tr>","</tbody>","</table>","</div>")},applyTemplate:function(o){var templateConfig={allDayTpl:this.allDayTpl.apply(o)};return Ext.getVersion("extjs").isLessThan("4.1")?Extensible.calendar.template.DayHeader.superclass.applyTemplate.call(this,templateConfig):this.applyOut(templateConfig,[]).join("")}},function(){this.createAlias("apply","applyTemplate")}),Ext.define("Extensible.calendar.template.DayBody",{extend:"Ext.XTemplate",constructor:function(config){Ext.apply(this,config),Extensible.calendar.template.DayBody.superclass.constructor.call(this,'<table class="ext-cal-bg-tbl" cellspacing="0" cellpadding="0" style="height:{dayHeight}px;">',"<tbody>",'<tr height="1">','<td class="ext-cal-gutter"></td>','<td colspan="{dayCount}">','<div class="ext-cal-bg-rows">','<div class="ext-cal-bg-rows-inner">','<tpl for="times">','<div class="ext-cal-bg-row ext-row-{[xindex]}" style="height:{parent.hourHeight}px;">','<div class="ext-cal-bg-row-div {parent.hourSeparatorCls}" style="height:{parent.hourSeparatorHeight}px;"></div>',"</div>","</tpl>","</div>","</div>","</td>","</tr>","<tr>",'<td class="ext-cal-day-times">','<tpl for="times">','<div class="ext-cal-bg-row" style="height:{parent.hourHeight}px;">','<div class="ext-cal-day-time-inner"  style="height:{parent.hourHeight-1}px;">{.}</div>',"</div>","</tpl>","</td>",'<tpl for="days">','<td class="ext-cal-day-col">','<div class="ext-cal-day-col-inner">','<div id="{[this.id]}-day-col-{.:date("Ymd")}" class="ext-cal-day-col-gutter" style="height:{parent.dayHeight}px;"></div>',"</div>","</td>","</tpl>","</tr>","</tbody>","</table>")},applyTemplate:function(o){this.today=Extensible.Date.today(),this.dayCount=this.dayCount||1;for(var i=0,days=[],dt=Ext.Date.clone(o.viewStart);this.dayCount>i;i++)days[i]=Extensible.Date.add(dt,{days:i});var times=[],start=this.viewStartHour,end=this.viewEndHour,mins=this.hourIncrement,dayHeight=this.hourHeight*(end-start),fmt=Extensible.Date.use24HourTime?"G:i":"ga",templateConfig;for(dt=Extensible.Date.add(new Date("5/26/1972"),{hours:start}),i=start;end>i;i++)times.push(Ext.Date.format(dt,fmt)),dt=Extensible.Date.add(dt,{minutes:mins});return templateConfig={days:days,dayCount:days.length,times:times,hourHeight:this.hourHeight,hourSeparatorCls:this.showHourSeparator?"":"no-sep",dayHeight:dayHeight,hourSeparatorHeight:this.hourHeight/2},Ext.getVersion("extjs").isLessThan("4.1")?Extensible.calendar.template.DayBody.superclass.applyTemplate.call(this,templateConfig):this.applyOut(templateConfig,[]).join("")}},function(){this.createAlias("apply","applyTemplate")}),Ext.define("Extensible.calendar.template.Month",{extend:"Ext.XTemplate",requires:["Extensible.calendar.template.BoxLayout"],dayHeaderFormat:"D",dayHeaderTitleFormat:"l, F j, Y",constructor:function(config){Ext.apply(this,config),this.weekTpl=Ext.create("Extensible.calendar.template.BoxLayout",config),this.weekTpl.compile();var weekLinkTpl=this.showWeekLinks?'<div class="ext-cal-week-link-hd">&#160;</div>':"";Extensible.calendar.template.Month.superclass.constructor.call(this,'<div class="ext-cal-inner-ct {extraClasses}">','<div class="ext-cal-hd-ct ext-cal-month-hd">',weekLinkTpl,'<table class="ext-cal-hd-days-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for="days">','<th class="ext-cal-hd-day{[xindex==1 ? " ext-cal-day-first" : ""]}" title="{title}">{name}</th>',"</tpl>","</tr>","</tbody>","</table>","</div>",'<div class="ext-cal-body-ct">{weeks}</div>',"</div>")},applyTemplate:function(o){for(var days=[],weeks=this.weekTpl.apply(o),dt=o.viewStart,D=Extensible.Date,templateConfig,i=0;7>i;i++){var d=D.add(dt,{days:i});days.push({name:Ext.Date.format(d,this.dayHeaderFormat),title:Ext.Date.format(d,this.dayHeaderTitleFormat)})}var extraClasses=this.showHeader===!0?"":"ext-cal-noheader";return this.showWeekLinks&&(extraClasses+=" ext-cal-week-links"),templateConfig={days:days,weeks:weeks,extraClasses:extraClasses},Ext.getVersion("extjs").isLessThan("4.1")?Extensible.calendar.template.Month.superclass.applyTemplate.call(this,templateConfig):this.applyOut(templateConfig,[]).join("")}},function(){this.createAlias("apply","applyTemplate")}),Ext.define("Ext.dd.ScrollManager",{singleton:!0,requires:["Ext.dd.DragDropManager"],constructor:function(){var ddm=Ext.dd.DragDropManager;ddm.fireEvents=Ext.Function.createSequence(ddm.fireEvents,this.onFire,this),ddm.stopDrag=Ext.Function.createSequence(ddm.stopDrag,this.onStop,this),this.doScroll=Ext.Function.bind(this.doScroll,this),this.ddmInstance=ddm,this.els={},this.dragEl=null,this.proc={}},onStop:function(e){this.dragEl=null,this.clearProc()},triggerRefresh:function(){this.ddmInstance.dragCurrent&&this.ddmInstance.refreshCache(this.ddmInstance.dragCurrent.groups)},doScroll:function(){if(this.ddmInstance.dragCurrent){var proc=this.proc,procEl=proc.el,ddScrollConfig=proc.el.ddScrollConfig,inc=ddScrollConfig?ddScrollConfig.increment:this.increment;this.animate?procEl.scroll(proc.dir,inc,!0,this.animDuration,this.triggerRefresh):procEl.scroll(proc.dir,inc)&&this.triggerRefresh()}},clearProc:function(){var proc=this.proc;proc.id&&clearInterval(proc.id),proc.id=0,proc.el=null,proc.dir=""},startProc:function(el,dir){this.clearProc(),this.proc.el=el,this.proc.dir=dir;var group=el.ddScrollConfig?el.ddScrollConfig.ddGroup:void 0,freq=el.ddScrollConfig&&el.ddScrollConfig.frequency?el.ddScrollConfig.frequency:this.frequency;(void 0===group||this.ddmInstance.dragCurrent.ddGroup===group)&&(this.proc.id=setInterval(this.doScroll,freq))},onFire:function(e,isDrop){if(!isDrop&&this.ddmInstance.dragCurrent){this.dragEl&&this.dragEl===this.ddmInstance.dragCurrent||(this.dragEl=this.ddmInstance.dragCurrent,this.refreshCache());var xy=e.getXY(),pt=e.getPoint(),proc=this.proc,els=this.els;for(var id in els){var el=els[id],r=el._region,c=el.ddScrollConfig?el.ddScrollConfig:this;if(r&&r.contains(pt)&&el.isScrollable()){if(r.bottom-pt.y<=c.vthresh)return proc.el!==el&&this.startProc(el,"down"),void 0;if(r.right-pt.x<=c.hthresh)return proc.el!==el&&this.startProc(el,"left"),void 0;if(pt.y-r.top<=c.vthresh)return proc.el!==el&&this.startProc(el,"up"),void 0;if(pt.x-r.left<=c.hthresh)return proc.el!==el&&this.startProc(el,"right"),void 0}}this.clearProc()}},register:function(el){if(Ext.isArray(el))for(var i=0,len=el.length;len>i;i++)this.register(el[i]);else el=Ext.get(el),this.els[el.id]=el},unregister:function(el){if(Ext.isArray(el))for(var i=0,len=el.length;len>i;i++)this.unregister(el[i]);else el=Ext.get(el),delete this.els[el.id]},vthresh:25,hthresh:25,increment:100,frequency:500,animate:!0,animDuration:.4,ddGroup:void 0,refreshCache:function(){var els=this.els,id;for(id in els)"object"==typeof els[id]&&(els[id]._region=els[id].getRegion())}}),Ext.define("Extensible.calendar.dd.StatusProxy",{extend:"Ext.dd.StatusProxy",moveEventCls:"ext-cal-dd-move",addEventCls:"ext-cal-dd-add",renderTpl:['<div class="'+Ext.baseCSSPrefix+'dd-drop-icon"></div>','<div class="ext-dd-ghost-ct">','<div id="{id}-ghost" class="'+Ext.baseCSSPrefix+'dd-drag-ghost"></div>','<div id="{id}-message" class="ext-dd-msg"></div>',"</div>"],childEls:["ghost","message"],constructor:function(config){Ext.getVersion("extjs").isLessThan("4.1")?this.preComponentConstructor(config):this.callParent(arguments)},preComponentConstructor:function(config){var me=this;Ext.apply(me,config),me.id=me.id||Ext.id(),me.proxy=Ext.createWidget("component",{floating:!0,id:me.id||Ext.id(),html:me.renderTpl.join(""),cls:Ext.baseCSSPrefix+"dd-drag-proxy "+me.dropNotAllowed,shadow:!config||config.shadow!==!1,renderTo:document.body}),me.el=me.proxy.el,me.el.show(),me.el.setVisibilityMode(Ext.Element.VISIBILITY),me.el.hide(),me.ghost=Ext.get(me.el.dom.childNodes[1].childNodes[0]),me.message=Ext.get(me.el.dom.childNodes[1].childNodes[1]),me.dropStatus=me.dropNotAllowed},update:function(html){this.callParent(arguments);var el=this.ghost.dom.firstChild;el&&Ext.fly(el).setHeight("auto")},updateMsg:function(msg){this.message.update(msg)}}),Ext.define("Extensible.calendar.dd.DragZone",{extend:"Ext.dd.DragZone",requires:["Ext.util.Point","Extensible.calendar.dd.StatusProxy","Extensible.calendar.data.EventMappings"],ddGroup:"CalendarDD",eventSelector:".ext-cal-evt",eventSelectorDepth:10,constructor:function(el,config){Extensible.calendar._statusProxyInstance||(Extensible.calendar._statusProxyInstance=Ext.create("Extensible.calendar.dd.StatusProxy")),this.proxy=Extensible.calendar._statusProxyInstance,this.callParent(arguments)},getDragData:function(e){var t=e.getTarget(this.eventSelector,this.eventSelectorDepth);if(t){var rec=this.view.getEventRecordFromEl(t);if(!rec)return;return{type:"eventdrag",ddel:t,eventStart:rec.data[Extensible.calendar.data.EventMappings.StartDate.name],eventEnd:rec.data[Extensible.calendar.data.EventMappings.EndDate.name],proxy:this.proxy}}return t=this.view.getDayAt(e.getX(),e.getY()),t.el?{type:"caldrag",start:t.date,proxy:this.proxy}:null},onInitDrag:function(x,y){if(this.dragData.ddel){var ghost=this.dragData.ddel.cloneNode(!0),child=Ext.fly(ghost).down("dl");Ext.fly(ghost).setWidth("auto"),child&&child.setHeight("auto"),this.proxy.update(ghost),this.onStartDrag(x,y)}else this.dragData.start&&this.onStartDrag(x,y);return this.view.onInitDrag(),!0},afterRepair:function(){Ext.enableFx&&this.dragData.ddel&&Ext.fly(this.dragData.ddel).highlight(this.hlColor||"c3daf9"),this.dragging=!1},getRepairXY:function(e){return this.dragData.ddel?Ext.fly(this.dragData.ddel).getXY():void 0},afterInvalidDrop:function(e,id){Ext.select(".ext-dd-shim").hide()},destroy:function(){this.callParent(arguments),delete Extensible.calendar._statusProxyInstance}}),Ext.define("Extensible.calendar.dd.DropZone",{extend:"Ext.dd.DropZone",requires:["Ext.Layer","Extensible.calendar.data.EventMappings"],ddGroup:"CalendarDD",eventSelector:".ext-cal-evt",dateRangeFormat:"{0}-{1}",dateFormat:"n/j",shims:[],getTargetFromEvent:function(e){var dragOffset=this.dragOffset||0,y=e.getPageY()-dragOffset,d=this.view.getDayAt(e.getPageX(),y);return d.el?d:null},onNodeOver:function(n,dd,e,data){var D=Extensible.Date,eventDragText=e.ctrlKey||e.altKey?this.copyText:this.moveText,start="eventdrag"===data.type?n.date:D.min(data.start,n.date),end="eventdrag"===data.type?D.add(n.date,{days:D.diffDays(data.eventStart,data.eventEnd)}):D.max(data.start,n.date);if(!this.dragStartDate||!this.dragEndDate||0!==D.diffDays(start,this.dragStartDate)||0!==D.diffDays(end,this.dragEndDate)){this.dragStartDate=start,this.dragEndDate=D.add(end,{days:1,millis:-1,clearTime:!0}),this.shim(start,end);var range=Ext.Date.format(start,this.dateFormat);D.diffDays(start,end)>0&&(end=Ext.Date.format(end,this.dateFormat),range=Ext.String.format(this.dateRangeFormat,range,end)),this.currentRange=range}return data.proxy.updateMsg(Ext.String.format("eventdrag"===data.type?eventDragText:this.createText,this.currentRange)),this.dropAllowed},shim:function(start,end){this.DDMInstance.notifyOccluded=!0,this.currWeek=-1;var dt=Ext.Date.clone(start),i=0,shim,box,D=Extensible.Date,cnt=D.diffDays(dt,end)+1;for(Ext.each(this.shims,function(shim){shim&&(shim.isActive=!1)});cnt>i++;){var dayEl=this.view.getDayEl(dt);if(dayEl){var wk=this.view.getWeekIndex(dt);shim=this.shims[wk],shim||(shim=this.createShim(),this.shims[wk]=shim),wk!==this.currWeek?(shim.boxInfo=dayEl.getBox(),this.currWeek=wk):(box=dayEl.getBox(),shim.boxInfo.right=box.right,shim.boxInfo.width=box.right-shim.boxInfo.x),shim.isActive=!0}dt=D.add(dt,{days:1})}Ext.each(this.shims,function(shim){shim&&(shim.isActive?(shim.show(),shim.setBox(shim.boxInfo)):shim.isVisible()&&shim.hide())})},createShim:function(){var owner=this.view.ownerCalendarPanel?this.view.ownerCalendarPanel:this.view;this.shimCt||(this.shimCt=Ext.get("ext-dd-shim-ct-"+owner.id),this.shimCt||(this.shimCt=document.createElement("div"),this.shimCt.id="ext-dd-shim-ct-"+owner.id,owner.getEl().parent().appendChild(this.shimCt)));var el=document.createElement("div");return el.className="ext-dd-shim",this.shimCt.appendChild(el),Ext.create("Ext.Layer",{shadow:!1,useDisplay:!0,constrain:!1},el)},clearShims:function(){Ext.each(this.shims,function(shim){shim&&shim.hide()}),this.DDMInstance.notifyOccluded=!1},onContainerOver:function(dd,e,data){return this.dropAllowed},onCalendarDragComplete:function(){delete this.dragStartDate,delete this.dragEndDate,this.clearShims()},onNodeDrop:function(n,dd,e,data){if(n&&data){if("eventdrag"===data.type){var rec=this.view.getEventRecordFromEl(data.ddel),dt=Extensible.Date.copyTime(rec.data[Extensible.calendar.data.EventMappings.StartDate.name],n.date);return this.view.onEventDrop(rec,dt,e.ctrlKey||e.altKey?"copy":"move"),this.onCalendarDragComplete(),!0}if("caldrag"===data.type)return this.dragEndDate||(this.dragStartDate=Ext.Date.clearTime(data.start),this.dragEndDate=Extensible.Date.add(this.dragStartDate,{days:1,millis:-1,clearTime:!0})),this.view.onCalendarEndDrag(this.dragStartDate,this.dragEndDate,Ext.bind(this.onCalendarDragComplete,this)),!0}return this.onCalendarDragComplete(),!1},onContainerDrop:function(dd,e,data){return this.onCalendarDragComplete(),!1},destroy:function(){Ext.each(this.shims,function(shim){shim&&Ext.destroy(shim)}),Ext.removeNode(this.shimCt),delete this.shimCt,this.shims.length=0}}),Ext.define("Extensible.calendar.dd.DayDragZone",{extend:"Extensible.calendar.dd.DragZone",ddGroup:"DayViewDD",resizeSelector:".ext-evt-rsz",getDragData:function(e){var target=e.getTarget(this.resizeSelector,2,!0),rec,parent;if(target){if(parent=target.parent(this.eventSelector),rec=this.view.getEventRecordFromEl(parent),!rec)return;return{type:"eventresize",xy:e.getXY(),ddel:parent.dom,eventStart:rec.data[Extensible.calendar.data.EventMappings.StartDate.name],eventEnd:rec.data[Extensible.calendar.data.EventMappings.EndDate.name],proxy:this.proxy}}if(target=e.getTarget(this.eventSelector,this.eventSelectorDepth)){if(rec=this.view.getEventRecordFromEl(target),!rec)return;return{type:"eventdrag",xy:e.getXY(),ddel:target,eventStart:rec.data[Extensible.calendar.data.EventMappings.StartDate.name],eventEnd:rec.data[Extensible.calendar.data.EventMappings.EndDate.name],proxy:this.proxy}}return target=this.view.getDayAt(e.getX(),e.getY()),target.el?{type:"caldrag",dayInfo:target,proxy:this.proxy}:null}}),Ext.define("Extensible.calendar.dd.DayDropZone",{extend:"Extensible.calendar.dd.DropZone",ddGroup:"DayViewDD",dateRangeFormat:"{0}-{1}",dateFormat:"n/j",onNodeOver:function(n,dd,e,data){var dt,box,diff,curr,text=this.createText,timeFormat=Extensible.Date.use24HourTime?"G:i":"g:ia";if("caldrag"===data.type){this.dragStartMarker||(this.dragStartMarker=n.el.parent().createChild({style:"position:absolute;"}),this.dragStartMarker.setBox(data.dayInfo.timeBox),this.dragCreateDt=data.dayInfo.date);var endDt;box=this.dragStartMarker.getBox(),box.height=Math.ceil(Math.abs(e.getY()-box.y)/n.timeBox.height)*n.timeBox.height,e.getY()<box.y?(box.height+=n.timeBox.height,box.y=box.y-box.height+n.timeBox.height,endDt=Extensible.Date.add(this.dragCreateDt,{minutes:this.ddIncrement})):n.date=Extensible.Date.add(n.date,{minutes:this.ddIncrement}),this.shim(this.dragCreateDt,box),diff=Extensible.Date.diff(this.dragCreateDt,n.date),curr=Extensible.Date.add(this.dragCreateDt,{millis:diff}),this.dragStartDate=Extensible.Date.min(this.dragCreateDt,curr),this.dragEndDate=endDt||Extensible.Date.max(this.dragCreateDt,curr),dt=Ext.String.format(this.dateRangeFormat,Ext.Date.format(this.dragStartDate,timeFormat),Ext.Date.format(this.dragEndDate,timeFormat))}else{var evtEl=Ext.get(data.ddel),dayCol=evtEl.parent().parent();if(box=evtEl.getBox(),box.width=dayCol.getWidth(),"eventdrag"===data.type){if(void 0===this.dragOffset){var initialTimeBox=this.view.getDayAt(data.xy[0],data.xy[1]).timeBox;this.dragOffset=initialTimeBox.y-box.y}else box.y=n.timeBox.y;dt=Ext.Date.format(n.date,this.dateFormat+" "+timeFormat),box.x=n.el.getLeft(),this.shim(n.date,box),text=e.ctrlKey||e.altKey?this.copyText:this.moveText}if("eventresize"===data.type){this.resizeDt||(this.resizeDt=n.date),box.x=dayCol.getLeft(),box.height=Math.ceil(Math.abs(e.getY()-box.y)/n.timeBox.height)*n.timeBox.height,e.getY()<box.y?box.y-=box.height:n.date=Extensible.Date.add(n.date,{minutes:this.ddIncrement}),this.shim(this.resizeDt,box),diff=Extensible.Date.diff(this.resizeDt,n.date),curr=Extensible.Date.add(this.resizeDt,{millis:diff});var start=Extensible.Date.min(data.eventStart,curr),end=Extensible.Date.max(data.eventStart,curr),startDateName=Extensible.calendar.data.EventMappings.StartDate.name,endDateName=Extensible.calendar.data.EventMappings.EndDate.name;data.resizeDates={},data.resizeDates[startDateName]=start,data.resizeDates[endDateName]=end,dt=Ext.String.format(this.dateRangeFormat,Ext.Date.format(start,timeFormat),Ext.Date.format(end,timeFormat)),text=this.resizeText}}return data.proxy.updateMsg(Ext.String.format(text,dt)),this.dropAllowed},shim:function(dt,box){this.DDMInstance.notifyOccluded=!0,Ext.each(this.shims,function(shim){shim&&(shim.isActive=!1,shim.hide())});var shim=this.shims[0];shim||(shim=this.createShim(),this.shims[0]=shim),shim.isActive=!0,shim.show(),shim.setBox(box)},onNodeDrop:function(n,dd,e,data){if(n&&data){var rec;if("eventdrag"===data.type)return rec=this.view.getEventRecordFromEl(data.ddel),this.view.onEventDrop(rec,n.date,e.ctrlKey||e.altKey?"copy":"move"),this.onCalendarDragComplete(),delete this.dragOffset,!0;if("eventresize"===data.type)return rec=this.view.getEventRecordFromEl(data.ddel),this.view.onEventResize(rec,data.resizeDates),this.onCalendarDragComplete(),delete this.resizeDt,!0;if("caldrag"===data.type)return Ext.destroy(this.dragStartMarker),delete this.dragStartMarker,delete this.dragCreateDt,this.view.onCalendarEndDrag(this.dragStartDate,this.dragEndDate,Ext.bind(this.onCalendarDragComplete,this)),!0}return this.onCalendarDragComplete(),!1}}),Ext.define("Extensible.calendar.data.EventModel",{extend:"Extensible.data.Model",requires:["Extensible.calendar.data.EventMappings"],mappingClass:"Extensible.calendar.data.EventMappings",mappingIdProperty:"EventId",inheritableStatics:{resolution:"minutes"},isRecurring:function(){var RRule=Extensible.calendar.data.EventMappings.RRule;return RRule?!!this.get(RRule.name):!1},getStartDate:function(){return this.get(Extensible.calendar.data.EventMappings.StartDate.name)},getEndDate:function(){var EventMappings=Extensible.calendar.data.EventMappings,duration=EventMappings.Duration?this.get(EventMappings.Duration.name):null;if(null!==duration&&duration>-1){var durationObj={};return durationObj[Extensible.calendar.data.EventModel.resolution]=duration,Extensible.Date.add(this.getStartDate(),durationObj)}return this.get(EventMappings.EndDate.name)},clearRecurrence:function(){var me=this,EventMappings=Extensible.calendar.data.EventMappings;return delete me.data[EventMappings.OriginalEventId.name],delete me.data[EventMappings.RRule.name],delete me.data[EventMappings.RInstanceStartDate.name],delete me.data[EventMappings.REditMode.name],me},getId:function(){return this.get(this.idProperty)}},function(){this.reconfigure()}),Ext.define("Extensible.calendar.data.EventStore",{extend:"Ext.data.Store",model:"Extensible.calendar.data.EventModel",constructor:function(config){config=config||{},this.deferLoad=config.autoLoad,config.autoLoad=!1,this.callParent(arguments)},load:function(o){Extensible.log("store load"),o=o||{},o.params&&delete this.initialParams,this.initialParams&&(o.params=o.params||{},Ext.apply(o.params,this.initialParams),delete this.initialParams),this.callParent(arguments)}}),Ext.define("Extensible.calendar.data.CalendarModel",{extend:"Extensible.data.Model",requires:["Extensible.calendar.data.CalendarMappings"],mappingClass:"Extensible.calendar.data.CalendarMappings",mappingIdProperty:"CalendarId"},function(){this.reconfigure()}),Ext.define("Extensible.calendar.data.MemoryCalendarStore",{extend:"Ext.data.Store",model:"Extensible.calendar.data.CalendarModel",requires:["Ext.data.proxy.Memory","Ext.data.reader.Json","Ext.data.writer.Json","Extensible.calendar.data.CalendarModel","Extensible.calendar.data.CalendarMappings"],proxy:{type:"memory",reader:{type:"json",root:"calendars"},writer:{type:"json"}},autoLoad:!0,initComponent:function(){this.sorters=this.sorters||[{property:Extensible.calendar.data.CalendarMappings.Title.name,direction:"ASC"}],this.idProperty=this.idProperty||Extensible.calendar.data.CalendarMappings.CalendarId.name||"id",this.fields=Extensible.calendar.data.CalendarModel.prototype.fields.getRange(),this.callParent(arguments)
}}),Ext.define("Extensible.calendar.data.MemoryEventStore",{extend:"Ext.data.Store",model:"Extensible.calendar.data.EventModel",requires:["Ext.data.proxy.Memory","Ext.data.reader.Json","Ext.data.writer.Json","Extensible.calendar.data.EventModel","Extensible.calendar.data.EventMappings"],proxy:{type:"memory",reader:{type:"json",root:"evts"},writer:{type:"json"}},idSeed:2e3,constructor:function(config){config=config||{},this.callParent(arguments),this.sorters=this.sorters||[{property:Extensible.calendar.data.EventMappings.StartDate.name,direction:"ASC"}],this.idProperty=this.idProperty||Extensible.calendar.data.EventMappings.EventId.mapping||"id",this.fields=Extensible.calendar.data.EventModel.prototype.fields.getRange(),config.autoMsg!==!1&&this.on("write",this.onWrite,this),this.autoMsg=config.autoMsg,this.onCreateRecords=Ext.Function.createInterceptor(this.onCreateRecords,this.interceptCreateRecords),this.initRecs()},interceptCreateRecords:function(records,operation,success){if(success)for(var i=0,rec,len=records.length;len>i;i++)records[i].data[Extensible.calendar.data.EventMappings.EventId.name]=this.idSeed++},initRecs:function(){this.each(function(rec){rec.store=this,rec.phantom=!1},this)},onWrite:function(store,operation){var me=this;if(Extensible.example&&Extensible.example.msg){var success=operation.wasSuccessful(),rec=operation.records[0],title=rec.data[Extensible.calendar.data.EventMappings.Title.name];switch(operation.action){case"create":Extensible.example.msg("Add",'Added "'+Ext.value(title,"(No title)")+'"');break;case"update":Extensible.example.msg("Update",'Updated "'+Ext.value(title,"(No title)")+'"');break;case"destroy":Extensible.example.msg("Delete",'Deleted "'+Ext.value(title,"(No title)")+'"')}}},onProxyLoad:function(operation){var me=this,successful=operation.wasSuccessful(),resultSet=operation.getResultSet(),records=[];me.data&&me.data.length>0?(me.totalCount=me.data.length,records=me.data.items):(resultSet&&(records=resultSet.records,me.totalCount=resultSet.total),successful&&me.loadRecords(records,operation)),me.loading=!1,me.fireEvent("load",me,records,successful)}}),Ext.define("Extensible.calendar.util.WeekEventRenderer",{requires:["Ext.DomHelper"],statics:{getEventRow:function(viewId,weekIndex,rowIndex){var indexOffset=1,weekRow=Ext.get(viewId+"-wk-"+weekIndex),eventRow,weekTable;return weekRow&&(weekTable=weekRow.child(".ext-cal-evt-tbl",!0),eventRow=weekTable.tBodies[0].childNodes[rowIndex+indexOffset],eventRow||(eventRow=Ext.DomHelper.append(weekTable.tBodies[0],"<tr></tr>"))),Ext.get(eventRow)},renderEvent:function(event,weekIndex,dayIndex,eventIndex,dayCount,currentDate,renderConfig){var eventMappings=Extensible.calendar.data.EventMappings,eventData=event.data||event.event.data,startOfWeek=Ext.Date.clone(currentDate),endOfWeek=Extensible.Date.add(startOfWeek,{days:dayCount-dayIndex,millis:-1}),eventRow=this.getEventRow(renderConfig.viewId,weekIndex,eventIndex),eventEndDate=(event.event||event).getEndDate(),daysToEventEnd=Extensible.Date.diffDays(currentDate,eventEndDate)+1,colspan=Math.min(daysToEventEnd,dayCount-dayIndex);eventData._weekIndex=weekIndex,eventData._renderAsAllDay=eventData[eventMappings.IsAllDay.name]||event.isSpanStart,eventData.spanLeft=eventData[eventMappings.StartDate.name].getTime()<startOfWeek.getTime(),eventData.spanRight=eventEndDate.getTime()>endOfWeek.getTime(),eventData.spanCls=eventData.spanLeft?eventData.spanRight?"ext-cal-ev-spanboth":"ext-cal-ev-spanleft":eventData.spanRight?"ext-cal-ev-spanright":"";var cellConfig={tag:"td",cls:"ext-cal-ev",cn:renderConfig.tpl.apply(renderConfig.templateDataFn(eventData))};colspan>1&&(cellConfig.colspan=colspan),Ext.DomHelper.append(eventRow,cellConfig)},render:function(config){for(var me=this,spaceChar="&#160;",weekIndex=0,eventGrid=config.eventGrid,currentDate=Ext.Date.clone(config.viewStart),currentDateString="",eventTpl=config.tpl,maxEventsPerDay=void 0!==config.maxEventsPerDay?config.maxEventsPerDay:999,weekCount=1>config.weekCount?6:config.weekCount,dayCount=1===config.weekCount?config.dayCount:7,eventRow,dayIndex,weekGrid,eventIndex,skippedEventCount,dayGrid,eventCount,currentEvent,cellConfig,eventData;weekCount>weekIndex;weekIndex++)for(dayIndex=0,weekGrid=eventGrid[weekIndex];dayCount>dayIndex;dayIndex++){if(currentDateString=Ext.Date.format(currentDate,"Ymd"),weekGrid&&weekGrid[dayIndex]){for(eventIndex=0,skippedEventCount=0,dayGrid=weekGrid[dayIndex],eventCount=dayGrid.length;eventCount>eventIndex;eventIndex++)if(dayGrid[eventIndex]){if(eventIndex>=maxEventsPerDay){skippedEventCount++;continue}currentEvent=dayGrid[eventIndex],(!currentEvent.isSpan||currentEvent.isSpanStart)&&me.renderEvent(currentEvent,weekIndex,dayIndex,eventIndex,dayCount,currentDate,config)}else{if(eventIndex>=maxEventsPerDay)continue;eventRow=me.getEventRow(config.viewId,weekIndex,eventIndex),Ext.DomHelper.append(eventRow,{tag:"td",cls:"ext-cal-ev",html:spaceChar,id:config.viewId+"-empty-"+eventCount+"-day-"+currentDateString})}if(skippedEventCount>0)eventRow=me.getEventRow(config.viewId,weekIndex,maxEventsPerDay),Ext.DomHelper.append(eventRow,{tag:"td",cls:"ext-cal-ev-more",id:"ext-cal-ev-more-"+Ext.Date.format(currentDate,"Ymd"),cn:{tag:"a",html:Ext.String.format(config.getMoreText(skippedEventCount),skippedEventCount)}});else if(config.evtMaxCount[weekIndex]>eventCount&&(eventRow=me.getEventRow(config.viewId,weekIndex,eventCount))){cellConfig={tag:"td",cls:"ext-cal-ev",html:spaceChar,id:config.viewId+"-empty-"+(eventCount+1)+"-day-"+currentDateString};var rowspan=config.evtMaxCount[weekIndex]-eventCount;rowspan>1&&(cellConfig.rowspan=rowspan),Ext.DomHelper.append(eventRow,cellConfig)}}else eventRow=me.getEventRow(config.viewId,weekIndex,0),eventRow&&(cellConfig={tag:"td",cls:"ext-cal-ev",html:spaceChar,id:config.viewId+"-empty-day-"+currentDateString},config.evtMaxCount[weekIndex]>1&&(cellConfig.rowspan=config.evtMaxCount[weekIndex]),Ext.DomHelper.append(eventRow,cellConfig));currentDate=Extensible.Date.add(currentDate,{days:1})}}}}),Ext.define("Extensible.calendar.form.field.CalendarCombo",{extend:"Ext.form.field.ComboBox",alias:"widget.extensible.calendarcombo",requires:["Extensible.calendar.data.CalendarMappings"],fieldLabel:"Calendar",triggerAction:"all",queryMode:"local",forceSelection:!0,selectOnFocus:!0,defaultCls:"x-cal-default",hiddenCalendarCls:"ext-cal-hidden",initComponent:function(){this.valueField=Extensible.calendar.data.CalendarMappings.CalendarId.name,this.displayField=Extensible.calendar.data.CalendarMappings.Title.name,this.listConfig=Ext.apply(this.listConfig||{},{getInnerTpl:this.getListItemTpl}),this.store.on("update",this.refreshColorCls,this),this.callParent(arguments)},getListItemTpl:function(displayField){return'<div class="x-combo-list-item x-cal-{'+Extensible.calendar.data.CalendarMappings.ColorId.name+'}"><div class="ext-cal-picker-icon">&#160;</div>{'+displayField+"}</div>"},afterRender:function(){this.callParent(arguments),this.wrap=this.el.down(".x-form-item-body"),this.wrap.addCls("ext-calendar-picker"),this.icon=Ext.core.DomHelper.append(this.wrap,{tag:"div",cls:"ext-cal-picker-icon ext-cal-picker-mainicon"})},refreshColorCls:function(){var me=this,calendarMappings=Extensible.calendar.data.CalendarMappings,colorCls="",value=me.getValue();return me.wrap?(void 0!==me.currentStyleClss&&me.wrap.removeCls(me.currentStyleClss),Ext.isEmpty(value)||(Ext.isArray(value)&&(value=value[0]),value.data||(value=this.store.findRecord(calendarMappings.CalendarId.name,value)),colorCls="x-cal-"+(value.data?value.data[calendarMappings.ColorId.name]:value)),me.currentStyleClss=colorCls,me.wrap.addCls(colorCls),me):me},setValue:function(value){!value&&this.store.getCount()>0&&(value=this.store.getAt(0).data[Extensible.calendar.data.CalendarMappings.CalendarId.name]),this.callParent(arguments),this.refreshColorCls()}}),Ext.define("Extensible.form.field.DateRange",{extend:"Ext.form.FieldContainer",alias:"widget.extensible.daterangefield",requires:["Ext.form.field.Date","Ext.form.field.Time","Ext.form.Label","Ext.form.field.Checkbox"],toText:"to",allDayText:"All day",singleLine:!0,dateFormat:"j/n/y",startDay:0,fieldLayout:{type:"hbox",defaultMargins:{top:0,right:5,bottom:0,left:0}},initComponent:function(){var me=this;me.timeFormat=me.timeFormat||(Extensible.Date.use24HourTime?"G:i":"g:i A"),me.addCls("ext-dt-range"),me.singleLine?(me.layout=me.fieldLayout,me.items=me.getFieldConfigs()):me.items=[{xtype:"container",layout:me.fieldLayout,items:[me.getStartDateConfig(),me.getStartTimeConfig(),me.getDateSeparatorConfig()]},{xtype:"container",layout:me.fieldLayout,items:[me.getEndDateConfig(),me.getEndTimeConfig(),me.getAllDayConfig()]}],me.callParent(arguments),me.initRefs()},initRefs:function(){var me=this;me.startDate=me.down("#"+me.id+"-start-date"),me.startTime=me.down("#"+me.id+"-start-time"),me.endTime=me.down("#"+me.id+"-end-time"),me.endDate=me.down("#"+me.id+"-end-date"),me.allDay=me.down("#"+me.id+"-allday"),me.toLabel=me.down("#"+me.id+"-to-label")},getFieldConfigs:function(){var me=this;return[me.getStartDateConfig(),me.getStartTimeConfig(),me.getDateSeparatorConfig(),me.getEndTimeConfig(),me.getEndDateConfig(),me.getAllDayConfig()]},getLayoutItems:function(singleLine){var me=this;return singleLine?me.items.items:[[me.startDate,me.startTime,me.toLabel],[me.endDate,me.endTime,me.allDay]]},getStartDateConfig:function(){return{xtype:"datefield",id:this.id+"-start-date",format:this.dateFormat,width:100,startDay:this.startDay,listeners:{change:{fn:function(){this.onFieldChange("date","start")},scope:this}}}},getStartTimeConfig:function(){return{xtype:"timefield",id:this.id+"-start-time",hidden:this.showTimes===!1,labelWidth:0,hideLabel:!0,width:90,format:this.timeFormat,listeners:{select:{fn:function(){this.onFieldChange("time","start")},scope:this}}}},getEndDateConfig:function(){return{xtype:"datefield",id:this.id+"-end-date",format:this.dateFormat,hideLabel:!0,width:100,startDay:this.startDay,listeners:{change:{fn:function(){this.onFieldChange("date","end")},scope:this}}}},getEndTimeConfig:function(){return{xtype:"timefield",id:this.id+"-end-time",hidden:this.showTimes===!1,labelWidth:0,hideLabel:!0,width:90,format:this.timeFormat,listeners:{select:{fn:function(){this.onFieldChange("time","end")},scope:this}}}},getAllDayConfig:function(){return{xtype:"checkbox",id:this.id+"-allday",hidden:this.showTimes===!1||this.showAllDay===!1,boxLabel:this.allDayText,margins:{top:2,right:5,bottom:0,left:0},handler:this.onAllDayChange,scope:this}},onAllDayChange:function(chk,checked){this.startTime.setVisible(!checked),this.endTime.setVisible(!checked)},getDateSeparatorConfig:function(){return{xtype:"label",id:this.id+"-to-label",text:this.toText,margins:{top:4,right:5,bottom:0,left:0}}},isSingleLine:function(){var me=this;if(void 0===me.calculatedSingleLine)if("auto"===me.singleLine){var ownerCtEl=me.ownerCt.getEl(),w=me.ownerCt.getWidth()-ownerCtEl.getPadding("lr"),el=ownerCtEl.down(".x-panel-body");el&&(w-=el.getPadding("lr")),el=ownerCtEl.down(".x-form-item-label"),el&&(w-=el.getWidth()-el.getPadding("lr")),me.calculatedSingleLine=me.singleLineMinWidth>=w?!1:!0}else me.calculatedSingleLine=void 0!==me.singleLine?me.singleLine:!0;return me.calculatedSingleLine},onFieldChange:function(type,startend){this.checkDates(type,startend),this.fireEvent("change",this,this.getValue())},checkDates:function(type,startend){var me=this,typeCap="date"===type?"Date":"Time",startField=this["start"+typeCap],endField=this["end"+typeCap],startValue=me.getDT("start"),endValue=me.getDT("end");startValue>endValue&&("start"===startend?endField.setValue(startValue):(startField.setValue(endValue),me.checkDates(type,"start"))),"date"===type&&me.checkDates("time",startend)},getValue:function(){return[this.getDT("start"),this.getDT("end"),this.allDay.getValue()]},getDT:function(startend){var time=this[startend+"Time"].getValue(),dt=this[startend+"Date"].getValue();if(!Ext.isDate(dt))return null;if(dt=Ext.Date.format(dt,this[startend+"Date"].format),time&&""!==time){time=Ext.Date.format(time,this[startend+"Time"].format);var val=Ext.Date.parseDate(dt+" "+time,this[startend+"Date"].format+" "+this[startend+"Time"].format);return val}return Ext.Date.parseDate(dt,this[startend+"Date"].format)},setValue:function(v){if(v){var me=this,eventMappings=Extensible.calendar.data.EventMappings,startDateName=eventMappings.StartDate.name;Ext.isArray(v)?(me.setDT(v[0],"start"),me.setDT(v[1],"end"),me.allDay.setValue(!!v[2])):Ext.isDate(v)?(me.setDT(v,"start"),me.setDT(v,"end"),me.allDay.setValue(!1)):v[startDateName]&&(me.setDT(v[startDateName],"start"),me.setDT(v[eventMappings.EndDate.name],"end")||me.setDT(v[startDateName],"end"),me.allDay.setValue(!!v[eventMappings.IsAllDay.name]))}},setDT:function(dt,startend){return dt&&Ext.isDate(dt)?(this[startend+"Date"].setValue(dt),this[startend+"Time"].setValue(Ext.Date.format(dt,this[startend+"Time"].format)),!0):void 0},isDirty:function(){var dirty=!1;return this.rendered&&!this.disabled&&this.items.each(function(item){return item.isDirty()?(dirty=!0,!1):void 0}),dirty},reset:function(){this.delegateFn("reset")},delegateFn:function(fn){this.items.each(function(item){item[fn]&&item[fn]()})},beforeDestroy:function(){Ext.destroy(this.fieldCt),this.callParent(arguments)},getRawValue:Ext.emptyFn,setRawValue:Ext.emptyFn}),Ext.define("Extensible.calendar.form.field.ReminderCombo",{extend:"Ext.form.field.ComboBox",alias:"widget.extensible.remindercombo",requires:["Ext.data.ArrayStore"],fieldLabel:"Reminder",queryMode:"local",triggerAction:"all",forceSelection:!0,displayField:"desc",valueField:"value",noneText:"None",atStartTimeText:"At start time",reminderValueFormat:"{0} {1} before start",minutesText:"minutes",hourText:"hour",hoursText:"hours",dayText:"day",daysText:"days",weekText:"week",weeksText:"weeks",initComponent:function(){this.store=this.store||Ext.create("Ext.data.ArrayStore",{fields:["value","desc"],idIndex:0,data:this.getValueList()}),this.callParent(arguments)},getValueList:function(){var me=this,fmt=me.reminderValueFormat,stringFormat=Ext.String.format;return[["",me.noneText],["0",me.atStartTimeText],["5",stringFormat(fmt,"5",me.getMinutesText(5))],["15",stringFormat(fmt,"15",me.getMinutesText(15))],["30",stringFormat(fmt,"30",me.getMinutesText(30))],["60",stringFormat(fmt,"1",me.getHoursText(1))],["90",stringFormat(fmt,"1.5",me.getHoursText(1.5))],["120",stringFormat(fmt,"2",me.getHoursText(2))],["180",stringFormat(fmt,"3",me.getHoursText(3))],["360",stringFormat(fmt,"6",me.getHoursText(6))],["720",stringFormat(fmt,"12",me.getHoursText(12))],["1440",stringFormat(fmt,"1",me.getDaysText(1))],["2880",stringFormat(fmt,"2",me.getDaysText(2))],["4320",stringFormat(fmt,"3",me.getDaysText(3))],["5760",stringFormat(fmt,"4",me.getDaysText(4))],["7200",stringFormat(fmt,"5",me.getDaysText(5))],["10080",stringFormat(fmt,"1",me.getWeeksText(1))],["20160",stringFormat(fmt,"2",me.getWeeksText(2))]]},getMinutesText:function(numMinutes){return 1===numMinutes?this.minuteText:this.minutesText},getHoursText:function(numHours){return 1===numHours?this.hourText:this.hoursText},getDaysText:function(numDays){return 1===numDays?this.dayText:this.daysText},getWeeksText:function(numWeeks){return 1===numWeeks?this.weekText:this.weeksText},initValue:function(){void 0!==this.value?this.setValue(this.value):this.setValue(""),this.originalValue=this.getValue()}}),Ext.define("Extensible.calendar.util.ColorPicker",{extend:"Ext.picker.Color",alias:"widget.extensible.calendarcolorpicker",requires:["Ext.XTemplate"],colorCount:32,constructor:function(){this.renderTpl=['<tpl for="colors">','<a href="#" class="x-cal-{.}" hidefocus="on">','<em><span unselectable="on">&#160;</span></em>',"</a>","</tpl>"],this.callParent(arguments)},initComponent:function(){this.callParent(arguments),this.addCls("x-calendar-palette"),this.handler&&this.on("select",this.handler,this.scope||this,{delegate:"a"}),this.colors=[];for(var i=1;this.colorCount>=i;i++)this.colors.push(i)},handleClick:function(e,target){e.preventDefault();var classNames=target.className.split(" "),colorId;Ext.each(classNames,function(className){return className.indexOf("x-cal-")>-1?(colorId=className.split("x-cal-")[1],!1):void 0}),colorId&&this.select(colorId)},select:function(colorId,suppressEvent){var me=this,selectedCls=me.selectedCls,value=me.value;if(!me.rendered)return me.value=colorId,void 0;if(colorId!==value||me.allowReselect){var el=me.el;me.value&&el.down(".x-cal-"+value).removeCls(selectedCls),el.down(".x-cal-"+colorId).addCls(selectedCls),me.value=colorId,suppressEvent!==!0&&me.fireEvent("select",me,colorId)}}}),Ext.define("Extensible.calendar.gadget.CalendarListMenu",{extend:"Ext.menu.Menu",alias:"widget.extensible.calendarlistmenu",requires:["Extensible.calendar.util.ColorPicker"],hideOnClick:!0,ignoreParentClicks:!0,displayOnlyThisCalendarText:"Display only this calendar",enableScrolling:!1,initComponent:function(){this.addEvents("showcalendar","hidecalendar","radiocalendar","colorchange"),Ext.apply(this,{plain:!0,items:[{text:this.displayOnlyThisCalendarText,iconCls:"extensible-cal-icon-cal-show",handler:Ext.bind(this.handleRadioCalendarClick,this)},"-",{xtype:"extensible.calendarcolorpicker",id:this.id+"-calendar-color-picker",handler:Ext.bind(this.handleColorSelect,this)}]}),this.addClass("x-calendar-list-menu"),this.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.palette=this.down("#"+this.id+"-calendar-color-picker"),this.colorId&&this.palette.select(this.colorId,!0)},handleRadioCalendarClick:function(e,t){this.fireEvent("radiocalendar",this,this.calendarId)},handleColorSelect:function(cp,selColorId){this.fireEvent("colorchange",this,this.calendarId,selColorId,this.colorId),this.colorId=selColorId,this.menuHide()},setCalendar:function(id,cid){return this.calendarId=id,this.colorId=cid,this.rendered&&this.palette.select(cid,!0),this},menuHide:function(){this.hideOnClick&&this.hide()}}),Ext.define("Extensible.calendar.gadget.CalendarListPanel",{extend:"Ext.panel.Panel",alias:"widget.extensible.calendarlist",requires:["Ext.XTemplate","Extensible.calendar.gadget.CalendarListMenu"],title:"Calendars",collapsible:!0,autoHeight:!0,layout:"fit",menuSelector:"em",width:100,initComponent:function(){this.addCls("x-calendar-list"),this.callParent(arguments)},afterRender:function(ct,position){this.callParent(arguments),this.store&&this.setStore(this.store,!0),this.refresh(),this.body.on("click",this.onClick,this),this.body.on("mouseover",this.onMouseOver,this,{delegate:"li"}),this.body.on("mouseout",this.onMouseOut,this,{delegate:"li"})},getListTemplate:function(){return this.tpl||(this.tpl=Ext.isIE||Ext.isOpera?Ext.create("Ext.XTemplate",'<ul class="x-unselectable"><tpl for=".">','<li id="{cmpId}" class="ext-cal-evo {colorCls} {hiddenCls}">','<div class="ext-cal-evm">','<div class="ext-cal-evi">{title}<em>&#160;</em></div>',"</div>","</li>","</tpl></ul>"):Ext.create("Ext.XTemplate",'<ul class="x-unselectable"><tpl for=".">','<li id="{cmpId}" class="ext-cal-evr {colorCls} {hiddenCls}">{title}<em>&#160;</em></li>',"</tpl></ul>"),this.tpl.compile()),this.tpl},setStore:function(store,initial){!initial&&this.store&&(this.store.un("load",this.refresh,this),this.store.un("add",this.refresh,this),this.store.un("remove",this.refresh,this),this.store.un("update",this.onUpdate,this),this.store.un("clear",this.refresh,this)),store&&(store.on("load",this.refresh,this),store.on("add",this.refresh,this),store.on("remove",this.refresh,this),store.on("update",this.onUpdate,this),store.on("clear",this.refresh,this)),this.store=store},onUpdate:function(ds,rec,operation){operation===Ext.data.Record.COMMIT&&this.refresh()},refresh:function(){if(!this.skipRefresh){for(var data=[],i=0,o=null,CM=Extensible.calendar.data.CalendarMappings,recs=this.store.getRange(),len=recs.length;len>i;i++)o={cmpId:this.id+"__"+recs[i].data[CM.CalendarId.name],title:recs[i].data[CM.Title.name],colorCls:this.getColorCls(recs[i].data[CM.ColorId.name])},recs[i].data[CM.IsHidden.name]===!0&&(o.hiddenCls="ext-cal-hidden"),data[data.length]=o;this.getListTemplate().overwrite(this.body,data)}},getColorCls:function(colorId){return"x-cal-"+colorId+"-ad"},toggleCalendar:function(id,commit){var rec=this.store.findRecord(Extensible.calendar.data.CalendarMappings.CalendarId.name,id),CM=Extensible.calendar.data.CalendarMappings,isHidden=rec.data[CM.IsHidden.name];rec.set(CM.IsHidden.name,!isHidden),commit!==!1&&rec.commit()},showCalendar:function(id,commit){var rec=this.store.findRecord(Extensible.calendar.data.CalendarMappings.CalendarId.name,id);rec.data[Extensible.calendar.data.CalendarMappings.IsHidden.name]===!0&&this.toggleCalendar(id,commit)},hideCalendar:function(id,commit){var rec=this.store.findRecord(Extensible.calendar.data.CalendarMappings.CalendarId.name,id);rec.data[Extensible.calendar.data.CalendarMappings.IsHidden.name]!==!0&&this.toggleCalendar(id,commit)},radioCalendar:function(id){for(var i=0,recId,calendarId=Extensible.calendar.data.CalendarMappings.CalendarId.name,recs=this.store.getRange(),len=recs.length;len>i;i++)recId=recs[i].data[calendarId],recId===id?this.showCalendar(recId,!1):this.hideCalendar(recId,!1);this.skipRefresh=!0,this.store.sync(),delete this.skipRefresh,this.refresh()},onMouseOver:function(e,t){Ext.fly(t).addCls("hover")},onMouseOut:function(e,t){Ext.fly(t).removeCls("hover")},getCalendarId:function(el){return el.id.split("__")[1]},getCalendarItemEl:function(calendarId){return Ext.get(this.id+"__"+calendarId)},onClick:function(e,t){var el=e.getTarget(this.menuSelector,3,!0);el?this.showEventMenu(el,e.getXY()):(el=e.getTarget("li",3,!0),el&&this.toggleCalendar(this.getCalendarId(el)))},handleColorChange:function(menu,id,colorId,origColorId){var rec=this.store.findRecord(Extensible.calendar.data.CalendarMappings.CalendarId.name,id);rec.data[Extensible.calendar.data.CalendarMappings.ColorId.name]=colorId,rec.commit()},handleRadioCalendar:function(menu,id){this.radioCalendar(id)},showEventMenu:function(el,xy){var id=this.getCalendarId(el.parent("li")),rec=this.store.findRecord(Extensible.calendar.data.CalendarMappings.CalendarId.name,id),colorId=rec.data[Extensible.calendar.data.CalendarMappings.ColorId.name];this.menu||(this.menu=Ext.create("Extensible.calendar.gadget.CalendarListMenu"),this.menu.on("colorchange",this.handleColorChange,this),this.menu.on("radiocalendar",this.handleRadioCalendar,this)),this.menu.setCalendar(id,colorId),this.menu.showAt(xy)}}),Ext.define("Extensible.calendar.menu.Event",{extend:"Ext.menu.Menu",alias:"widget.extensible.eventcontextmenu",requires:["Ext.menu.DatePicker"],hideOnClick:!0,ignoreParentClicks:!0,startDay:0,editDetailsText:"Edit Details",deleteText:"Delete",moveToText:"Move to...",copyToText:"Copy to...",enableScrolling:!1,ownerCalendarPanel:{},initComponent:function(){this.addEvents("editdetails","eventdelete","eventmove","eventcopy"),this.buildMenu(),this.callParent(arguments)},buildMenu:function(){var me=this;me.rendered||(me.dateMenu=Ext.create("Ext.menu.DatePicker",{scope:me,startDay:me.startDay,handler:me.onEventMoveSelected}),me.copyMenu=Ext.create("Ext.menu.DatePicker",{scope:me,startDay:me.startDay,handler:me.onEventCopySelected}),Ext.apply(me,{items:[{text:me.editDetailsText,iconCls:"extensible-cal-icon-evt-edit",scope:me,handler:function(){me.fireEvent("editdetails",me,me.rec,me.ctxEl)}},{text:me.deleteText,iconCls:"extensible-cal-icon-evt-del",scope:me,handler:function(){me.fireEvent("eventdelete",me,me.rec,me.ctxEl)}},"-",{text:me.moveToText,iconCls:"extensible-cal-icon-evt-move",menu:me.dateMenu},{text:me.copyToText,iconCls:"extensible-cal-icon-evt-copy",menu:me.copyMenu}]}))},onEventMoveSelected:function(datePicker,selectedDate){this.doCopyOrMove(selectedDate,"move")},onEventCopySelected:function(datePicker,selectedDate){this.doCopyOrMove(selectedDate,"copy")},doCopyOrMove:function(selectedDate,mode){selectedDate=Extensible.Date.copyTime(this.rec.data[Extensible.calendar.data.EventMappings.StartDate.name],selectedDate),this.fireEvent("event"+mode,this,this.rec,selectedDate)},showForEvent:function(rec,el,xy){var me=this,startDate=rec.data[Extensible.calendar.data.EventMappings.StartDate.name];me.rec=rec,me.ctxEl=el,me.dateMenu.picker.setValue(startDate),me.copyMenu.picker.setValue(startDate),me.showAt(xy)},onHide:function(){this.callParent(arguments)},onDestroy:function(){delete this.ctxEl,this.callParent(arguments)}}),Ext.define("Extensible.calendar.form.EventDetails",{extend:"Ext.form.Panel",alias:"widget.extensible.eventeditform",requires:["Extensible.form.field.DateRange","Extensible.calendar.form.field.ReminderCombo","Extensible.calendar.data.EventMappings","Extensible.calendar.form.field.CalendarCombo","Extensible.form.recurrence.Fieldset","Ext.layout.container.Column","Extensible.form.recurrence.RangeEditWindow"],labelWidth:65,labelWidthRightCol:65,colWidthLeft:".95",colWidthRight:".05",fieldAnchor:"100%",title:"Event Form",titleTextAdd:"Add Event",titleTextEdit:"Edit Event",titleLabelText:"Title",datesLabelText:"When",reminderLabelText:"Reminder",notesLabelText:"Notes",locationLabelText:"Location",webLinkLabelText:"Web Link",calendarLabelText:"Program",colourLabelText:"State",repeatsLabelText:"Repeats",saveButtonText:"Save",goToRallyText:"Go to Rally",deleteButtonText:"Delete",cancelButtonText:"Cancel",bodyStyle:"padding:20px 20px 10px;",border:!1,buttonAlign:"center",autoScroll:!0,startDay:0,recurrence:!1,allowDefaultAdd:!0,layout:"column",initComponent:function(){this.addEvents({eventadd:!0,eventupdate:!0,eventdelete:!0,eventcancel:!0}),this.titleField=Ext.create("Ext.form.field.Text",{fieldLabel:this.titleLabelText,name:Extensible.calendar.data.EventMappings.Title.name,anchor:this.fieldAnchor}),this.dateRangeField=Ext.create("Extensible.form.field.DateRange",{fieldLabel:this.datesLabelText,singleLine:!1,anchor:this.fieldAnchor,startDay:this.startDay,listeners:{change:Ext.bind(this.onDateChange,this)}}),this.reminderField=Ext.create("Extensible.calendar.form.field.ReminderCombo",{name:Extensible.calendar.data.EventMappings.Reminder.name,fieldLabel:this.reminderLabelText,anchor:this.fieldAnchor}),this.notesField=Ext.create("Ext.form.field.TextArea",{fieldLabel:this.notesLabelText,name:Extensible.calendar.data.EventMappings.Notes.name,grow:!0,growMax:150,anchor:this.fieldAnchor}),this.urlField=Ext.create("Ext.form.field.Text",{fieldLabel:this.webLinkLabelText,readOnly:!0,inputType:"url",name:Extensible.calendar.data.EventMappings.Url.name,anchor:this.fieldAnchor});var rightFields=[],leftFields=[this.titleField,this.dateRangeField,this.reminderField,this.notesField,this.urlField];this.recurrence&&(this.recurrenceField=Ext.create("Extensible.form.recurrence.Fieldset",{recurrenceOptions:this.recurrence,name:Extensible.calendar.data.EventMappings.RRule.name,fieldLabel:this.repeatsLabelText,startDay:this.startDay,anchor:this.fieldAnchor,listeners:{startchange:Ext.bind(this.onRecurrenceStartChange,this)}}),leftFields.splice(2,0,this.recurrenceField)),this.calendarStore&&(this.calendarField=Ext.create("Extensible.calendar.form.field.CalendarCombo",{store:this.calendarStore,fieldLabel:this.calendarLabelText,name:Extensible.calendar.data.EventMappings.CalendarId.name,anchor:this.fieldAnchor}),leftFields.splice(2,0,this.calendarField)),this.colourField=Ext.create("Rally.ui.combobox.FieldValueComboBox",{model:"task",fieldLabel:this.colourLabelText,field:"c_CoachState",name:"Colour"}),leftFields.splice(2,0,this.colourField);var labelWidth=Math.max(this.labelWidthRightCol,this.labelWidth);this.items=[{id:this.id+"-left-col",columnWidth:this.colWidthLeft,layout:"anchor",fieldDefaults:{labelWidth:labelWidth},border:!1,items:leftFields},{id:this.id+"-right-col",columnWidth:this.colWidthRight,layout:"anchor",fieldDefaults:{labelWidth:labelWidth},border:!1,items:rightFields}],this.fbar=[{text:this.goToRallyText,scope:this,handler:this.openRally},{text:this.saveButtonText,scope:this,handler:this.onSave},{itemId:this.id+"-del-btn",text:this.deleteButtonText,scope:this,handler:this.onDelete},{text:this.cancelButtonText,scope:this,handler:this.onCancel}],this.addCls("ext-evt-edit-form"),Ext.apply(this.initialConfig,{trackResetOnLoad:!0}),this.callParent(arguments)},onDateChange:function(dateRangeField,val){this.recurrenceField&&this.recurrenceField.setStartDate(val[0])},onRecurrenceStartChange:function(recurrenceFieldset,startDate,oldDate){this.dateRangeField.setValue(startDate)},loadRecord:function(rec){var me=this,EventMappings=Extensible.calendar.data.EventMappings;if(me.form.reset().loadRecord.apply(me.form,arguments),me.activeRecord=rec,me.dateRangeField.setValue(rec.data),me.recurrenceField){var recurrenceStart=rec.get(EventMappings.RSeriesStartDate.name)||rec.get(EventMappings.StartDate.name);me.recurrenceField.suspendEvents(),me.recurrenceField.setStartDate(recurrenceStart),me.recurrenceField.setValue(rec.get(EventMappings.RRule.name)),me.recurrenceField.resumeEvents(),rec.data[EventMappings.RInstanceStartDate.name]||(rec.data[EventMappings.RInstanceStartDate.name]=rec.getStartDate())}me.colourField.setValue(rec.data[EventMappings.Colour.name]),me.calendarField&&me.calendarField.setValue(rec.data[EventMappings.CalendarId.name]),rec.phantom?(me.setTitle(me.titleTextAdd),me.down("#"+me.id+"-del-btn").hide()):(me.setTitle(me.titleTextEdit),me.down("#"+me.id+"-del-btn").show()),me.form.getFields().each(function(item){item.resetOriginalValue()}),me.titleField.focus()},openRally:function(){var me=this;me.onSave(),Rally.nav.Manager.showDetail(Rally.util.Ref.getRefObject(me.urlField.getValue()))},updateRecord:function(record){var fields=record.fields,values=this.getForm().getValues(),EventMappings=Extensible.calendar.data.EventMappings,name,obj={};fields.each(function(f){name=f.name,name in values&&(obj[name]=values[name])});var dates=this.dateRangeField.getValue(),allday=obj[EventMappings.IsAllDay.name]=dates[2],startDate=allday?Extensible.Date.clearTime(dates[0]):dates[0],endDate=allday?Extensible.Date.clearTime(dates[1]):dates[1],singleDayDurationConfig={days:1};return singleDayDurationConfig[Extensible.calendar.data.EventModel.resolution]=-1,obj[EventMappings.StartDate.name]=startDate,obj[EventMappings.EndDate.name]=allday?Extensible.Date.add(endDate,singleDayDurationConfig):endDate,EventMappings.Duration&&(obj[EventMappings.Duration.name]=Extensible.Date.diff(startDate,obj[EventMappings.EndDate.name],Extensible.calendar.data.EventModel.resolution)),record.set(obj),record.dirty||record.phantom&&this.allowDefaultAdd},onCancel:function(){this.cleanup(!0),this.fireEvent("eventcancel",this,this.activeRecord)},cleanup:function(hide){this.activeRecord&&this.activeRecord.reject(),delete this.activeRecord,this.form.isDirty()&&this.form.reset()},onSave:function(){var me=this,originalHasRecurrence=me.activeRecord.isRecurring();if(me.form.isValid()||me.allowDefaultAdd)return me.updateRecord(me.activeRecord)?(me.activeRecord.phantom?me.fireEvent("eventadd",me,me.activeRecord):originalHasRecurrence&&me.activeRecord.isRecurring()?me.onRecurrenceUpdate():me.fireEvent("eventupdate",me,me.activeRecord),void 0):(me.onCancel(),void 0)},onRecurrenceUpdate:function(){this.rangeEditWin=this.rangeEditWin||Ext.WindowMgr.get("ext-cal-rangeeditwin"),this.rangeEditWin||(this.rangeEditWin=new Extensible.form.recurrence.RangeEditWindow),this.rangeEditWin.prompt({callback:this.onRecurrenceEditModeSelected,scope:this})},onRecurrenceEditModeSelected:function(editMode){var me=this;editMode&&(me.activeRecord.data[Extensible.calendar.data.EventMappings.REditMode.name]=editMode,me.fireEvent("eventupdate",me,me.activeRecord,me.animateTarget))},onDelete:function(){this.fireEvent("eventdelete",this,this.activeRecord)}}),Ext.define("Extensible.calendar.form.EventWindow",{extend:"Ext.window.Window",alias:"widget.extensible.eventeditwindow",requires:["Ext.form.Panel","Extensible.calendar.data.EventModel","Extensible.calendar.data.EventMappings","Extensible.form.recurrence.RangeEditWindow"],titleTextAdd:"Add Event",titleTextEdit:"Edit Event",width:600,labelWidth:65,detailsLinkText:"Edit Details...",savingMessage:"Saving changes...",deletingMessage:"Deleting event...",saveButtonText:"Save",deleteButtonText:"Delete",cancelButtonText:"Cancel",titleLabelText:"Title",datesLabelText:"When",calendarLabelText:"Program",startDay:0,closeAction:"hide",modal:!1,resizable:!1,constrain:!0,buttonAlign:"left",editDetailsLinkClass:"edit-dtl-link",enableEditDetails:!0,layout:"fit",formPanelConfig:{border:!1},allowDefaultAdd:!0,initComponent:function(){this.addEvents({eventadd:!0,eventupdate:!0,eventdelete:!0,eventcancel:!0,editdetails:!0}),this.fbar=this.getFooterBarConfig(),this.callParent(arguments)
},getFooterBarConfig:function(){var cfg=["->",{text:this.saveButtonText,itemId:this.id+"-save-btn",disabled:!1,handler:this.onSave,scope:this},{text:this.deleteButtonText,itemId:this.id+"-delete-btn",disabled:!1,handler:this.onDelete,scope:this,hideMode:"offsets"},{text:this.cancelButtonText,itemId:this.id+"-cancel-btn",disabled:!1,handler:this.onCancel,scope:this}];return this.enableEditDetails!==!1&&cfg.unshift({xtype:"tbtext",itemId:this.id+"-details-btn",text:'<a href="#" class="'+this.editDetailsLinkClass+'">'+this.detailsLinkText+"</a>"}),cfg},onRender:function(ct,position){this.formPanel=Ext.create("Ext.form.Panel",Ext.applyIf({fieldDefaults:{labelWidth:this.labelWidth},items:this.getFormItemConfigs()},this.formPanelConfig)),this.add(this.formPanel),this.callParent(arguments)},getFormItemConfigs:function(){var items=[{xtype:"textfield",itemId:this.id+"-title",name:Extensible.calendar.data.EventMappings.Title.name,fieldLabel:this.titleLabelText,anchor:"100%"},{xtype:"extensible.daterangefield",itemId:this.id+"-dates",name:"dates",anchor:"95%",singleLine:!0,startDay:this.startDay,fieldLabel:this.datesLabelText}];return this.calendarStore&&items.push({xtype:"extensible.calendarcombo",itemId:this.id+"-calendar",name:Extensible.calendar.data.EventMappings.CalendarId.name,anchor:"100%",fieldLabel:this.calendarLabelText,store:this.calendarStore}),items},afterRender:function(){this.callParent(arguments),this.el.addCls("ext-cal-event-win"),this.initRefs();var junkSpacer=this.getDockedItems("toolbar")[0].items.items[0];junkSpacer.el.hasCls("x-component-default")&&Ext.destroy(junkSpacer)},initRefs:function(){this.saveButton=this.down("#"+this.id+"-save-btn"),this.deleteButton=this.down("#"+this.id+"-delete-btn"),this.cancelButton=this.down("#"+this.id+"-cancel-btn"),this.detailsButton=this.down("#"+this.id+"-details-btn"),this.detailsButton&&this.detailsButton.getEl().on("click",this.onEditDetailsClick,this),this.titleField=this.down("#"+this.id+"-title"),this.dateRangeField=this.down("#"+this.id+"-dates"),this.calendarField=this.down("#"+this.id+"-calendar"),this.colourField=this.down("#"+this.id+"-colour")},onEditDetailsClick:function(e){e.stopEvent(),this.updateRecord(this.activeRecord,!0),this.fireEvent("editdetails",this,this.activeRecord,this.animateTarget)},show:function(o,animateTarget){var me=this,EventMappings=Extensible.calendar.data.EventMappings,form,rec;if(me.animateTarget=Ext.isIE8&&Ext.isStrict?null:animateTarget,me.callParent([me.animateTarget,function(){me.titleField.focus(!1,100)},me]),form=me.formPanel.form,me.deleteButton[o.data&&o.data[EventMappings.EventId.name]?"show":"hide"](),o.data)rec=o,me.setTitle(rec.phantom?me.titleTextAdd:me.titleTextEdit),form.loadRecord(rec);else{me.setTitle(me.titleTextAdd);var start=o[EventMappings.StartDate.name]||new Date(Ext.Date.now()),end=o[EventMappings.EndDate.name]||Extensible.Date.add(start,{hours:1});rec=Ext.create("Extensible.calendar.data.EventModel"),rec.data[EventMappings.Title.name]=o[EventMappings.Title.name],rec.data[EventMappings.StartDate.name]=start,rec.data[EventMappings.EndDate.name]=end,rec.data[EventMappings.IsAllDay.name]=!!o[EventMappings.IsAllDay.name]||start.getDate()!==Extensible.Date.add(end,{millis:1}).getDate(),rec.data[EventMappings.CalendarId.name]=me.calendarStore?me.calendarStore.getAt(0).data[Extensible.calendar.data.CalendarMappings.CalendarId.name]:"",EventMappings.Duration&&(rec.data[EventMappings.Duration.name]=Extensible.Date.diff(start,end,Extensible.calendar.data.EventModel.resolution)),form.reset(),form.loadRecord(rec)}return EventMappings.RInstanceStartDate&&(rec.data[EventMappings.RInstanceStartDate.name]=rec.getStartDate()),me.dateRangeField.setValue(rec.data),me.activeRecord=rec,form.getFields().each(function(item){item.resetOriginalValue()}),me},roundTime:function(dt,incr){incr=incr||15;var m=parseInt(dt.getMinutes(),10);return dt.add("mi",incr-m%incr)},onCancel:function(){this.cleanup(!0),this.fireEvent("eventcancel",this,this.activeRecord,this.animateTarget)},cleanup:function(hide){this.activeRecord&&this.activeRecord.reject(),delete this.activeRecord,hide===!0&&this.hide()},updateRecord:function(record,keepEditing){var fields=record.fields,values=this.formPanel.getForm().getValues(),EventMappings=Extensible.calendar.data.EventMappings,name,obj={},modified;fields.each(function(f){name=f.name,name in values&&(obj[name]=values[name])});var dates=this.dateRangeField.getValue(),allday=obj[EventMappings.IsAllDay.name]=dates[2],startDate=allday?Extensible.Date.clearTime(dates[0]):dates[0],endDate=allday?Extensible.Date.clearTime(dates[1]):dates[1],singleDayDurationConfig={days:1};return singleDayDurationConfig[Extensible.calendar.data.EventModel.resolution]=-1,obj[EventMappings.StartDate.name]=startDate,obj[EventMappings.EndDate.name]=allday?Extensible.Date.add(endDate,singleDayDurationConfig):endDate,EventMappings.Duration&&(obj[EventMappings.Duration.name]=Extensible.Date.diff(startDate,obj[EventMappings.EndDate.name],Extensible.calendar.data.EventModel.resolution)),record.beginEdit(),record.set(obj),keepEditing&&modified||record.endEdit(),record.dirty||record.phantom&&this.allowDefaultAdd},onSave:function(){var me=this,form=me.formPanel.form,originalHasRecurrence=me.activeRecord.isRecurring();if(!form.isDirty()&&!me.allowDefaultAdd)return me.onCancel(),void 0;if(form.isValid())return me.updateRecord(me.activeRecord)?(me.activeRecord.phantom?me.fireEvent("eventadd",me,me.activeRecord,me.animateTarget):originalHasRecurrence&&me.activeRecord.isRecurring()?me.onRecurrenceUpdate():me.fireEvent("eventupdate",me,me.activeRecord,me.animateTarget),void 0):(me.onCancel(),void 0)},onRecurrenceUpdate:function(){this.rangeEditWin=this.rangeEditWin||Ext.WindowMgr.get("ext-cal-rangeeditwin"),this.rangeEditWin||(this.rangeEditWin=new Extensible.form.recurrence.RangeEditWindow),this.rangeEditWin.prompt({callback:this.onRecurrenceEditModeSelected,scope:this})},onRecurrenceEditModeSelected:function(editMode){var me=this;editMode&&(me.activeRecord.data[Extensible.calendar.data.EventMappings.REditMode.name]=editMode,me.fireEvent("eventupdate",me,me.activeRecord,me.animateTarget))},onDelete:function(){this.fireEvent("eventdelete",this,this.activeRecord,this.animateTarget)}}),Ext.define("Extensible.calendar.view.AbstractCalendar",{extend:"Ext.Component",requires:["Ext.CompositeElement","Extensible.calendar.form.EventDetails","Extensible.calendar.form.EventWindow","Extensible.calendar.menu.Event","Extensible.calendar.dd.DragZone","Extensible.calendar.dd.DropZone","Extensible.form.recurrence.RangeEditWindow"],recurrence:!1,recurrenceOptions:{expansionMode:"remote",expansionParam:{name:"singleEvents",value:!0}},startDay:0,spansHavePriority:!1,trackMouseOver:!0,enableFx:!0,enableAddFx:!0,enableUpdateFx:!1,enableRemoveFx:!0,enableDD:!0,enableContextMenus:!0,suppressBrowserContextMenu:!1,monitorResize:!0,todayText:"Today",ddCreateEventText:"Create event for {0}",ddCopyEventText:"Copy event to {0}",ddMoveEventText:"Move event to {0}",ddResizeEventText:"Update event to {0}",defaultEventTitleText:"(No title)",dateParamStart:"startDate",dateParamEnd:"endDate",dateParamFormat:"Y-m-d",editModal:!1,enableEditDetails:!0,weekendCls:"ext-cal-day-we",prevMonthCls:"ext-cal-day-prev",nextMonthCls:"ext-cal-day-next",todayCls:"ext-cal-day-today",hideMode:"offsets",notifyOnExceptionTitle:"Server Error",notifyOnExceptionText:"The action failed with the following response:",notifyOnExceptionDefaultMessage:"An unknown error occurred",weekCount:1,dayCount:1,eventSelector:".ext-cal-evt",eventSelectorDepth:10,eventOverClass:"ext-evt-over",eventElIdDelimiter:"-evt-",dayElIdDelimiter:"-day-",recurringInstanceIdDelimiter:"-rid-",getEventBodyMarkup:Ext.emptyFn,getEventTemplate:Ext.emptyFn,initComponent:function(){this.setStartDate(this.startDate||new Date),this.callParent(arguments),this.readOnly===!0&&this.addCls("ext-cal-readonly"),this.addEvents({eventsrendered:!0,eventclick:!0,eventover:!0,eventout:!0,beforedatechange:!0,datechange:!0,rangeselect:!0,beforeeventcopy:!0,eventcopy:!0,beforeeventmove:!0,eventmove:!0,initdrag:!0,dayover:!0,dayout:!0,editdetails:!0,eventadd:!0,eventupdate:!0,eventcancel:!0,beforeeventdelete:!0,eventdelete:!0,eventexception:!0})},afterRender:function(){this.callParent(arguments),this.renderTemplate(),this.store&&(this.setStore(this.store,!0),this.store.deferLoad?(this.reloadStore(this.store.deferLoad),delete this.store.deferLoad):this.store.initialParams=this.getStoreParams()),this.calendarStore&&this.setCalendarStore(this.calendarStore,!0),this.on("resize",this.onResize,this),this.el.on({mouseover:this.onMouseOver,mouseout:this.onMouseOut,click:this.onClick,scope:this}),this.enableContextMenus&&this.readOnly!==!0&&this.el.on("contextmenu",this.onContextMenu,this),this.el.unselectable(),this.enableDD&&this.readOnly!==!0&&this.initDD&&this.initDD(),this.on("eventsrendered",this.onEventsRendered),Ext.defer(this.forceSize,100,this)},getStoreDateParams:function(){var o={};return o[this.dateParamStart]=Ext.Date.format(this.viewStart,this.dateParamFormat),o[this.dateParamEnd]=Ext.Date.format(this.viewEnd,this.dateParamFormat),o},getStoreParams:function(){var params=this.getStoreDateParams();return params},reloadStore:function(o){Extensible.log("reloadStore");var recurrenceOptions=this.recurrenceOptions;o=Ext.isObject(o)?o:{},o.params=o.params||{},Ext.apply(o.params,this.getStoreParams()),this.recurrence&&recurrenceOptions.expansionParam&&"remote"===recurrenceOptions.expansionMode&&(o.params[recurrenceOptions.expansionParam.name]=recurrenceOptions.expansionParam.value),this.store.load(o)},onEventsRendered:function(){this.forceSize()},forceSize:function(){var el=this.el;if(el&&el.down){var hd=el.down(".ext-cal-hd-ct"),bd=el.down(".ext-cal-body-ct");if(!bd||!hd)return;var headerHeight=hd.getHeight(),sz=el.parent().getSize();bd.setHeight(sz.height-headerHeight)}},refresh:function(reloadData){return this.isActiveView()?(Extensible.log("refresh (AbstractCalendar), reload = "+reloadData),reloadData===!0?this.reloadStore():(this.prepareData(),this.renderTemplate(),this.renderItems()),void 0):(Extensible.log("refresh (AbstractCalendar), skipped for non-active view ("+this.id+")"),void 0)},getWeekCount:function(){var days=Extensible.Date.diffDays(this.viewStart,this.viewEnd);return Math.ceil(days/this.dayCount)},prepareData:function(){var lastInMonth=Ext.Date.getLastDateOfMonth(this.startDate),w=0,d=0,row=0,currentDt=Ext.Date.clone(this.viewStart),weeks=1>this.weekCount?6:this.weekCount;this.eventGrid=[[]],this.allDayGrid=[[]],this.evtMaxCount=[];for(var evtsInView=this.store.queryBy(function(rec){return this.isEventVisible(rec.data)},this),filterFn=function(rec){var EventMappings=Extensible.calendar.data.EventMappings,startDt=Ext.Date.clearTime(rec.data[EventMappings.StartDate.name],!0),startsOnDate=currentDt.getTime()===startDt.getTime(),spansFromPrevView=0===w&&0===d&&currentDt>rec.data[EventMappings.StartDate.name];return startsOnDate||spansFromPrevView};weeks>w&&(this.evtMaxCount[w]=this.evtMaxCount[w]||0,!(-1===this.weekCount&&currentDt>lastInMonth));w++)for(this.eventGrid[w]=this.eventGrid[w]||[],this.allDayGrid[w]=this.allDayGrid[w]||[],d=0;this.dayCount>d;d++){if(evtsInView.getCount()>0){var evts=evtsInView.filterBy(filterFn,this);this.sortEventRecordsForDay(evts),this.prepareEventGrid(evts,w,d)}currentDt=Extensible.Date.add(currentDt,{days:1})}this.currentWeekCount=w},prepareEventGrid:function(evts,w,d){var me=this,row=0,dt=Ext.Date.clone(me.viewStart),maxEventsForDay;evts.each(function(evt){var M=Extensible.calendar.data.EventMappings;if(Extensible.Date.diffDays(evt.data[M.StartDate.name],evt.data[M.EndDate.name])>0){var daysInView=Extensible.Date.diffDays(Extensible.Date.max(me.viewStart,evt.data[M.StartDate.name]),Extensible.Date.min(me.viewEnd,evt.data[M.EndDate.name]))+1;me.prepareEventGridSpans(evt,me.eventGrid,w,d,daysInView),me.prepareEventGridSpans(evt,me.allDayGrid,w,d,daysInView,!0)}else row=me.findEmptyRowIndex(w,d),me.eventGrid[w][d]=me.eventGrid[w][d]||[],me.eventGrid[w][d][row]=evt,evt.data[M.IsAllDay.name]&&(row=me.findEmptyRowIndex(w,d,!0),me.allDayGrid[w][d]=me.allDayGrid[w][d]||[],me.allDayGrid[w][d][row]=evt);return me.setMaxEventsForDay(w,d),!0},me)},setMaxEventsForDay:function(weekIndex,dayIndex){var max=this.maxEventsPerDay+1||999,maxEventsForDay=this[this.isHeaderView?"allDayGrid":"eventGrid"][weekIndex][dayIndex]||[];this.evtMaxCount[weekIndex]=this.evtMaxCount[weekIndex]||0,maxEventsForDay.length&&this.evtMaxCount[weekIndex]<maxEventsForDay.length&&(this.evtMaxCount[weekIndex]=Math.min(max,maxEventsForDay.length))},prepareEventGridSpans:function(evt,grid,w,d,days,allday){var w1=w,d1=d,row=this.findEmptyRowIndex(w,d,allday),dt=Ext.Date.clone(this.viewStart),start={event:evt,isSpan:!0,isSpanStart:!0,spanLeft:!1,spanRight:6===d};for(grid[w][d]=grid[w][d]||[],grid[w][d][row]=start,this.setMaxEventsForDay(w,d);--days&&(dt=Extensible.Date.add(dt,{days:1}),!(dt>this.viewEnd));)++d1>6&&(d1=0,w1++,row=this.findEmptyRowIndex(w1,0)),grid[w1]=grid[w1]||[],grid[w1][d1]=grid[w1][d1]||[],grid[w1][d1][row]={event:evt,isSpan:!0,isSpanStart:0===d1,spanLeft:w1>w&&0===d1%7,spanRight:6===d1&&days>1},this.setMaxEventsForDay(w1,d1)},findEmptyRowIndex:function(w,d,allday){for(var grid=allday?this.allDayGrid:this.eventGrid,day=grid[w]?grid[w][d]||[]:[],i=0,len=day.length;len>i;i++)if(!day[i])return i;return len},renderTemplate:function(){this.tpl&&(this.tpl.overwrite(this.el,this.getTemplateParams()),this.lastRenderStart=Ext.Date.clone(this.viewStart),this.lastRenderEnd=Ext.Date.clone(this.viewEnd))},getTemplateParams:function(){return{viewStart:this.viewStart,viewEnd:this.viewEnd,startDate:this.startDate,dayCount:this.dayCount,weekCount:this.weekCount,weekendCls:this.weekendCls,prevMonthCls:this.prevMonthCls,nextMonthCls:this.nextMonthCls,todayCls:this.todayCls}},disableStoreEvents:function(){return this.monitorStoreEvents=!1,this},enableStoreEvents:function(refresh){return this.monitorStoreEvents=!0,refresh===!0&&this.refresh(),this},onResize:function(){this.refresh(!1)},onInitDrag:function(){this.fireEvent("initdrag",this)},onEventDrop:function(rec,dt,mode){this[(mode||"move")+"Event"](rec,dt)},onCalendarEndDrag:function(start,end,onComplete){this.dragPending=!0;var dates={},boundOnComplete=Ext.bind(this.onCalendarEndDragComplete,this,[onComplete]);dates[Extensible.calendar.data.EventMappings.StartDate.name]=start,dates[Extensible.calendar.data.EventMappings.EndDate.name]=end,this.fireEvent("rangeselect",this,dates,boundOnComplete)!==!1?(this.showEventEditor(dates,null),this.editWin?this.editWin.on("hide",boundOnComplete,this,{single:!0}):boundOnComplete()):this.onCalendarEndDragComplete(boundOnComplete)},onCalendarEndDragComplete:function(onComplete){onComplete(),this.dragPending=!1},refreshAfterEventChange:function(action,operation){var RInstanceStartDate=Extensible.calendar.data.EventMappings.RInstanceStartDate,isInstance=RInstanceStartDate&&!!operation.records[0].get(RInstanceStartDate.name),reload=(operation.records[0].isRecurring()||isInstance)&&!operation.wasStoreReloadTriggered;reload&&(operation.wasStoreReloadTriggered=!0),this.refresh(reload)},onUpdate:function(store,operation,updateType){if(this.hidden!==!0&&this.ownerCt.hidden!==!0&&this.monitorStoreEvents!==!1&&updateType===Ext.data.Record.COMMIT){Extensible.log("onUpdate"),this.dismissEventEditor(),this.refreshAfterEventChange("update",operation);var rec=operation.records[0];this.enableFx&&this.enableUpdateFx&&this.doUpdateFx(this.getEventEls(rec.data[Extensible.calendar.data.EventMappings.EventId.name]),{scope:this})}},doUpdateFx:function(els,o){this.highlightEvent(els,null,o)},onAdd:function(store,operation){var rec=operation.records[0];this.hidden!==!0&&this.ownerCt.hidden!==!0&&this.monitorStoreEvents!==!1&&(Extensible.log("onAdd"),this.dismissEventEditor(),this.refreshAfterEventChange("create",operation))},doAddFx:function(els,o){els.fadeIn(Ext.apply(o,{duration:2e3}))},onRemove:function(store,operation){if(this.hidden!==!0&&this.ownerCt.hidden!==!0&&this.monitorStoreEvents!==!1){Extensible.log("onRemove"),this.dismissEventEditor();var rec=operation.records[0];this.enableFx&&this.enableRemoveFx?this.doRemoveFx(this.getEventEls(rec.data[Extensible.calendar.data.EventMappings.EventId.name]),{remove:!0,scope:this,callback:Ext.bind(this.refreshAfterEventChange,this,["delete",operation])}):(this.getEventEls(rec.data[Extensible.calendar.data.EventMappings.EventId.name]).remove(),this.refreshAfterEventChange("delete",operation))}},doRemoveFx:function(els,o){0===els.getCount()&&Ext.isFunction(o.callback)?o.callback.call(o.scope||this):els.fadeOut(o)},highlightEvent:function(els,color,o){if(this.enableFx)if(Ext.isIE||Ext.isOpera){var highlightEl;els.each(function(el){el.highlight(color,Ext.applyif({attr:"color"},o));var highlightEl=el.down(".ext-cal-evm");highlightEl&&highlightEl.highlight(color,o)},this)}else els.highlight(color,o)},getEventIdFromEl:function(el){el=Ext.get(el);var parts,id="",cls,classes=el.dom.className.split(" ");return Ext.each(classes,function(cls){return parts=cls.split(this.eventElIdDelimiter),parts.length>1?(id=parts[1],!1):void 0},this),id},getEventId:function(eventId){return void 0===eventId&&this.tempEventId&&(eventId=this.tempEventId),eventId},getEventSelectorCls:function(eventId,forSelect){var prefix=forSelect?".":"",id=this.getEventId(eventId),cls=prefix+this.id+this.eventElIdDelimiter+id;return cls},getEventEls:function(eventId){var els=this.el.select(this.getEventSelectorCls(this.getEventId(eventId),!0),!1);return Ext.create("Ext.CompositeElement",els)},isToday:function(){var today=Ext.Date.clearTime(new Date).getTime();return today>=this.viewStart.getTime()&&this.viewEnd.getTime()>=today},isEventVisible:function(evt){var eventMappings=Extensible.calendar.data.EventMappings,calendarMappings=Extensible.calendar.data.CalendarMappings,data=evt.data||evt,calRec=this.calendarStore?this.calendarStore.findRecord(calendarMappings.CalendarId.name,evt[eventMappings.CalendarId.name]):null;if(calRec&&calRec.data[calendarMappings.IsHidden.name]===!0)return!1;var start=this.viewStart.getTime(),end=this.viewEnd.getTime(),evStart=data[eventMappings.StartDate.name].getTime(),evEnd=data[eventMappings.EndDate.name].getTime();return Extensible.Date.rangesOverlap(start,end,evStart,evEnd)},isOverlapping:function(evt1,evt2){var ev1=evt1.data?evt1.data:evt1,ev2=evt2.data?evt2.data:evt2,M=Extensible.calendar.data.EventMappings,start1=ev1[M.StartDate.name].getTime(),end1=Extensible.Date.add(ev1[M.EndDate.name],{seconds:-1}).getTime(),start2=ev2[M.StartDate.name].getTime(),end2=Extensible.Date.add(ev2[M.EndDate.name],{seconds:-1}).getTime(),startDiff=Extensible.Date.diff(ev1[M.StartDate.name],ev2[M.StartDate.name],"m");start1>end1&&(end1=start1),start2>end2&&(end2=start2);var evtsOverlap=Extensible.Date.rangesOverlap(start1,end1,start2,end2),minimumMinutes=this.minEventDisplayMinutes||0,ev1MinHeightOverlapsEv2=minimumMinutes>0&&startDiff>-minimumMinutes&&minimumMinutes>startDiff;return evtsOverlap||ev1MinHeightOverlapsEv2},isEventSpanning:function(evt){var M=Extensible.calendar.data.EventMappings,data=evt.data||evt,diff;return diff=Extensible.Date.diffDays(data[M.StartDate.name],data[M.EndDate.name]),diff>0},getDayEl:function(dt){return Ext.get(this.getDayId(dt))},getDayId:function(dt){return Ext.isDate(dt)&&(dt=Ext.Date.format(dt,"Ymd")),this.id+this.dayElIdDelimiter+dt},getStartDate:function(){return this.startDate},setStartDate:function(start,reload){var me=this;Extensible.log("setStartDate (base) "+Ext.Date.format(start,"Y-m-d"));var cloneDt=Ext.Date.clone,cloneStartDate=me.startDate?cloneDt(me.startDate):null,cloneStart=cloneDt(start),cloneViewStart=me.viewStart?cloneDt(me.viewStart):null,cloneViewEnd=me.viewEnd?cloneDt(me.viewEnd):null;me.fireEvent("beforedatechange",me,cloneStartDate,cloneStart,cloneViewStart,cloneViewEnd)!==!1&&(me.startDate=Ext.Date.clearTime(start),me.setViewBounds(start),me.ownerCalendarPanel&&me.ownerCalendarPanel.startDate!==me.startDate&&(me.ownerCalendarPanel.startDate=me.startDate),me.rendered&&me.refresh(reload),me.fireEvent("datechange",me,cloneDt(me.startDate),cloneDt(me.viewStart),cloneDt(me.viewEnd)))},setViewBounds:function(startDate){var me=this,start=startDate||me.startDate,offset=start.getDay()-me.startDay,Dt=Extensible.Date;switch(0>offset&&(offset+=7),this.weekCount){case 0:case 1:return me.viewStart=7>me.dayCount&&!me.startDayIsStatic?start:Dt.add(start,{days:-offset,clearTime:!0}),me.viewEnd=Dt.add(me.viewStart,{days:me.dayCount||7,seconds:-1}),void 0;case-1:start=Ext.Date.getFirstDateOfMonth(start),offset=start.getDay()-me.startDay,0>offset&&(offset+=7),me.viewStart=Dt.add(start,{days:-offset,clearTime:!0});var end=Dt.add(start,{months:1,seconds:-1});return offset=me.startDay,offset>end.getDay()&&(offset-=7),me.viewEnd=Dt.add(end,{days:6-end.getDay()+offset}),void 0;default:me.viewStart=Dt.add(start,{days:-offset,clearTime:!0}),me.viewEnd=Dt.add(me.viewStart,{days:7*me.weekCount,seconds:-1})}},getViewBounds:function(){return{start:this.viewStart,end:this.viewEnd}},sortEventRecordsForDay:function(evts){2>evts.length||evts.sortBy(Ext.bind(function(evtA,evtB){var a=evtA.data,b=evtB.data,M=Extensible.calendar.data.EventMappings;if(a[M.IsAllDay.name])return-1;if(b[M.IsAllDay.name])return 1;if(this.spansHavePriority){var diff=Extensible.Date.diffDays;return diff(a[M.StartDate.name],a[M.EndDate.name])>0?diff(b[M.StartDate.name],b[M.EndDate.name])>0?a[M.StartDate.name].getTime()===b[M.StartDate.name].getTime()?b[M.EndDate.name].getTime()-a[M.EndDate.name].getTime():a[M.StartDate.name].getTime()-b[M.StartDate.name].getTime():-1:diff(b[M.StartDate.name],b[M.EndDate.name])>0?1:a[M.StartDate.name].getTime()-b[M.StartDate.name].getTime()}return a[M.StartDate.name].getTime()-b[M.StartDate.name].getTime()},this))},moveTo:function(dt,reload){return Ext.isDate(dt)?(this.setStartDate(dt,reload),this.startDate):dt},moveNext:function(reload){return this.moveTo(Extensible.Date.add(this.viewEnd,{days:1}),reload)},movePrev:function(reload){var days=Extensible.Date.diffDays(this.viewStart,this.viewEnd)+1;return this.moveDays(-days,reload)},moveMonths:function(value,reload){return this.moveTo(Extensible.Date.add(this.startDate,{months:value}),reload)},moveWeeks:function(value,reload){return this.moveTo(Extensible.Date.add(this.startDate,{days:7*value}),reload)},moveDays:function(value,reload){return this.moveTo(Extensible.Date.add(this.startDate,{days:value}),reload)},moveToday:function(reload){return this.moveTo(new Date,reload)},setStore:function(store,initial){var currStore=this.store;!initial&&currStore&&(currStore.un("load",this.onEventStoreLoad,this),currStore.un("clear",this.refresh,this),currStore.un("write",this.onWrite,this),currStore.getProxy().un("exception",this.onException,this)),store&&(store.on("load",this.onEventStoreLoad,this),store.on("clear",this.refresh,this),store.on("write",this.onWrite,this),store.getProxy().on("exception",this.onException,this)),this.store=store},onEventStoreLoad:function(store,recs,successful){Extensible.log("AbstractCalendar.onEventStoreLoad: store loaded"),this.refresh(!1)},onDataChanged:this.onEventStoreLoad,onException:function(proxy,response,operation){Ext.each(operation.records,function(rec){rec.dirty&&(rec.phantom?rec.unjoin(this.eventStore):rec.reject())},this),this.fireEvent("eventexception",this,response,operation)!==!1&&this.notifyOnException(response,operation)},getExceptionMessage:function(response,operation){var msg="";return response.responseText&&(msg+="<br><b>responseText</b>: "+response.responseText),response.message&&(msg+="<br><b>message</b>: "+response.message),response.status&&(msg+="<br><b>status</b>: "+response.status),response.statusText&&(msg+="<br><b>statusText</b>: "+response.statusText),operation.error&&operation.error.length&&(msg+="<br><b>processing error</b>: "+operation.error),msg||"<br>"+this.notifyOnExceptionDefaultMessage},notifyOnException:function(response,operation){Ext.Msg.alert(this.notifyOnExceptionTitle,this.notifyOnExceptionText+"<br>"+this.getExceptionMessage(response,operation))},setCalendarStore:function(store,initial){!initial&&this.calendarStore&&(this.calendarStore.un("datachanged",this.refresh,this),this.calendarStore.un("add",this.refresh,this),this.calendarStore.un("remove",this.refresh,this),this.calendarStore.un("update",this.refresh,this)),store&&(store.on("datachanged",this.refresh,this),store.on("add",this.refresh,this),store.on("remove",this.refresh,this),store.on("update",this.refresh,this)),this.calendarStore=store},getEventRecord:function(id){var idx=this.store.find(Extensible.calendar.data.EventMappings.EventId.name,id,0,!1,!0,!0);return this.store.getAt(idx)},getEventRecordFromEl:function(el){return this.getEventRecord(this.getEventIdFromEl(el))},getEventEditor:function(){return this.editWin=this.editWin||Ext.WindowMgr.get("ext-cal-editwin"),this.editWin||(this.editWin=Ext.create("Extensible.calendar.form.EventWindow",{id:"ext-cal-editwin",calendarStore:this.calendarStore,modal:this.editModal,enableEditDetails:this.enableEditDetails,startDay:this.startDay,listeners:{eventadd:{fn:function(win,rec,animTarget,options){win.currentView.onEventEditorAdd(null,rec,options)},scope:this},eventupdate:{fn:function(win,rec,animTarget,options){win.currentView.onEventEditorUpdate(null,rec,options)},scope:this},eventdelete:{fn:function(win,rec,animTarget,options){win.currentView.onEventEditorDelete(null,rec,options)},scope:this},editdetails:{fn:function(win,rec,animTarget,view){win.animateTarget=null,win.hide(),win.currentView.fireEvent("editdetails",win.currentView,rec)},scope:this},eventcancel:{fn:function(win,rec,animTarget){this.dismissEventEditor(null,animTarget),win.currentView.onEventEditorCancel()},scope:this}}})),this.editWin.currentView=this,this.editWin},showEventEditor:function(rec,animateTarget){return this.getEventEditor().show(rec,animateTarget,this),this},dismissEventEditor:function(dismissMethod,animTarget){this.newRecord&&this.newRecord.phantom&&this.store.remove(this.newRecord),delete this.newRecord;var editWin=Ext.WindowMgr.get("ext-cal-editwin");return editWin&&editWin[dismissMethod?dismissMethod:"hide"](animTarget),this},save:function(){this.store.autoSync||this.store.sync()},onWrite:function(store,operation){if(operation.wasSuccessful())switch(operation.action){case"create":this.onAdd(store,operation);break;case"update":this.onUpdate(store,operation,Ext.data.Record.COMMIT);break;case"destroy":this.onRemove(store,operation)}},onEventEditorAdd:function(form,rec){this.newRecord=rec,-1===this.store.indexOf(rec)&&this.store.add(rec),this.save(),this.fireEvent("eventadd",this,rec)},onEventEditorUpdate:function(form,rec){this.save(),this.fireEvent("eventupdate",this,rec)},onEventEditorDelete:function(form,rec){rec._deleting=!0,this.deleteEvent(rec)},onEventEditorCancel:function(form,rec){this.fireEvent("eventcancel",this,rec)},onDayClick:function(dt,ad,el){if(this.readOnly!==!0&&this.fireEvent("dayclick",this,Ext.Date.clone(dt),ad,el)!==!1){var M=Extensible.calendar.data.EventMappings,data={};data[M.StartDate.name]=dt,data[M.IsAllDay.name]=ad,this.showEventEditor(data,el)}},showEventMenu:function(el,xy){var me=this;me.eventMenu||(me.eventMenu=Ext.create("Extensible.calendar.menu.Event",{startDay:me.startDay,ownerCalendarPanel:me,listeners:{editdetails:Ext.bind(me.onEditDetails,me),eventdelete:Ext.bind(me.onDeleteEvent,me),eventmove:Ext.bind(me.onMoveEvent,me),eventcopy:Ext.bind(me.onCopyEvent,me)}})),me.eventMenu.showForEvent(me.getEventRecordFromEl(el),el,xy),me.menuActive=!0},onCopyEvent:function(menu,rec,newStartDate){this.menuActive=!1,this.shiftEvent(rec,newStartDate,"copy")},onMoveEvent:function(menu,rec,newStartDate){this.menuActive=!1,this.shiftEvent(rec,newStartDate,"move")},copyEvent:function(rec,newStartDate){this.shiftEvent(rec,newStartDate,"copy")},moveEvent:function(rec,newStartDate){this.shiftEvent(rec,newStartDate,"move")},shiftEvent:function(rec,newStartDate,moveOrCopy){var me=this,newRec;if("move"===moveOrCopy){if(0===Extensible.Date.compare(rec.getStartDate(),newStartDate))return;newRec=rec}else newRec=rec.clone();me.fireEvent("beforeevent"+moveOrCopy,me,newRec,Ext.Date.clone(newStartDate))!==!1&&(newRec.isRecurring()?me.onRecurrenceEditModeSelected("single",newRec,newStartDate,moveOrCopy):me.doShiftEvent(newRec,newStartDate,moveOrCopy))},onRecurrenceEditModeSelected:function(editMode,rec,newStartDate,moveOrCopy){var EventMappings=Extensible.calendar.data.EventMappings;editMode&&("copy"===moveOrCopy&&rec.clearRecurrence(),rec.data[EventMappings.REditMode.name]=editMode,rec.data[EventMappings.RInstanceStartDate.name]=rec.getStartDate(),this.doShiftEvent(rec,newStartDate,moveOrCopy))},doShiftEvent:function(rec,newStartDate,moveOrCopy){var EventMappings=Extensible.calendar.data.EventMappings,diff=newStartDate.getTime()-rec.getStartDate().getTime(),updateData={};updateData[EventMappings.StartDate.name]=newStartDate,updateData[EventMappings.EndDate.name]=Extensible.Date.add(rec.getEndDate(),{millis:diff}),rec.set(updateData),rec.phantom&&this.store.add(rec),this.save(),this.fireEvent("event"+moveOrCopy,this,rec)},onEditDetails:function(menu,rec,el){this.fireEvent("editdetails",this,rec,el),this.menuActive=!1},onDeleteEvent:function(menu,rec,el){rec._deleting=!0,this.deleteEvent(rec,el),this.menuActive=!1},deleteEvent:function(rec,el){var me=this;me.fireEvent("beforeeventdelete",me,rec,el)!==!1&&(rec.isRecurring()?(this.rangeEditWin=this.rangeEditWin||Ext.WindowMgr.get("ext-cal-rangeeditwin"),this.rangeEditWin||(this.rangeEditWin=new Extensible.form.recurrence.RangeEditWindow),this.rangeEditWin.prompt({callback:Ext.bind(me.onRecurrenceDeleteModeSelected,me,[rec,el],!0),scope:me})):me.doDeleteEvent(rec,el))},onRecurrenceDeleteModeSelected:function(editMode,rec,el){editMode&&(rec.data[Extensible.calendar.data.EventMappings.REditMode.name]=editMode,rec.data[Extensible.calendar.data.EventMappings.RInstanceStartDate.name]=rec.getStartDate(),this.doDeleteEvent(rec,el))},doDeleteEvent:function(rec,el){this.store.remove(rec),this.save(),this.fireEvent("eventdelete",this,rec,el)},onContextMenu:function(e,t){var el=e.getTarget(this.eventSelector,5,!0),match=!1;el&&(this.dismissEventEditor().showEventMenu(el,e.getXY()),match=!0),(match||this.suppressBrowserContextMenu===!0)&&e.preventDefault()},onClick:function(e,t){var me=this,el=e.getTarget(me.eventSelector,5);if(me.dropZone&&me.dropZone.clearShims(),me.menuActive===!0)return me.menuActive=!1,!0;if(el){var id=me.getEventIdFromEl(el),rec=me.getEventRecord(id);return rec&&me.fireEvent("eventclick",me,rec,el)!==!1&&me.readOnly!==!0&&me.showEventEditor(rec,el),!0}},onMouseOver:function(e,t){this.trackMouseOver===!1||void 0!==this.dragZone&&this.dragZone.dragging||this.handleEventMouseEvent(e,t,"over")||this.handleDayMouseEvent(e,t,"over")},onMouseOut:function(e,t){this.trackMouseOver===!1||void 0!==this.dragZone&&this.dragZone.dragging||this.handleEventMouseEvent(e,t,"out")||this.handleDayMouseEvent(e,t,"out")},handleEventMouseEvent:function(e,t,type){var el=e.getTarget(this.eventSelector,this.eventSelectorDepth,!0);if(el){var rel=Ext.get(e.getRelatedTarget());if(el===rel||el.contains(rel))return!0;var evtId=this.getEventIdFromEl(el);if(""!==this.eventOverClass){var els=this.getEventEls(evtId);els["over"===type?"addCls":"removeCls"](this.eventOverClass)}return this.fireEvent("event"+type,this,this.getEventRecord(evtId),el),!0}return!1},getDateFromId:function(id,delim){var parts=id.split(delim);return parts[parts.length-1]},handleDayMouseEvent:function(e,t,type){if(t=e.getTarget("td",3),t&&t.id&&t.id.indexOf(this.dayElIdDelimiter)>-1){var dt=this.getDateFromId(t.id,this.dayElIdDelimiter),rel=Ext.get(e.getRelatedTarget()),relTD,relDate;if(rel&&(relTD=rel.is("td")?rel:rel.up("td",3),relDate=relTD&&relTD.id?this.getDateFromId(relTD.id,this.dayElIdDelimiter):""),!rel||dt!==relDate){var el=this.getDayEl(dt);
el&&!Ext.isEmpty(this.dayOverClass)&&el["over"===type?"addCls":"removeCls"](this.dayOverClass),this.fireEvent("day"+type,this,Ext.Date.parseDate(dt,"Ymd"),el)}}},renderItems:function(){throw"This method must be implemented by a subclass"},isActiveView:function(){var calendarPanel=this.ownerCalendarPanel;return calendarPanel&&calendarPanel.getActiveView().id===this.id},destroy:function(){this.callParent(arguments),this.el&&this.el.un("contextmenu",this.onContextMenu,this),Ext.destroy(this.editWin,this.eventMenu,this.dragZone,this.dropZone)}}),Ext.define("Extensible.calendar.view.MonthDayDetail",{extend:"Ext.Component",alias:"widget.extensible.monthdaydetailview",requires:["Ext.XTemplate","Extensible.calendar.view.AbstractCalendar"],initComponent:function(){this.callParent(arguments),this.addEvents({eventsrendered:!0})},afterRender:function(){this.tpl=this.getTemplate(),this.callParent(arguments),this.el.on({click:this.view.onClick,mouseover:this.view.onMouseOver,mouseout:this.view.onMouseOut,scope:this.view})},getTemplate:function(){return this.tpl||(this.tpl=Ext.create("Ext.XTemplate",'<div class="ext-cal-mdv x-unselectable">','<table class="ext-cal-mvd-tbl" cellpadding="0" cellspacing="0">',"<tbody>",'<tpl for=".">','<tr><td class="ext-cal-ev">{markup}</td></tr>',"</tpl>","</tbody>","</table>","</div>")),this.tpl.compile(),this.tpl},update:function(dt){this.date=dt,this.refresh()},refresh:function(){if(this.rendered){var eventTpl=this.view.getEventTemplate(),templateData=[],evts=this.store.queryBy(function(rec){var thisDt=Ext.Date.clearTime(this.date,!0).getTime(),M=Extensible.calendar.data.EventMappings,recStart=Ext.Date.clearTime(rec.data[M.StartDate.name],!0).getTime(),startsOnDate=thisDt===recStart,spansDate=!1,calId=rec.data[M.CalendarId.name],calRec=this.calendarStore?this.calendarStore.getById(calId):null;if(calRec&&calRec.data[Extensible.calendar.data.CalendarMappings.IsHidden.name]===!0)return!1;if(!startsOnDate){var recEnd=Ext.Date.clearTime(rec.data[M.EndDate.name],!0).getTime();spansDate=thisDt>recStart&&recEnd>=thisDt}return startsOnDate||spansDate},this);Extensible.calendar.view.AbstractCalendar.prototype.sortEventRecordsForDay.call(this,evts),evts.each(function(evt){var item=evt.data,M=Extensible.calendar.data.EventMappings;item._renderAsAllDay=item[M.IsAllDay.name]||Extensible.Date.diffDays(item[M.StartDate.name],item[M.EndDate.name])>0,item.spanLeft=Extensible.Date.diffDays(item[M.StartDate.name],this.date)>0,item.spanRight=Extensible.Date.diffDays(this.date,item[M.EndDate.name])>0,item.spanCls=item.spanLeft?item.spanRight?"ext-cal-ev-spanboth":"ext-cal-ev-spanleft":item.spanRight?"ext-cal-ev-spanright":"",templateData.push({markup:eventTpl.apply(this.getTemplateEventData(item))})},this),this.tpl.overwrite(this.el,templateData),this.fireEvent("eventsrendered",this,this.date,evts.getCount())}},getTemplateEventData:function(evtData){var data=this.view.getTemplateEventData(evtData);return data._elId="dtl-"+data._elId,data}}),Ext.define("Extensible.calendar.view.Month",{extend:"Extensible.calendar.view.AbstractCalendar",alias:"widget.extensible.monthview",requires:["Ext.XTemplate","Ext.TaskManager","Extensible.calendar.template.Month","Extensible.calendar.util.WeekEventRenderer","Extensible.calendar.view.MonthDayDetail"],moreText:"+{0} more...",detailsTitleDateFormat:"F j",showTime:!0,showTodayText:!0,showHeader:!1,showWeekLinks:!1,showWeekNumbers:!1,weekLinkOverClass:"ext-week-link-over",morePanelMinWidth:220,daySelector:".ext-cal-day",moreSelector:".ext-cal-ev-more",weekLinkSelector:".ext-cal-week-link",weekCount:-1,dayCount:7,moreElIdDelimiter:"-more-",weekLinkIdDelimiter:"ext-cal-week-",initComponent:function(){this.callParent(arguments),this.addEvents({dayclick:!0,weekclick:!0,dayover:!0,dayout:!0})},initDD:function(){var cfg={view:this,createText:this.ddCreateEventText,copyText:this.ddCopyEventText,moveText:this.ddMoveEventText,ddGroup:this.ddGroup||this.id+"-MonthViewDD"};this.dragZone=Ext.create("Extensible.calendar.dd.DragZone",this.el,cfg),this.dropZone=Ext.create("Extensible.calendar.dd.DropZone",this.el,cfg)},onDestroy:function(){Ext.destroy(this.ddSelector),Ext.destroy(this.dragZone),Ext.destroy(this.dropZone),this.callParent(arguments)},afterRender:function(){this.tpl||(this.tpl=Ext.create("Extensible.calendar.template.Month",{id:this.id,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime,showHeader:this.showHeader,showWeekLinks:this.showWeekLinks,showWeekNumbers:this.showWeekNumbers}),this.tpl.compile()),this.addCls("ext-cal-monthview ext-cal-ct"),this.callParent(arguments)},onResize:function(){this.monitorResize&&(this.maxEventsPerDay=this.getMaxEventsPerDay(),this.refresh(!1))},forceSize:function(){if(this.showWeekLinks&&this.el){var hd=this.el.down(".ext-cal-hd-days-tbl"),bgTbl=this.el.select(".ext-cal-bg-tbl"),evTbl=this.el.select(".ext-cal-evt-tbl"),wkLinkW=this.el.down(".ext-cal-week-link").getWidth(),w=this.el.getWidth()-wkLinkW;hd.setWidth(w),bgTbl.setWidth(w),evTbl.setWidth(w)}this.callParent(arguments)},initClock:function(){null!==Ext.fly(this.id+"-clock")&&(this.prevClockDay=(new Date).getDay(),this.clockTask&&Ext.util.TaskManager.stop(this.clockTask),this.clockTask=Ext.util.TaskManager.start({run:function(){var el=Ext.fly(this.id+"-clock"),t=new Date;t.getDay()===this.prevClockDay?el&&el.update(Ext.Date.format(t,Extensible.Date.use24HourTime?"G:i":"g:ia")):(this.prevClockDay=t.getDay(),this.moveTo(t))},scope:this,interval:1e3}))},getMoreText:function(numEvents){return this.moreText},getEventBodyMarkup:function(){return this.eventBodyMarkup||(this.eventBodyMarkup=["{Title}",'<tpl if="_isReminder">','<i class="ext-cal-ic ext-cal-ic-rem">&#160;</i>',"</tpl>",'<tpl if="_isRecurring">','<i class="ext-cal-ic ext-cal-ic-rcr">&#160;</i>',"</tpl>",'<tpl if="spanLeft">','<i class="ext-cal-spl">&#160;</i>',"</tpl>",'<tpl if="spanRight">','<i class="ext-cal-spr">&#160;</i>',"</tpl>"].join("")),this.eventBodyMarkup},getEventTemplate:function(){if(!this.eventTpl){var tpl,body=this.getEventBodyMarkup();tpl=Ext.isIE||Ext.isOpera?Ext.create("Ext.XTemplate",'<tpl if="_renderAsAllDay">','<div class="{_extraCls} {spanCls} ext-cal-evt ext-cal-evo">','<div class="ext-cal-evm">','<div class="ext-cal-evi">',"</tpl>",'<tpl if="!_renderAsAllDay">','<div class="{_extraCls} ext-cal-evt ext-cal-evr">',"</tpl>",body,'<tpl if="_renderAsAllDay">',"</div>","</div>","</tpl>","</div>"):Ext.create("Ext.XTemplate",'<div class="{_extraCls} {spanCls} ext-cal-evt ext-cal-evr">',body,"</div>"),tpl.compile(),this.eventTpl=tpl}return this.eventTpl},getTemplateEventData:function(evtData){var M=Extensible.calendar.data.EventMappings,extraClasses=[this.getEventSelectorCls(evtData[M.EventId.name])],templateData={},colorCls="x-cal-"+evtData[Extensible.calendar.data.EventMappings.Color.name]+"-ad",title=evtData[M.Title.name],fmt=Extensible.Date.use24HourTime?"G:i ":"g:ia ",rec;if(extraClasses.push(colorCls),evtData._renderAsAllDay&&extraClasses.push("ext-evt-block"),this.getEventClass){rec=this.getEventRecord(evtData[M.EventId.name]);var cls=this.getEventClass(rec,!!evtData._renderAsAllDay,templateData,this.store);extraClasses.push(cls)}return templateData._extraCls=extraClasses.join(" "),templateData._isRecurring=M.RRule&&!!evtData[M.RRule.name],templateData._isReminder=evtData[M.Reminder.name]&&""!==evtData[M.Reminder.name],templateData.Title=(evtData[M.IsAllDay.name]?"":Ext.Date.format(evtData[M.StartDate.name],fmt))+(title&&0!==title.length?title:this.defaultEventTitleText),Ext.applyIf(templateData,evtData)},refresh:function(reloadData){Extensible.log("refresh (MonthView)"),this.detailPanel&&this.detailPanel.hide(),this.isHeaderView||(this.maxEventsPerDay=this.getMaxEventsPerDay()),this.callParent(arguments),this.showTime!==!1&&this.initClock()},renderItems:function(){Extensible.calendar.util.WeekEventRenderer.render({eventGrid:this.allDayOnly?this.allDayGrid:this.eventGrid,viewStart:this.viewStart,tpl:this.getEventTemplate(),maxEventsPerDay:this.maxEventsPerDay,viewId:this.id,templateDataFn:Ext.bind(this.getTemplateEventData,this),evtMaxCount:this.evtMaxCount,weekCount:this.weekCount,dayCount:this.dayCount,getMoreText:Ext.bind(this.getMoreText,this)}),this.fireEvent("eventsrendered",this)},getDayEl:function(dt){return Ext.get(this.getDayId(dt))},getDayId:function(dt){return Ext.isDate(dt)&&(dt=Ext.Date.format(dt,"Ymd")),this.id+this.dayElIdDelimiter+dt},getWeekIndex:function(dt){var el=this.getDayEl(dt).up(".ext-cal-wk-ct");return parseInt(el.id.split("-wk-")[1],10)},getDaySize:function(contentOnly){var box=this.el.getBox(),padding=this.getViewPadding(),w=(box.width-padding.width)/this.dayCount,h=(box.height-padding.height)/this.getWeekCount();if(contentOnly){var hd=this.el.select(".ext-cal-dtitle").last().parent("tr");h=hd?h-hd.getHeight(!0):h}return{height:h,width:w}},getEventHeight:function(){if(!this.eventHeight){var evt=this.el.select(".ext-cal-evt").first();if(!evt)return 16;this.eventHeight=evt.parent("td").getHeight()}return this.eventHeight},getMaxEventsPerDay:function(){var dayHeight=this.getDaySize(!0).height,eventHeight=this.getEventHeight(),max=Math.max(Math.floor((dayHeight-eventHeight)/eventHeight),0);return max},getViewPadding:function(sides){sides=sides||"tlbr";var top=sides.indexOf("t")>-1,left=sides.indexOf("l")>-1,right=sides.indexOf("r")>-1,height=this.showHeader&&top?this.el.select(".ext-cal-hd-days-tbl").first().getHeight():0,width=0;return this.isHeaderView?(left&&(width=this.el.select(".ext-cal-gutter").first().getWidth()),right&&(width+=this.el.select(".ext-cal-gutter-rt").first().getWidth())):this.showWeekLinks&&left&&(width=this.el.select(".ext-cal-week-link").first().getWidth()),{height:height,width:width}},getDayAt:function(x,y){var box=this.el.getBox(),padding=this.getViewPadding("tl"),daySize=this.getDaySize(),dayL=Math.floor((x-box.x-padding.width)/daySize.width),dayT=Math.floor((y-box.y-padding.height)/daySize.height),days=7*dayT+dayL,dt=Extensible.Date.add(this.viewStart,{days:days});return{date:dt,el:this.getDayEl(dt)}},moveNext:function(){return this.moveMonths(1,!0)},movePrev:function(){return this.moveMonths(-1,!0)},onInitDrag:function(){this.callParent(arguments),Ext.select(this.daySelector).removeCls(this.dayOverClass),this.detailPanel&&this.detailPanel.hide()},onMoreClick:function(dt){this.detailPanel?this.detailPanel.setTitle(Ext.Date.format(dt,this.detailsTitleDateFormat)):(this.detailPanel=Ext.create("Ext.Panel",{id:this.id+"-details-panel",title:Ext.Date.format(dt,this.detailsTitleDateFormat),layout:"fit",floating:!0,renderTo:Ext.getBody(),hideMode:"offsets",tools:[{type:"close",handler:function(e,t,p){p.ownerCt.hide()}}],items:{xtype:"extensible.monthdaydetailview",id:this.id+"-details-view",date:dt,view:this,store:this.store,calendarStore:this.calendarStore,listeners:{eventsrendered:Ext.bind(this.onDetailViewUpdated,this)}}}),this.enableContextMenus&&this.readOnly!==!0&&this.detailPanel.body.on("contextmenu",this.onContextMenu,this)),this.detailPanel.getComponent(this.id+"-details-view").update(dt)},onDetailViewUpdated:function(view,dt,numEvents){var p=this.detailPanel,dayEl=this.getDayEl(dt),box=dayEl.getBox(),innerTplHeight=p.el.down(".ext-cal-mdv").getHeight(),header=p.getDockedItems("header")[0],frameSize=p.frameSize||{top:0,bottom:0},frameHeight=frameSize.top+frameSize.bottom+header.getHeight(),bodyHeight=innerTplHeight+frameHeight+5,documentBodyHeight=Ext.getBody().getHeight()-20,calculatedHeight=Math.min(bodyHeight,documentBodyHeight);calculatedHeight===documentBodyHeight?p.body.addCls("ext-cal-overflow-y"):p.body.removeCls("ext-cal-overflow-y"),p.setWidth(Math.max(box.width,this.morePanelMinWidth)),p.setHeight(calculatedHeight),p.show(),p.getPositionEl().alignTo(dayEl,"t-t?")},onHide:function(){this.callParent(arguments),this.detailPanel&&this.detailPanel.hide()},onClick:function(e,t){this.detailPanel&&this.detailPanel.hide();var el=e.getTarget(this.moreSelector,3),dt;if(el)return dt=el.id.split(this.moreElIdDelimiter)[1],this.onMoreClick(Ext.Date.parseDate(dt,"Ymd")),void 0;if(el=e.getTarget(this.weekLinkSelector,3))return dt=el.id.split(this.weekLinkIdDelimiter)[1],this.fireEvent("weekclick",this,Ext.Date.parseDate(dt,"Ymd")),void 0;if(!Extensible.calendar.view.Month.superclass.onClick.apply(this,arguments)&&(el=e.getTarget("td",3),el&&el.id&&el.id.indexOf(this.dayElIdDelimiter)>-1)){var parts=el.id.split(this.dayElIdDelimiter);return dt=parts[parts.length-1],this.onDayClick(Ext.Date.parseDate(dt,"Ymd"),!1,Ext.get(this.getDayId(dt))),void 0}},handleDayMouseEvent:function(e,t,type){var el=e.getTarget(this.weekLinkSelector,3,!0);return el?(el["over"===type?"addCls":"removeCls"](this.weekLinkOverClass),void 0):(this.callParent(arguments),void 0)},destroy:function(){this.callParent(arguments),this.detailsPanel&&this.detailPanel.body.un("contextmenu",this.onContextMenu,this)}}),Ext.define("Extensible.calendar.view.DayHeader",{extend:"Extensible.calendar.view.Month",alias:"widget.extensible.dayheaderview",requires:["Extensible.calendar.template.DayHeader"],weekCount:1,dayCount:1,allDayOnly:!0,monitorResize:!1,isHeaderView:!0,afterRender:function(){this.tpl||(this.tpl=Ext.create("Extensible.calendar.template.DayHeader",{id:this.id,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime})),this.tpl.compile(),this.addCls("ext-cal-day-header"),this.callParent(arguments)},forceSize:Ext.emptyFn,refresh:function(reloadData){Extensible.log("refresh (DayHeaderView)"),this.callParent(arguments),this.recalcHeaderBox()},recalcHeaderBox:function(){var tbl=this.el.down(".ext-cal-evt-tbl"),h=tbl.getHeight();this.el.setHeight(h+7),this.el.down(".ext-cal-hd-ad-inner").setHeight(h+5),this.el.down(".ext-cal-bg-tbl").setHeight(h+5)},moveNext:function(){return this.moveDays(this.dayCount,!1)},movePrev:function(){return this.moveDays(-this.dayCount,!1)},onClick:function(e,t){var el=e.getTarget("td",3);if(el&&el.id&&el.id.indexOf(this.dayElIdDelimiter)>-1){var parts=el.id.split(this.dayElIdDelimiter),dt=parts[parts.length-1];return this.onDayClick(Ext.Date.parseDate(dt,"Ymd"),!0,Ext.get(this.getDayId(dt,!0))),void 0}this.callParent(arguments)},isActiveView:function(){var calendarPanel=this.ownerCalendarPanel;return calendarPanel&&calendarPanel.getActiveView().isDayView}}),Ext.define("Extensible.calendar.view.DayBody",{extend:"Extensible.calendar.view.AbstractCalendar",alias:"widget.extensible.daybodyview",requires:["Ext.XTemplate","Extensible.calendar.template.DayBody","Extensible.calendar.data.EventMappings","Extensible.calendar.dd.DayDragZone","Extensible.calendar.dd.DayDropZone"],dayColumnElIdDelimiter:"-day-col-",hourIncrement:60,initComponent:function(){this.callParent(arguments),this.readOnly===!0&&(this.enableEventResize=!1),this.incrementsPerHour=this.hourIncrement/this.ddIncrement,this.minEventHeight=this.minEventDisplayMinutes/(this.hourIncrement/this.hourHeight),this.addEvents({beforeeventresize:!0,eventresize:!0,dayclick:!0})},initDD:function(){var cfg={view:this,createText:this.ddCreateEventText,copyText:this.ddCopyEventText,moveText:this.ddMoveEventText,resizeText:this.ddResizeEventText,ddIncrement:this.ddIncrement,ddGroup:this.ddGroup||this.id+"-DayViewDD"};this.el.ddScrollConfig={vthresh:Ext.isIE||Ext.isOpera?100:40,hthresh:-1,frequency:50,increment:100,ddGroup:this.ddGroup||this.id+"-DayViewDD"},this.dragZone=Ext.create("Extensible.calendar.dd.DayDragZone",this.el,Ext.apply({},cfg)),this.dropZone=Ext.create("Extensible.calendar.dd.DayDropZone",this.el,cfg)},refresh:function(reloadData){Extensible.log("refresh (DayBodyView)");var top=this.el.getScroll().top;this.callParent(arguments),this.scrollReady&&this.scrollTo(top)},scrollTo:function(y,defer){defer=defer||Ext.isIE||Ext.isOpera,defer?Ext.defer(function(){this.el.scrollTo("top",y),this.scrollReady=!0},10,this):(this.el.scrollTo("top",y),this.scrollReady=!0)},afterRender:function(){this.tpl||(this.tpl=Ext.create("Extensible.calendar.template.DayBody",{id:this.id,dayCount:this.dayCount,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime,showHourSeparator:this.showHourSeparator,viewStartHour:this.viewStartHour,viewEndHour:this.viewEndHour,hourIncrement:this.hourIncrement,hourHeight:this.hourHeight})),this.tpl.compile(),this.addCls("ext-cal-body-ct"),this.callParent(arguments);var startHour=Math.max(this.scrollStartHour,this.viewStartHour),scrollStart=Math.max(0,startHour-this.viewStartHour);scrollStart>0&&this.scrollTo(scrollStart*this.hourHeight)},forceSize:Ext.emptyFn,onEventResize:function(rec,data){var me=this,EventMappings=Extensible.calendar.data.EventMappings,compareFn=Extensible.Date.compare;(0!==compareFn(rec.getStartDate(),data[EventMappings.StartDate.name])||0!==compareFn(rec.getEndDate(),data[EventMappings.EndDate.name]))&&me.fireEvent("beforeeventresize",me,rec,data)!==!1&&(rec.isRecurring()?me.recurrenceOptions.editSingleOnResize?me.onRecurrenceResizeModeSelected("single",rec,data):(this.rangeEditWin=this.rangeEditWin||Ext.WindowMgr.get("ext-cal-rangeeditwin"),this.rangeEditWin||(this.rangeEditWin=new Extensible.form.recurrence.RangeEditWindow),this.rangeEditWin.prompt({callback:Ext.bind(me.onRecurrenceResizeModeSelected,me,[rec,data],!0),scope:me})):me.doEventResize(rec,data))},onRecurrenceResizeModeSelected:function(editMode,rec,data){var EventMappings=Extensible.calendar.data.EventMappings;editMode&&(rec.data[EventMappings.REditMode.name]=editMode,rec.data[EventMappings.RInstanceStartDate.name]=rec.getStartDate(),this.doEventResize(rec,data))},doEventResize:function(rec,data){var EventMappings=Extensible.calendar.data.EventMappings,startDateName=EventMappings.StartDate.name,endDateName=EventMappings.EndDate.name,updateData={};updateData[startDateName]=data[startDateName],updateData[endDateName]=data[endDateName],EventMappings.Duration&&(updateData[EventMappings.Duration.name]=Extensible.Date.diff(data[startDateName],data[endDateName],Extensible.calendar.data.EventModel.resolution)),rec.set(updateData),this.save(),this.fireEvent("eventupdate",this,rec),this.fireEvent("eventresize",this,rec)},getEventBodyMarkup:function(){return this.eventBodyMarkup||(this.eventBodyMarkup=["{Title}",'<tpl if="_isReminder">','<i class="ext-cal-ic ext-cal-ic-rem">&#160;</i>',"</tpl>",'<tpl if="_isRecurring">','<i class="ext-cal-ic ext-cal-ic-rcr">&#160;</i>',"</tpl>"].join("")),this.eventBodyMarkup},getEventTemplate:function(){return this.eventTpl||(this.eventTpl=Ext.isIE||Ext.isOpera?Ext.create("Ext.XTemplate",'<div id="{_elId}" class="ext-cal-evt {_extraCls}" ','style="left: {_left}%; width: {_width}%; top: {_top}px;">','<div class="ext-cal-evb">&#160;</div>','<dl style="height: {_height}px;" class="ext-cal-evdm">','<dd class="ext-evt-bd">',this.getEventBodyMarkup(),"</dd>",this.enableEventResize?'<div class="ext-evt-rsz"><div class="ext-evt-rsz-h">&#160;</div></div>':"","</dl>",'<div class="ext-cal-evb">&#160;</div>',"</div>"):Ext.create("Ext.XTemplate",'<div id="{_elId}" class="{_extraCls} ext-cal-evt ext-cal-evr" ','style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">','<div class="ext-evt-bd">',this.getEventBodyMarkup(),"</div>",this.enableEventResize?'<div class="ext-evt-rsz"><div class="ext-evt-rsz-h">&#160;</div></div>':"","</div>"),this.eventTpl.compile()),this.eventTpl},getEventAllDayTemplate:function(){if(!this.eventAllDayTpl){var tpl,body=this.getEventBodyMarkup();tpl=Ext.isIE||Ext.isOpera?Ext.create("Ext.XTemplate",'<div class="ext-cal-evt" ','style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">','<div class="{_extraCls} {spanCls} ext-cal-evo">','<div class="ext-cal-evm">','<div class="ext-cal-evi">',body,"</div>","</div>","</div>","</div>"):Ext.create("Ext.XTemplate",'<div class="{_extraCls} {spanCls} ext-cal-evt ext-cal-evr" ','style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">',body,"</div>"),tpl.compile(),this.eventAllDayTpl=tpl}return this.eventAllDayTpl},getTemplateEventData:function(evtData){var M=Extensible.calendar.data.EventMappings,extraClasses=[this.getEventSelectorCls(evtData[M.EventId.name])],data={},colorCls="x-cal-"+evtData[Extensible.calendar.data.EventMappings.Colour.name]+"-ad",title=evtData[M.Title.name],fmt=Extensible.Date.use24HourTime?"G:i ":"g:ia ",rec;if(this.getTemplateEventBox(evtData),extraClasses.push(colorCls),extraClasses.push("ext-evt-block"),this.getEventClass){rec=this.getEventRecord(evtData[M.EventId.name]);var cls=this.getEventClass(rec,!!evtData._renderAsAllDay,data,this.store);extraClasses.push(cls)}return data._extraCls=extraClasses.join(" "),data._isRecurring=M.RRule&&evtData[M.RRule.name]&&""!==evtData[M.RRule.name],data._isReminder=evtData[M.Reminder.name]&&""!==evtData[M.Reminder.name],data.Title=(evtData[M.IsAllDay.name]?"":Ext.Date.format(evtData[M.StartDate.name],fmt))+(title&&0!==title.length?title:this.defaultEventTitleText),Ext.applyIf(data,evtData)},getEventPositionOffsets:function(){return{top:0,height:-1}},getTemplateEventBox:function(evtData){var heightFactor=this.hourHeight/this.hourIncrement,start=evtData[Extensible.calendar.data.EventMappings.StartDate.name],end=evtData[Extensible.calendar.data.EventMappings.EndDate.name],startOffset=Math.max(start.getHours()-this.viewStartHour,0),endOffset=Math.min(end.getHours()-this.viewStartHour,this.viewEndHour-this.viewStartHour),startMins=startOffset*this.hourIncrement,endMins=endOffset*this.hourIncrement,viewEndDt=Extensible.Date.add(Ext.Date.clone(end),{hours:this.viewEndHour,clearTime:!0}),evtOffsets=this.getEventPositionOffsets();start.getHours()>=this.viewStartHour&&(startMins+=start.getMinutes()),viewEndDt>=end&&(endMins+=end.getMinutes()),evtData._left=0,evtData._width=100,evtData._top=startMins*heightFactor+evtOffsets.top,evtData._height=Math.max((endMins-startMins)*heightFactor,this.minEventHeight)+evtOffsets.height},renderItems:function(){for(var day=0,evt,evts=[];this.dayCount>day;day++)for(var ev=0,emptyCells=0,skipped=0,d=this.eventGrid[0][day],ct=d?d.length:0;ct>ev;ev++)if(evt=d[ev]){var item=evt.data||evt.event.data,M=Extensible.calendar.data.EventMappings,ad=item[M.IsAllDay.name]===!0,span=this.isEventSpanning(evt.event||evt),renderAsAllDay=ad||span;renderAsAllDay||(Ext.apply(item,{cls:"ext-cal-ev",_positioned:!0}),evts.push({data:this.getTemplateEventData(item),date:Extensible.Date.add(this.viewStart,{days:day})}))}for(var i=0,j=0,overlapCols=[],l=evts.length,prevDt,evt2,dt;l>i;i++)for(evt=evts[i].data,evt2=null,dt=evt[Extensible.calendar.data.EventMappings.StartDate.name].getDate(),j=0;l>j;j++)i!==j&&(evt2=evts[j].data,this.isOverlapping(evt,evt2)&&(evt._overlap=void 0===evt._overlap?1:evt._overlap+1,j>i&&(void 0===evt._overcol&&(evt._overcol=0),evt2._overcol=evt._overcol+1,overlapCols[dt]=overlapCols[dt]?Math.max(overlapCols[dt],evt2._overcol):evt2._overcol)));for(i=0;l>i;i++){if(evt=evts[i].data,dt=evt[Extensible.calendar.data.EventMappings.StartDate.name].getDate(),void 0!==evt._overlap){var colWidth=100/(overlapCols[dt]+1),evtWidth=100-colWidth*evt._overlap;evt._width=colWidth,evt._left=colWidth*evt._overcol}var markup=this.getEventTemplate().apply(evt),target=this.id+"-day-col-"+Ext.Date.format(evts[i].date,"Ymd");Ext.DomHelper.append(target,markup)}this.fireEvent("eventsrendered",this)},getDayEl:function(dt){return Ext.get(this.getDayId(dt))},getDayId:function(dt){return Ext.isDate(dt)&&(dt=Ext.Date.format(dt,"Ymd")),this.id+this.dayColumnElIdDelimiter+dt},getDaySize:function(){var box=this.el.down(".ext-cal-day-col-inner").getBox();return{height:box.height,width:box.width}},getDayAt:function(x,y){var sel=".ext-cal-body-ct",xoffset=this.el.down(".ext-cal-day-times").getWidth(),viewBox=this.el.getBox(),daySize=this.getDaySize(!1),relX=x-viewBox.x-xoffset,dayIndex=Math.floor(relX/daySize.width),scroll=this.el.getScroll(),row=this.el.down(".ext-cal-bg-row"),rowH=row.getHeight()/this.incrementsPerHour,relY=y-viewBox.y-rowH+scroll.top,rowIndex=Math.max(0,Math.ceil(relY/rowH)),mins=rowIndex*(this.hourIncrement/this.incrementsPerHour),dt=Extensible.Date.add(this.viewStart,{days:dayIndex,minutes:mins,hours:this.viewStartHour}),el=this.getDayEl(dt),timeX=x;return el&&(timeX=el.getLeft()),{date:dt,el:el,timeBox:{x:timeX,y:rowIndex*this.hourHeight/this.incrementsPerHour+viewBox.y-scroll.top,width:daySize.width,height:rowH}}},onClick:function(e,t){if(!this.dragPending&&!Extensible.calendar.view.DayBody.superclass.onClick.apply(this,arguments)&&null===e.getTarget(".ext-cal-day-times",3)){var el=e.getTarget("td",3);if(el&&el.id&&el.id.indexOf(this.dayElIdDelimiter)>-1){var dt=this.getDateFromId(el.id,this.dayElIdDelimiter);return this.onDayClick(Ext.Date.parseDate(dt,"Ymd"),!0,Ext.get(this.getDayId(dt))),void 0}var day=this.getDayAt(e.getX(),e.getY());day&&day.date&&this.onDayClick(day.date,!1,null)}},isActiveView:function(){var calendarPanel=this.ownerCalendarPanel;return calendarPanel&&calendarPanel.getActiveView().isDayView}}),Ext.define("Extensible.calendar.view.Day",{extend:"Ext.container.Container",alias:"widget.extensible.dayview",requires:["Extensible.calendar.view.AbstractCalendar","Extensible.calendar.view.DayHeader","Extensible.calendar.view.DayBody"],showTime:!0,showTodayText:!0,dayCount:1,enableEventResize:!0,ddIncrement:30,minEventDisplayMinutes:30,showHourSeparator:!0,viewStartHour:0,viewEndHour:24,scrollStartHour:7,hourHeight:42,hideMode:"offsets",minBodyHeight:150,isDayView:!0,initComponent:function(){this.ddCreateEventText=this.ddCreateEventText||Extensible.calendar.view.AbstractCalendar.prototype.ddCreateEventText,this.ddMoveEventText=this.ddMoveEventText||Extensible.calendar.view.AbstractCalendar.prototype.ddMoveEventText,this.dayCount=this.dayCount>7?7:1>this.dayCount?1:this.dayCount;var cfg=Ext.apply({},this.initialConfig);cfg.showTime=this.showTime,cfg.showTodayText=this.showTodayText,cfg.todayText=this.todayText,cfg.dayCount=this.dayCount,cfg.weekCount=1,cfg.readOnly=this.readOnly,cfg.ddIncrement=this.ddIncrement,cfg.minEventDisplayMinutes=this.minEventDisplayMinutes;var header=Ext.applyIf({xtype:"extensible.dayheaderview",id:this.id+"-hd",ownerCalendarPanel:this.ownerCalendarPanel},cfg),body=Ext.applyIf({xtype:"extensible.daybodyview",enableEventResize:this.enableEventResize,showHourSeparator:this.showHourSeparator,viewStartHour:this.viewStartHour,viewEndHour:this.viewEndHour,scrollStartHour:this.scrollStartHour,hourHeight:this.hourHeight,id:this.id+"-bd",ownerCalendarPanel:this.ownerCalendarPanel},cfg);this.items=[header,body],this.addCls("ext-cal-dayview ext-cal-ct"),this.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.header=Ext.getCmp(this.id+"-hd"),this.body=Ext.getCmp(this.id+"-bd"),this.body.on("eventsrendered",this.forceSize,this),this.on("resize",this.onResize,this)},refresh:function(reloadData){Extensible.log("refresh (DayView)"),void 0===reloadData&&(reloadData=!1),this.header.refresh(reloadData),this.body.refresh(reloadData)},forceSize:function(){var me=this;Ext.defer(function(){var ct=me.el.up(".x-panel-body"),header=me.el.down(".ext-cal-day-header"),bodyHeight=ct?ct.getHeight()-header.getHeight():!1;bodyHeight&&(me.minBodyHeight>bodyHeight?(bodyHeight=me.minBodyHeight,me.addCls("ext-cal-overflow-y")):me.removeCls("ext-cal-overflow-y"),me.el.down(".ext-cal-body-ct").setHeight(bodyHeight-1))},Ext.isIE?1:0,me)},onResize:function(){this.forceSize(),Ext.defer(this.refresh,Ext.isIE?1:0,this)},doHide:function(){this.header.doHide.apply(this,arguments),this.body.doHide.apply(this,arguments)},getViewBounds:function(){return this.header.getViewBounds()},getStartDate:function(){return this.header.getStartDate()},setStartDate:function(dt){this.header.setStartDate(dt,!1),this.body.setStartDate(dt,!0)},renderItems:function(){this.header.renderItems(),this.body.renderItems()},isToday:function(){return this.header.isToday()},moveTo:function(dt){return dt=this.header.moveTo(dt,!1),this.body.moveTo(dt,!0),this.forceSize(),dt},moveNext:function(){var dt=this.header.moveNext(!1);return this.body.moveNext(!0),this.forceSize(),dt},movePrev:function(noRefresh){var dt=this.header.movePrev(!1);return this.body.movePrev(!0),this.forceSize(),dt},moveDays:function(value){var dt=this.header.moveDays(value,!1);return this.body.moveDays(value,!0),this.forceSize(),dt},moveToday:function(){var dt=this.header.moveToday(!1);return this.body.moveToday(!0),this.forceSize(),dt},showEventEditor:function(rec,animateTarget){return Extensible.calendar.view.AbstractCalendar.prototype.showEventEditor.apply(this,arguments)},dismissEventEditor:function(dismissMethod){return Extensible.calendar.view.AbstractCalendar.prototype.dismissEventEditor.apply(this,arguments)}}),Ext.define("Extensible.calendar.view.MultiDay",{extend:"Extensible.calendar.view.Day",alias:"widget.extensible.multidayview",dayCount:3,startDayIsStatic:!1,moveNext:function(reload){return this.moveDays(this.startDayIsStatic?7:this.dayCount,reload)},movePrev:function(reload){return this.moveDays(this.startDayIsStatic?-7:-this.dayCount,reload)}}),Ext.define("Extensible.calendar.view.Week",{extend:"Extensible.calendar.view.MultiDay",alias:"widget.extensible.weekview",dayCount:7}),Ext.define("Extensible.calendar.view.MultiWeek",{extend:"Extensible.calendar.view.Month",alias:"widget.extensible.multiweekview",weekCount:2,moveNext:function(){return this.moveWeeks(this.weekCount,!0)},movePrev:function(){return this.moveWeeks(-this.weekCount,!0)}}),Ext.define("Extensible.calendar.CalendarPanel",{extend:"Ext.panel.Panel",alias:"widget.extensible.calendarpanel",requires:["Ext.layout.container.Card","Extensible.calendar.view.Day","Extensible.calendar.view.Week","Extensible.calendar.view.Month","Extensible.calendar.view.MultiDay","Extensible.calendar.view.MultiWeek"],recurrence:!1,showDayView:!0,showMultiDayView:!1,showWeekView:!0,showMultiWeekView:!0,showMonthView:!0,showNavBar:!0,todayText:"Today",showTodayText:!0,showTime:!0,readOnly:!1,showNavToday:!0,showNavJump:!0,showNavNextPrev:!0,jumpToText:"Jump to:",goText:"Go",dayText:"Day",multiDayText:"{0} Days",weekText:"Week",multiWeekText:"{0} Weeks",monthText:"Month",editModal:!1,enableEditDetails:!0,startDay:0,layout:{type:"card",deferredRender:!0},startDate:new Date,initComponent:function(){this.tbar={cls:"ext-cal-toolbar",border:!0,items:[]},this.viewCount=0;var text,multiDayViewCount=this.multiDayViewCfg&&this.multiDayViewCfg.dayCount||3,multiWeekViewCount=this.multiWeekViewCfg&&this.multiWeekViewCfg.weekCount||2;this.showNavToday&&this.tbar.items.push({id:this.id+"-tb-today",text:this.todayText,handler:this.onTodayClick,scope:this}),this.showNavNextPrev&&(this.tbar.items.push({id:this.id+"-tb-prev",handler:this.onPrevClick,scope:this,iconCls:"x-tbar-page-prev"}),this.tbar.items.push({id:this.id+"-tb-next",handler:this.onNextClick,scope:this,iconCls:"x-tbar-page-next"})),this.showNavJump&&(this.tbar.items.push(this.jumpToText),this.tbar.items.push({id:this.id+"-tb-jump-dt",xtype:"datefield",width:120,showToday:!1,startDay:this.startDay}),this.tbar.items.push({id:this.id+"-tb-jump",text:this.goText,handler:this.onJumpClick,scope:this})),this.tbar.items.push("->"),this.showDayView&&(this.tbar.items.push({id:this.id+"-tb-day",text:this.dayText,handler:this.onDayNavClick,scope:this,toggleGroup:this.id+"-tb-views"}),this.viewCount++),this.showMultiDayView&&(text=Ext.String.format(this.getMultiDayText(multiDayViewCount),multiDayViewCount),this.tbar.items.push({id:this.id+"-tb-multiday",text:text,handler:this.onMultiDayNavClick,scope:this,toggleGroup:this.id+"-tb-views"}),this.viewCount++),this.showWeekView&&(this.tbar.items.push({id:this.id+"-tb-week",text:this.weekText,handler:this.onWeekNavClick,scope:this,toggleGroup:this.id+"-tb-views"}),this.viewCount++),this.showMultiWeekView&&(text=Ext.String.format(this.getMultiWeekText(multiWeekViewCount),multiWeekViewCount),this.tbar.items.push({id:this.id+"-tb-multiweek",text:text,handler:this.onMultiWeekNavClick,scope:this,toggleGroup:this.id+"-tb-views"}),this.viewCount++),(this.showMonthView||0===this.viewCount)&&(this.tbar.items.push({id:this.id+"-tb-month",text:this.monthText,handler:this.onMonthNavClick,scope:this,toggleGroup:this.id+"-tb-views"}),this.viewCount++,this.showMonthView=!0);
var idx=this.viewCount-1;this.activeItem=void 0===this.activeItem?idx:this.activeItem>idx?idx:this.activeItem,this.showNavBar===!1&&(delete this.tbar,this.addCls("x-calendar-nonav")),this.callParent(arguments),this.addEvents({eventadd:!0,eventupdate:!0,beforeeventdelete:!0,eventdelete:!0,eventcancel:!0,viewchange:!0,editdetails:!0}),this.addCls("x-cal-panel"),this.eventStore&&(this.store=this.eventStore,delete this.eventStore),this.setStore(this.store);var sharedViewCfg={showToday:this.showToday,todayText:this.todayText,showTodayText:this.showTodayText,showTime:this.showTime,readOnly:this.readOnly,recurrence:this.recurrence,store:this.store,calendarStore:this.calendarStore,editModal:this.editModal,enableEditDetails:this.enableEditDetails,startDay:this.startDay,ownerCalendarPanel:this};if(this.showDayView){var day=Ext.apply({xtype:"extensible.dayview",title:this.dayText},sharedViewCfg);day=Ext.apply(Ext.apply(day,this.viewConfig),this.dayViewCfg),day.id=this.id+"-day",this.initEventRelay(day),this.add(day)}if(this.showMultiDayView){var mday=Ext.apply({xtype:"extensible.multidayview",title:this.getMultiDayText(multiDayViewCount)},sharedViewCfg);mday=Ext.apply(Ext.apply(mday,this.viewConfig),this.multiDayViewCfg),mday.id=this.id+"-multiday",this.initEventRelay(mday),this.add(mday)}if(this.showWeekView){var wk=Ext.applyIf({xtype:"extensible.weekview",title:this.weekText},sharedViewCfg);wk=Ext.apply(Ext.apply(wk,this.viewConfig),this.weekViewCfg),wk.id=this.id+"-week",this.initEventRelay(wk),this.add(wk)}if(this.showMultiWeekView){var mwk=Ext.applyIf({xtype:"extensible.multiweekview",title:this.getMultiWeekText(multiWeekViewCount)},sharedViewCfg);mwk=Ext.apply(Ext.apply(mwk,this.viewConfig),this.multiWeekViewCfg),mwk.id=this.id+"-multiweek",this.initEventRelay(mwk),this.add(mwk)}if(this.showMonthView){var month=Ext.applyIf({xtype:"extensible.monthview",title:this.monthText,listeners:{weekclick:{fn:function(vw,dt){this.showWeek(dt)},scope:this}}},sharedViewCfg);month=Ext.apply(Ext.apply(month,this.viewConfig),this.monthViewCfg),month.id=this.id+"-month",this.initEventRelay(month),this.add(month)}this.add(Ext.applyIf({xtype:"extensible.eventeditform",id:this.id+"-edit",calendarStore:this.calendarStore,recurrence:this.recurrence,startDay:this.startDay,listeners:{eventadd:{scope:this,fn:this.onEventAdd},eventupdate:{scope:this,fn:this.onEventUpdate},eventdelete:{scope:this,fn:this.onEventDelete},eventcancel:{scope:this,fn:this.onEventCancel}}},this.editViewCfg))},initEventRelay:function(cfg){cfg.listeners=cfg.listeners||{},cfg.listeners.afterrender={fn:function(c){this.relayEvents(c,["eventsrendered","eventclick","dayclick","eventover","eventout","beforedatechange","datechange","rangeselect","beforeeventcopy","eventcopy","beforeeventmove","eventmove","initdrag","dayover","dayout","beforeeventresize","eventresize","eventadd","eventupdate","beforeeventdelete","eventdelete","eventcancel","eventexception"]),c.on("editdetails",this.onEditDetails,this)},scope:this,single:!0}},afterRender:function(){this.callParent(arguments),this.body.addCls("x-cal-body"),this.updateNavState(),this.setActiveView()},getMultiDayText:function(numDays){return this.multiDayText},getMultiWeekText:function(numWeeks){return this.multiWeekText},setStore:function(store,initial){var currStore=this.store;!initial&&currStore&&currStore.un("write",this.onWrite,this),store&&store.on("write",this.onWrite,this),this.store=store},onStoreAdd:function(ds,recs,index){this.hideEditForm()},onStoreUpdate:function(ds,rec,operation){operation===Ext.data.Record.COMMIT&&this.hideEditForm()},onStoreRemove:function(ds,rec){this.hideEditForm()},onWrite:function(store,operation){var rec=operation.records[0];switch(operation.action){case"create":this.onStoreAdd(store,rec);break;case"update":this.onStoreUpdate(store,rec,Ext.data.Record.COMMIT);break;case"destroy":this.onStoreRemove(store,rec)}},onEditDetails:function(vw,rec,el){this.fireEvent("editdetails",this,vw,rec,el)!==!1&&this.showEditForm(rec)},save:function(){this.store.autoSync||this.store.sync()},onEventAdd:function(form,rec){rec.store||(this.store.add(rec),this.save()),this.fireEvent("eventadd",this,rec)},onEventUpdate:function(form,rec){this.save(),this.fireEvent("eventupdate",this,rec)},onEventDelete:function(form,rec){this.store.remove(rec),this.save(),this.fireEvent("eventdelete",this,rec)},onEventCancel:function(form,rec){this.hideEditForm(),this.fireEvent("eventcancel",this,rec)},showEditForm:function(rec){return this.preEditView=this.layout.getActiveItem().id,this.setActiveView(this.id+"-edit"),this.layout.getActiveItem().loadRecord(rec),this},hideEditForm:function(){return this.preEditView&&(this.setActiveView(this.preEditView),delete this.preEditView),this},setActiveView:function(id,startDate){var me=this,layout=me.layout,editViewId=me.id+"-edit",toolbar;startDate&&(me.startDate=startDate),id!==layout.getActiveItem().id&&(toolbar=me.getDockedItems("toolbar")[0],toolbar&&toolbar[id===editViewId?"hide":"show"](),layout.setActiveItem(id||me.activeItem),me.doComponentLayout(),me.activeView=layout.getActiveItem(),id!==editViewId&&(id&&id!==me.preEditView&&layout.activeItem.setStartDate(me.startDate,!0),me.updateNavState()),me.fireViewChange())},fireViewChange:function(){if(this.layout&&this.layout.getActiveItem){var view=this.layout.getActiveItem(),cloneDt=Ext.Date.clone;if(view){var info;if(view.getViewBounds){var vb=view.getViewBounds();info={viewStart:cloneDt(vb.start),viewEnd:cloneDt(vb.end),activeDate:cloneDt(view.getStartDate())}}view.dismissEventEditor&&view.dismissEventEditor(),this.fireEvent("viewchange",this,view,info)}}},updateNavState:function(){var me=this,activeItem=me.layout.activeItem;if(activeItem&&me.showNavBar!==!1){var suffix=activeItem.id.split(me.id+"-")[1],btn=Ext.getCmp(me.id+"-tb-"+suffix);me.showNavToday&&Ext.getCmp(me.id+"-tb-today").setDisabled(activeItem.isToday()),btn.toggle(!0)}},setStartDate:function(dt){return Extensible.log("setStartDate (CalendarPanel"),this.startDate=dt,this.layout.activeItem.setStartDate(dt,!0),this.updateNavState(),this.fireViewChange(),this},showWeek:function(dt){this.setActiveView(this.id+"-week",dt)},onTodayClick:function(){this.startDate=this.layout.activeItem.moveToday(!0),this.updateNavState(),this.fireViewChange()},onJumpClick:function(){var dt=Ext.getCmp(this.id+"-tb-jump-dt").getValue();""!==dt&&(this.startDate=this.layout.activeItem.moveTo(dt,!0),this.updateNavState(),this.fireViewChange())},onPrevClick:function(){this.startDate=this.layout.activeItem.movePrev(!0),this.updateNavState(),this.fireViewChange()},onNextClick:function(){this.startDate=this.layout.activeItem.moveNext(!0),this.updateNavState(),this.fireViewChange()},onDayNavClick:function(){this.setActiveView(this.id+"-day")},onMultiDayNavClick:function(){this.setActiveView(this.id+"-multiday")},onWeekNavClick:function(){this.setActiveView(this.id+"-week")},onMultiWeekNavClick:function(){this.setActiveView(this.id+"-multiweek")},onMonthNavClick:function(){this.setActiveView(this.id+"-month")},getActiveView:function(){return this.layout.activeItem}});

            Rally.launchApp('CustomApp', {
                name:"calendar",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        /*!
 * Extensible 1.5.2
 * Copyright(c) 2010-2013 Extensible, LLC
 * licensing@ext.ensible.com
 * http://ext.ensible.com
 */.x-strict .x-webkit .x-small-editor .x-form-field-wrap .x-form-trigger{height:21px}.x-panel-tbar .ext-cal-toolbar{padding:3px;border-bottom-width:0 !important}.x-panel-tbar .ext-cal-toolbar .x-btn button{color:#555}.x-panel-tbar .ext-cal-toolbar .x-toolbar-cell{padding:0 3px}.ext-cal-ct{position:relative;font-family:helvetica,arial,sans-serif}.x-cal-panel .x-panel-body{background:white !important}.x-panel-default-framed .x-panel-body .ext-cal-ct,.x-panel-default-framed .x-panel-body .ext-evt-edit-form{border-left:1px solid #99BBE8;border-right:1px solid #99BBE8}.x-panel-default-framed .x-panel-body .ext-cal-day-header{border:0}.ext-cal-ct img{border:0 none}.ext-cal-inner-ct{height:100%;line-height:14px;position:relative;background:#eee;white-space:nowrap}.ext-cal-ct td,.ext-cal-mdv td{font-size:11px}.x-cal-body{border-top:0 !important}.x-window .x-window-body .x-cal-body{border:0 !important}.x-window .ext-cal-toolbar{border:0 !important}.ext-cal-bg-tbl{height:100%;left:0;position:absolute;table-layout:fixed;top:0;width:100%}.x-ie9 .ext-cal-dayview .ext-cal-body-ct .ext-cal-bg-tbl{position:relative}.ext-cal-hd-days-tbl{background:#D3E1F1;color:#555;table-layout:fixed;top:18px;width:100%;font-size:12px;line-height:12px}.ext-cal-month-hd .ext-cal-hd-days-tbl{border-top:1px solid #99BBE8;background:#eee}.x-calendar-nonav .ext-cal-month-hd .ext-cal-hd-days-tbl{border-top:0}.ext-cal-month-hd .ext-cal-hd-day{border-left:1px solid #C3D9FF}.ext-cal-hd-ct{border-bottom:1px solid #bcf}.ext-cal-hd-day{text-align:center;padding:4px 0;white-space:nowrap}.ext-cal-dayview .ext-cal-hd-days-tbl{table-layout:fixed;width:100%;background-color:#CDDCEF;overflow:hidden;font-size:11px;line-height:14px;height:100%}.ext-cal-hd-days-td{padding-bottom:2px}.ext-cal-dayview .ext-cal-hd-ct{height:100%}.ext-cal-dayview .ext-cal-gutter{width:50px}.ext-cal-dayview .ext-cal-gutter-rt{width:15px}.x-win .ext-cal-dayview .ext-cal-gutter-rt{width:16px}.x-no-scrollbar .ext-cal-hd-days-td{width:100%}.x-no-scrollbar .ext-cal-dayview .ext-cal-gutter-rt,.x-no-scrollbar .x-win .ext-cal-dayview .ext-cal-gutter-rt{width:0}.ext-cal-hd-ad{background-color:#fff;font-size:11px;line-height:14px;border-color:#e3e9ff #e3e9ff #e3e9ff #e3e9ff;border-style:solid;border-width:0 1px 1px 0}.ext-cal-hd-ad-inner{position:relative;height:100%}.x-calendar-nonav .ext-cal-hd-ad-inner{margin-top:3px}.ext-cal-dayview .ext-cal-dtitle{padding:8px 1px 2px}.ext-cal-hd-ad-bg-tbl{position:absolute;left:0;table-layout:fixed;width:100%}.ext-cal-hd-ad .st-c{padding:1px 1px 0 1px}.ext-cal-dayview .ext-cal-body-ct{position:relative;overflow-y:scroll;overflow-x:hidden;padding:0;line-height:normal;background:#eee;margin-top:1px}.ext-cal-dayview .ext-cal-body-ct .ext-cal-bg-tbl{height:1008px}.ext-cal-dayview .ext-cal-bg-tbl{background-color:#fff;margin-top:-1px;border-bottom:1px solid #bcf}.ext-cal-dayview .ext-cal-bg-rows{position:relative;margin-left:1px}.ext-cal-dayview .ext-cal-bg-rows-inner{position:absolute;width:100%}.x-gecko .ext-cal-dayview .ext-cal-bg-rows-inner{top:-1px}.ext-cal-dayview .ext-cal-bg-row{height:42px}.ext-cal-dayview .ext-cal-bg-row-div{border-bottom:1px dotted #ddd;border-top:1px solid #ddd;font-size:1px;height:21px;margin-bottom:20px}.ext-cal-dayview .ext-cal-bg-row .no-sep{border-bottom:0}.ext-cal-dayview .ext-row-1{border-top:0}.ext-cal-day-times{background-color:#f6f9fc;color:#666;padding:1px 0 0 0;text-align:right;vertical-align:top}.ext-cal-day-time-inner{height:42px;border-bottom:1px solid #ddd;padding-right:2px}.ext-cal-day-col{border-left:1px solid #ddd;vertical-align:top}.ext-cal-day-col-inner{position:relative;cursor:default}.ext-cal-day-col-gutter{position:relative;margin-right:15px;height:1008px}.x-ie .ext-cal-day-col-gutter,.x-opera .ext-cal-day-col-gutter{margin-right:10px}.x-ie6 .ext-cal-day-col-gutter{zoom:1}.ext-cal-monthview .ext-cal-hd-ct{left:0;top:0;position:absolute;width:100%}.ext-cal-monthview .ext-cal-body-ct{background:#fff;bottom:0;left:0;border:0;overflow:hidden;position:absolute;top:20px;width:100%}.ext-cal-monthview .ext-cal-noheader .ext-cal-hd-ct{display:none}.ext-cal-monthview .ext-cal-noheader .ext-cal-body-ct{top:0}.ext-cal-monthview .ext-cal-week-link,.ext-cal-monthview .ext-cal-week-link-hd{width:20px;position:absolute;left:0;top:0;height:100%;background:#EFEFEF;border-top:1px solid #C3D9FF;font-size:10px;color:#999;padding:3px 0 0;text-align:center;cursor:pointer}.ext-cal-monthview .ext-cal-week-link-hd{border-top:1px solid #99BBE8}.x-calendar-nonav .ext-cal-monthview .ext-cal-week-link-hd{border-top:0}.ext-cal-week-links .ext-cal-bg-tbl{left:20px}.ext-cal-week-links .ext-cal-evt-tbl,.ext-cal-week-links .ext-cal-hd-days-tbl{margin-left:20px}.ext-cal-monthview .ext-week-link-over{background:#E0E7EF}.ext-cal-week-links .ext-cal-day-first{border-left:1px solid #C3D9FF}.ext-cal-hide-navbar .ext-cal-hd-ct{height:25px}.ext-cal-hide-navbar .ext-cal-body-ct{top:24px}.ext-cal-wk-ct{left:0;overflow:hidden;position:absolute;width:100%;height:100px}.ext-cal-monthview .ext-cal-wk-ct{height:100%}.ext-cal-day{border-left:1px solid #C3D9FF;cursor:pointer}.ext-cal-day-first{border-left:0}.ext-cal-ev,.ext-cal-dtitle{cursor:pointer}.ext-cal-readonly .ext-cal-day,.ext-cal-readonly .ext-cal-dtitle{cursor:default}.ext-day-over{background:#D1EAEF !important}.ext-cal-evt-tbl{position:relative;table-layout:fixed;width:100%}td.ext-cal-dtitle{font-family:helvetica,arial,sans-serif;border-top:1px solid #C3D9FF;color:#A7C6DF;line-height:14px;overflow:hidden;text-align:right;font-size:16px;padding-top:1px;padding-right:1px;padding-left:1px}td.ext-cal-dtitle-first{border-top:1px solid #BBCCFF}td.ext-cal-dtitle div{padding:2px 4px 1px}td.ext-cal-dtitle-today div{color:#BFA52F;white-space:nowrap}.ext-cal-dtitle-time{font-size:11px}.ext-cal-day-we{background:#EFF9FC}.ext-cal-day-today{background:#FFF4BF}.ext-cal-dtitle-prev div,.ext-cal-dtitle-next div{color:#bbb}.ext-cal-day-prev,.ext-cal-day-next{background:#EFEFEF}.ext-cal-ev{font-family:Verdana,sans-serif;padding:1px 1px 0 2px;vertical-align:top}.ext-cal-ev-more{text-align:center}.ext-cal-ev-more a,.ext-cal-ev-more a:visited{color:#369;cursor:pointer}.ext-cal-mvd-tbl{width:100%;table-layout:fixed}.ext-cal-evt{cursor:pointer}.ext-cal-evr{-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px;overflow:hidden;padding:1px 1px 1px 5px;white-space:nowrap;text-overflow:ellipsis;border:0}.ext-cal-evo{border-top:1px solid;border-bottom:1px solid;border-right:0;border-left:0;margin:0 1px;cursor:pointer;position:relative}.ext-cal-day-col .ext-cal-evo{height:100%}.ext-cal-evm{border-left:1px solid;border-right:1px solid;border-top:0;border-bottom:0;margin:0 -1px;zoom:1;padding-left:3px}.ext-cal-evi{width:100%;white-space:nowrap;overflow:hidden}.ext-cal-day-col .ext-cal-evt{position:absolute;overflow:hidden;cursor:default;color:#fff;-moz-user-select:none}.ext-cal-evt dl{margin:0;border:0 1px;overflow:hidden;border-width:0 1px;border-style:solid}.x-ie6 .ext-cal-evt dl{zoom:1}.ext-cal-evt dd{margin:0;overflow:hidden;font-size:11px;text-align:left;word-wrap:break-word}.ext-cal-evdm{border:1px solid;-moz-border-radius:3px;-webkit-border-radius:3px;border-radius:3px}.ext-cal-evdm dt{margin-top:0}.ext-cal-day-col .ext-cal-evt a:link,.ext-cal-day-col .ext-cal-evt a:visited,.ext-cal-day-col .ext-cal-evt a:active{text-decoration:none;color:#fff}.ext-cal-evb{height:1px;overflow:hidden;margin:0 2px;border-top-width:1px;border-top-style:solid}.x-opera .ext-cal-evb,.x-strict .x-ie .ext-cal-evb{height:0}.ext-cal-ev-spanboth,.ext-cal-ev-spanleft,.ext-cal-ev-spanright{-moz-border-radius:0;-webkit-border-radius:0;border-radius:0;position:relative}.ext-cal-ev-spanleft{-moz-border-radius-topright:5px;-moz-border-radius-bottomright:5px;-webkit-border-top-right-radius:5px;-webkit-border-bottom-right-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;xpadding-left:5px}.ext-cal-ev-spanright{-moz-border-radius-topleft:5px;-moz-border-radius-bottomleft:5px;-webkit-border-top-left-radius:5px;-webkit-border-bottom-left-radius:5px;border-top-left-radius:5px;border-bottom-left-radius:5px;xpadding-right:5px}.ext-cal-ev-spanboth .ext-cal-evm{margin:0}.ext-cal-ev-spanright .ext-cal-evm{margin:0 0 0 -1px}.ext-cal-ev-spanleft .ext-cal-evm{margin:0 -1px 0 0}.ext-cal-spl{background-position:-1px -11px;left:0}.ext-cal-spr{background-position:0 -11px;right:-2px}.x-ie .ext-cal-spr{right:-5px}.ext-cal-ic{background-image:url(../images/default/calendar-sprites.gif);background-repeat:no-repeat;display:inline-block;height:11px;line-height:11px;margin-left:4px;width:14px}.ext-cal-ic-rcr{background-position:0 0}.ext-cal-ic-rem{background-position:-14px 0}.ext-cal-dd-sel-ct{display:block;z-index:10;position:absolute;height:0;left:0;top:0;width:0}.ext-cal-dd-sel{background-color:#C3D9FF;font-size:0;line-height:0;opacity:0.5;position:absolute}.ext-evt-over{opacity:.8}.ext-calendar-picker{position:relative}.x-gecko .ext-calendar-picker{display:block}.ext-calendar-picker .x-form-text{padding-left:27px}.ext-calendar-picker .x-combo-list-item{padding-left:24px}.ext-cal-picker-icon{width:20px;height:16px;margin-right:5px;-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px;float:left}.ext-cal-picker-mainicon{float:none;position:absolute;top:3px;left:4px}.ext-evt-rsz{position:absolute;bottom:0;height:5px;line-height:5px;width:100%;text-align:center;cursor:s-resize}.x-gecko .ext-evt-rsz,.x-webkit .ext-evt-rsz{cursor:ns-resize}.ext-evt-rsz-h{display:none;border-top:3px double;border-color:white;font-size:0;height:0;line-height:0;margin-left:auto;margin-right:auto;width:20px;opacity:.5;-moz-opacity:.5;-khtml-opacity:.5}.ext-evt-over .ext-evt-rsz-h{display:block}.x-ie .ext-evt-rsz-h{border-color:#ccc}.x-strict .x-ie8 .ext-evt-rsz-h{border-color:#fff;filter:alpha(opacity=50)}.ext-cal-day-col .ext-cal-evt{position:absolute}.ext-cal-day-col .ext-cal-evr,.ext-cal-day-col .ext-cal-evi{white-space:normal}.ext-dd-shim{z-index:1000;overflow:hidden;position:absolute;left:0;top:0;opacity:.40;-moz-opacity:.40;-khtml-opacity:.40;filter:alpha(opacity=40);background:#C3D9FF}.ext-dd-ghost-ct{color:#000;font:normal 11px arial,helvetica,sans-serif;border:1px solid;border-color:#ddd #bbb #bbb #ddd;background-color:#fff;padding:3px;padding-left:20px;white-space:nowrap}.ext-dd-ghost-ct .x-dd-drag-ghost{border:0;background:none;padding:0;width:150px}.ext-dd-ghost-ct .ext-evt-rsz{display:none}.ext-cal-nav-picker{border-style:none none solid;border-color:#99BBE8}.ext-cal-nav-picker .x-datepicker-header{background:#d3e1f1 url(../images/default/ext/toolbar-bg.gif) repeat-x}.ext-cal-nav-picker .x-datepicker-month,.ext-cal-nav-picker .x-datepicker-prev,.ext-cal-nav-picker .x-datepicker-next{background:transparent}.ext-cal-nav-picker .x-datepicker-prev a{background-image:url(../images/default/ext/page-prev.gif)}.ext-cal-nav-picker .x-datepicker-next a{background-image:url(../images/default/ext/page-next.gif)}.ext-cal-nav-picker .x-datepicker-month{padding:3px 0}.ext-cal-nav-picker .x-datepicker-month .x-btn-inner{color:#555 !important;font-weight:bold;font-family:arial,tahoma,verdana,helvetica}.ext-cal-nav-picker .x-datepicker-month .x-btn-split-right{background-image:url(../images/default/ext/button-arrow.gif) !important;background-position:right 4px}.ext-cal-nav-picker .x-datepicker-inner{border-top:1px solid #BBCCFF}.ext-cal-nav-picker .x-datepicker-inner th{background:none;border-bottom:1px solid #BBCCFF}.ext-cal-nav-picker .x-datepicker-inner .x-datepicker-today a{border-color:#BFA52F;background:#FFF4BF}.ext-cal-nav-picker .x-monthpicker{border:0;border-bottom:1px solid #99BBE8;top:0 !important;left:0 !important}.ext-cal-nav-picker .x-datepicker-footer{background:#d3e1f1 url(../images/default/ext/toolbar-bg.gif) repeat-x}.ext-cal-evt-win{z-index:12100}.x-gecko .ext-cal-event-win .x-window-body .x-form-item{overflow:hidden}.ext-cal-event-win .x-window-body .x-panel-body{background:transparent}.ext-cal-event-win a:link,.ext-cal-event-win a:visited{color:#15428B}.ext-evt-edit-form{height:100%}.ext-evt-edit-form .x-form-item{margin-bottom:8px}.ext-evt-edit-form .x-panel-bbar .x-toolbar{border-bottom:1px solid #99BBE8}.ext-evt-edit-form .x-panel-header{background:transparent url(../images/default/ext-cal-edit-hd.png) repeat-x;padding:9px 0 4px 5px !important;font-size:13px !important;font-family:helvetica,arial,sans-serif;border-top:0;border-bottom:1px solid #BBCCFF}.x-panel-mc .ext-evt-edit-form .x-panel-header{border-top:1px solid #99BBE8}.ext-evt-edit-form .x-toolbar-footer{padding:10px;background:#DFE8F6}.ext-cal-event-win .x-panel-body{padding:8px 10px 5px}.ext-dt-range{margin-bottom:0 !important}.ext-dt-range .x-form-cb-wrap{white-space:nowrap}.extensible-cal-icon-evt-edit{background-image:url(../images/default/silk/calendar_edit.png) !important}.extensible-cal-icon-evt-del{background-image:url(../images/default/silk/cross.png) !important}.extensible-cal-icon-evt-move{background-image:url(../images/default/silk/date_go.png) !important}.x-calendar-list{border-bottom:1px solid #99BBE8}.x-calendar-list ul{margin:0;padding:0}.x-calendar-list .x-panel-body{padding:4px 2px 2px;background:#fff !important;font-family:helvetica,arial,sans-serif;font-size:12px}.x-calendar-list .x-panel-header-text{color:#555}.x-calendar-list li{position:relative;margin-bottom:2px;cursor:pointer}.x-calendar-list li em{background-image:url(../images/default/calendar-sprites.gif);background-repeat:no-repeat;display:inline-block;position:absolute;height:11px;line-height:11px;width:12px;top:2px;background-position:-40px 0;right:0}.x-calendar-list .hover em{background-position:-28px 0;right:2px;opacity:.7;-moz-opacity:.7}.x-calendar-list .ext-cal-evr{-moz-border-radius:3px;-webkit-border-radius:3px;border-radius:3px}.ext-cal-hidden,.ext-cal-hidden .ext-cal-evi{background-image:url(../images/default/ext-cal-list-hidden.png);background-repeat:no-repeat;background-position:top right;opacity:.5;-moz-opacity:.5}.x-ie .ext-cal-hidden{filter:alpha(opacity=50);zoom:1}.x-ie .ext-cal-hidden .ext-cal-evi{width:100%;height:100%}.x-ie6 .ext-cal-hidden .ext-cal-evi{background-image:url(../images/default/ext-cal-list-hidden-ie6.png)}.extensible-cal-icon-cal-show{background-image:url(../images/default/silk/calendar_view_month.png) !important}.extensible-cal-icon-cal-colors{background-image:url(../images/default/silk/color_wheel.png) !important}.x-calendar-list-menu .x-color-picker{padding-left:32px;width:210px;background:inherit;height:90px}.x-calendar-list-menu .x-color-picker a{border:1px solid #f0f0f0;float:left;padding:2px;text-decoration:none;-moz-outline:0 none;outline:0 none;cursor:pointer}.x-calendar-list-menu .x-color-picker a:hover,.x-calendar-list-menu .x-color-picker a.x-color-picker-selected{border-color:#8BB8F3}.x-calendar-list-menu .x-color-picker em{display:block;border:1px solid #aca899}.x-calendar-list-menu .x-color-picker em span{cursor:pointer;display:block;height:14px;width:14px;line-height:10px}
    </style>
    <style type="text/css">
        /*!
 * Extensible 1.5.2
 * Copyright(c) 2010-2013 Extensible, LLC
 * licensing@ext.ensible.com
 * http://ext.ensible.com
 */.ext-cal-evr,.ext-cal-evi,.ext-cal-evt dl{color:#fff}.x-cal-default,.x-cal-default-x .ext-cal-evb,.ext-ie .x-cal-default-ad,.ext-opera .x-cal-default-ad{color:#668CB3}.ext-cal-day-col .x-cal-default,.ext-dd-drag-proxy .x-cal-default,.x-cal-default-ad,.x-cal-default-ad .ext-cal-evm,.x-cal-default .ext-cal-picker-icon,.x-cal-default-x dl,.x-calendar-palette em .x-cal-default{background-color:#668CB3}.x-cal-default-ad,.x-cal-default-ad .ext-cal-evm{border-color:#668CB3}.x-cal-1,.x-cal-1-x .ext-cal-evb,.ext-ie .x-cal-1-ad,.ext-opera .x-cal-1-ad{color:#105cab}.ext-cal-day-col .x-cal-1,.ext-dd-drag-proxy .x-cal-1,.x-cal-1-ad,.x-cal-1-ad .ext-cal-evm,.x-cal-1 .ext-cal-picker-icon,.x-cal-1-x dl,.x-calendar-palette .x-cal-1 span{background-color:#105cab}.x-cal-1-ad,.x-cal-1-ad .ext-cal-evm{border-color:#105cab}.x-cal-2,.x-cal-2-x .ext-cal-evb,.ext-ie .x-cal-2-ad,.ext-opera .x-cal-2-ad{color:#ff1010}.ext-cal-day-col .x-cal-2,.ext-dd-drag-proxy .x-cal-2,.x-cal-2-ad,.x-cal-2-ad .ext-cal-evm,.x-cal-2 .ext-cal-picker-icon,.x-cal-2-x dl,.x-calendar-palette .x-cal-2 span{background-color:#ff1010}.x-cal-2-ad,.x-cal-2-ad .ext-cal-evm{border-color:#ff1010}.x-cal-3,.x-cal-3-x .ext-cal-evb,.ext-ie .x-cal-3-ad,.ext-opera .x-cal-3-ad{color:#107c1e}.ext-cal-day-col .x-cal-3,.ext-dd-drag-proxy .x-cal-3,.x-cal-3-ad,.x-cal-3-ad .ext-cal-evm,.x-cal-3 .ext-cal-picker-icon,.x-cal-3-x dl,.x-calendar-palette .x-cal-3 span{background-color:#107c1e}.x-cal-3-ad,.x-cal-3-ad .ext-cal-evm{border-color:#107c1e}.x-cal-4,.x-cal-4-x .ext-cal-evb,.ext-ie .x-cal-4-ad,.ext-opera .x-cal-4-ad{color:#4a1d7e}.ext-cal-day-col .x-cal-4,.ext-dd-drag-proxy .x-cal-4,.x-cal-4-ad,.x-cal-4-ad .ext-cal-evm,.x-cal-4 .ext-cal-picker-icon,.x-cal-4-x dl,.x-calendar-palette .x-cal-4 span{background-color:#4a1d7e}.x-cal-4-ad,.x-cal-4-ad .ext-cal-evm{border-color:#4a1d7e}.x-cal-5,.x-cal-5-x .ext-cal-evb,.ext-ie .x-cal-5-ad,.ext-opera .x-cal-5-ad{color:#df1a7b}.ext-cal-day-col .x-cal-5,.ext-dd-drag-proxy .x-cal-5,.x-cal-5-ad,.x-cal-5-ad .ext-cal-evm,.x-cal-5 .ext-cal-picker-icon,.x-cal-5-x dl,.x-calendar-palette .x-cal-5 span{background-color:#df1a7b}.x-cal-5-ad,.x-cal-5-ad .ext-cal-evm{border-color:#df1a7b}.x-cal-6,.x-cal-6-x .ext-cal-evb,.ext-ie .x-cal-6-ad,.ext-opera .x-cal-6-ad{color:#ee6c19}.ext-cal-day-col .x-cal-6,.ext-dd-drag-proxy .x-cal-6,.x-cal-6-ad,.x-cal-6-ad .ext-cal-evm,.x-cal-6 .ext-cal-picker-icon,.x-cal-6-x dl,.x-calendar-palette .x-cal-6 span{background-color:#ee6c19}.x-cal-6-ad,.x-cal-6-ad .ext-cal-evm{border-color:#ee6c19}.x-cal-7,.x-cal-7-x .ext-cal-evb,.ext-ie .x-cal-7-ad,.ext-opera .x-cal-7-ad{color:#f9a814}.ext-cal-day-col .x-cal-7,.ext-dd-drag-proxy .x-cal-7,.x-cal-7-ad,.x-cal-7-ad .ext-cal-evm,.x-cal-7 .ext-cal-picker-icon,.x-cal-7-x dl,.x-calendar-palette .x-cal-7 span{background-color:#f9a814}.x-cal-7-ad,.x-cal-7-ad .ext-cal-evm{border-color:#f9a814}.x-cal-8,.x-cal-8-x .ext-cal-evb,.ext-ie .x-cal-8-ad,.ext-opera .x-cal-8-ad{color:#fce205}.ext-cal-day-col .x-cal-8,.ext-dd-drag-proxy .x-cal-8,.x-cal-8-ad,.x-cal-8-ad .ext-cal-evm,.x-cal-8 .ext-cal-picker-icon,.x-cal-8-x dl,.x-calendar-palette .x-cal-8 span{background-color:#fce205}.x-cal-8-ad,.x-cal-8-ad .ext-cal-evm{border-color:#fce205}.x-cal-9,.x-cal-9-x .ext-cal-evb,.ext-ie .x-cal-9-ad,.ext-opera .x-cal-9-ad{color:#848689}.ext-cal-day-col .x-cal-9,.ext-dd-drag-proxy .x-cal-9,.x-cal-9-ad,.x-cal-9-ad .ext-cal-evm,.x-cal-9 .ext-cal-picker-icon,.x-cal-9-x dl,.x-calendar-palette .x-cal-9 span{background-color:#848689}.x-cal-9-ad,.x-cal-9-ad .ext-cal-evm{border-color:#848689}.x-cal-10,.x-cal-10-x .ext-cal-evb,.ext-ie .x-cal-10-ad,.ext-opera .x-cal-10-ad{color:#21a2e0}.ext-cal-day-col .x-cal-10,.ext-dd-drag-proxy .x-cal-10,.x-cal-10-ad,.x-cal-10-ad .ext-cal-evm,.x-cal-10 .ext-cal-picker-icon,.x-cal-10-x dl,.x-calendar-palette .x-cal-10 span{background-color:#21a2e0}.x-cal-10-ad,.x-cal-10-ad .ext-cal-evm{border-color:#21a2e0}.x-cal-11,.x-cal-11-x .ext-cal-evb,.ext-ie .x-cal-11-ad,.ext-opera .x-cal-11-ad{color:#202020}.ext-cal-day-col .x-cal-11,.ext-dd-drag-proxy .x-cal-11,.x-cal-11-ad,.x-cal-11-ad .ext-cal-evm,.x-cal-11 .ext-cal-picker-icon,.x-cal-11-x dl,.x-calendar-palette .x-cal-11 span{background-color:#202020}.x-cal-11-ad,.x-cal-11-ad .ext-cal-evm{border-color:#202020}.x-cal-12,.x-cal-12-x .ext-cal-evb,.ext-ie .x-cal-12-ad,.ext-opera .x-cal-12-ad{color:#7a0f60}.ext-cal-day-col .x-cal-12,.ext-dd-drag-proxy .x-cal-12,.x-cal-12-ad,.x-cal-12-ad .ext-cal-evm,.x-cal-12 .ext-cal-picker-icon,.x-cal-12-x dl,.x-calendar-palette .x-cal-12 span{background-color:#7a0f60}.x-cal-12-ad,.x-cal-12-ad .ext-cal-evm{border-color:#7a0f60}.x-cal-13,.x-cal-13-x .ext-cal-evb,.ext-ie .x-cal-13-ad,.ext-opera .x-cal-13-ad{color:#542382}.ext-cal-day-col .x-cal-13,.ext-dd-drag-proxy .x-cal-13,.x-cal-13-ad,.x-cal-13-ad .ext-cal-evm,.x-cal-13 .ext-cal-picker-icon,.x-cal-13-x dl,.x-calendar-palette .x-cal-13 span{background-color:#542382}.x-cal-13-ad,.x-cal-13-ad .ext-cal-evm{border-color:#542382}.x-cal-14,.x-cal-14-x .ext-cal-evb,.ext-ie .x-cal-14-ad,.ext-opera .x-cal-14-ad{color:#7742a9}.ext-cal-day-col .x-cal-14,.ext-dd-drag-proxy .x-cal-14,.x-cal-14-ad,.x-cal-14-ad .ext-cal-evm,.x-cal-14 .ext-cal-picker-icon,.x-cal-14-x dl,.x-calendar-palette .x-cal-14 span{background-color:#7742a9}.x-cal-14-ad,.x-cal-14-ad .ext-cal-evm{border-color:#7742a9}.x-cal-15,.x-cal-15-x .ext-cal-evb,.ext-ie .x-cal-15-ad,.ext-opera .x-cal-15-ad{color:#8763ca}.ext-cal-day-col .x-cal-15,.ext-dd-drag-proxy .x-cal-15,.x-cal-15-ad,.x-cal-15-ad .ext-cal-evm,.x-cal-15 .ext-cal-picker-icon,.x-cal-15-x dl,.x-calendar-palette .x-cal-15 span{background-color:#8763ca}.x-cal-15-ad,.x-cal-15-ad .ext-cal-evm{border-color:#8763ca}.x-cal-16,.x-cal-16-x .ext-cal-evb,.ext-ie .x-cal-16-ad,.ext-opera .x-cal-16-ad{color:#b586e2}.ext-cal-day-col .x-cal-16,.ext-dd-drag-proxy .x-cal-16,.x-cal-16-ad,.x-cal-16-ad .ext-cal-evm,.x-cal-16 .ext-cal-picker-icon,.x-cal-16-x dl,.x-calendar-palette .x-cal-16 span{background-color:#b586e2}.x-cal-16-ad,.x-cal-16-ad .ext-cal-evm{border-color:#b586e2}.x-cal-17,.x-cal-17-x .ext-cal-evb,.ext-ie .x-cal-17-ad,.ext-opera .x-cal-17-ad{color:#7399f9}.ext-cal-day-col .x-cal-17,.ext-dd-drag-proxy .x-cal-17,.x-cal-17-ad,.x-cal-17-ad .ext-cal-evm,.x-cal-17 .ext-cal-picker-icon,.x-cal-17-x dl,.x-calendar-palette .x-cal-17 span{background-color:#7399f9}.x-cal-17-ad,.x-cal-17-ad .ext-cal-evm{border-color:#7399f9}.x-cal-18,.x-cal-18-x .ext-cal-evb,.ext-ie .x-cal-18-ad,.ext-opera .x-cal-18-ad{color:#4e79e6}.ext-cal-day-col .x-cal-18,.ext-dd-drag-proxy .x-cal-18,.x-cal-18-ad,.x-cal-18-ad .ext-cal-evm,.x-cal-18 .ext-cal-picker-icon,.x-cal-18-x dl,.x-calendar-palette .x-cal-18 span{background-color:#4e79e6}.x-cal-18-ad,.x-cal-18-ad .ext-cal-evm{border-color:#4e79e6}.x-cal-19,.x-cal-19-x .ext-cal-evb,.ext-ie .x-cal-19-ad,.ext-opera .x-cal-19-ad{color:#2951b9}.ext-cal-day-col .x-cal-19,.ext-dd-drag-proxy .x-cal-19,.x-cal-19-ad,.x-cal-19-ad .ext-cal-evm,.x-cal-19 .ext-cal-picker-icon,.x-cal-19-x dl,.x-calendar-palette .x-cal-19 span{background-color:#2951b9}.x-cal-19-ad,.x-cal-19-ad .ext-cal-evm{border-color:#2951b9}.x-cal-20,.x-cal-20-x .ext-cal-evb,.ext-ie .x-cal-20-ad,.ext-opera .x-cal-20-ad{color:#133897}.ext-cal-day-col .x-cal-20,.ext-dd-drag-proxy .x-cal-20,.x-cal-20-ad,.x-cal-20-ad .ext-cal-evm,.x-cal-20 .ext-cal-picker-icon,.x-cal-20-x dl,.x-calendar-palette .x-cal-20 span{background-color:#133897}.x-cal-20-ad,.x-cal-20-ad .ext-cal-evm{border-color:#133897}.x-cal-21,.x-cal-21-x .ext-cal-evb,.ext-ie .x-cal-21-ad,.ext-opera .x-cal-21-ad{color:#1a5173}.ext-cal-day-col .x-cal-21,.ext-dd-drag-proxy .x-cal-21,.x-cal-21-ad,.x-cal-21-ad .ext-cal-evm,.x-cal-21 .ext-cal-picker-icon,.x-cal-21-x dl,.x-calendar-palette .x-cal-21 span{background-color:#1a5173}.x-cal-21-ad,.x-cal-21-ad .ext-cal-evm{border-color:#1a5173}.x-cal-22,.x-cal-22-x .ext-cal-evb,.ext-ie .x-cal-22-ad,.ext-opera .x-cal-22-ad{color:#1a699c}.ext-cal-day-col .x-cal-22,.ext-dd-drag-proxy .x-cal-22,.x-cal-22-ad,.x-cal-22-ad .ext-cal-evm,.x-cal-22 .ext-cal-picker-icon,.x-cal-22-x dl,.x-calendar-palette .x-cal-22 span{background-color:#1a699c}.x-cal-22-ad,.x-cal-22-ad .ext-cal-evm{border-color:#1a699c}.x-cal-23,.x-cal-23-x .ext-cal-evb,.ext-ie .x-cal-23-ad,.ext-opera .x-cal-23-ad{color:#3694b7}.ext-cal-day-col .x-cal-23,.ext-dd-drag-proxy .x-cal-23,.x-cal-23-ad,.x-cal-23-ad .ext-cal-evm,.x-cal-23 .ext-cal-picker-icon,.x-cal-23-x dl,.x-calendar-palette .x-cal-23 span{background-color:#3694b7}.x-cal-23-ad,.x-cal-23-ad .ext-cal-evm{border-color:#3694b7}.x-cal-24,.x-cal-24-x .ext-cal-evb,.ext-ie .x-cal-24-ad,.ext-opera .x-cal-24-ad{color:#64b9d9}.ext-cal-day-col .x-cal-24,.ext-dd-drag-proxy .x-cal-24,.x-cal-24-ad,.x-cal-24-ad .ext-cal-evm,.x-cal-24 .ext-cal-picker-icon,.x-cal-24-x dl,.x-calendar-palette .x-cal-24 span{background-color:#64b9d9}.x-cal-24-ad,.x-cal-24-ad .ext-cal-evm{border-color:#64b9d9}.x-cal-25,.x-cal-25-x .ext-cal-evb,.ext-ie .x-cal-25-ad,.ext-opera .x-cal-25-ad{color:#a8c67b}.ext-cal-day-col .x-cal-25,.ext-dd-drag-proxy .x-cal-25,.x-cal-25-ad,.x-cal-25-ad .ext-cal-evm,.x-cal-25 .ext-cal-picker-icon,.x-cal-25-x dl,.x-calendar-palette .x-cal-25 span{background-color:#a8c67b}.x-cal-25-ad,.x-cal-25-ad .ext-cal-evm{border-color:#a8c67b}.x-cal-26,.x-cal-26-x .ext-cal-evb,.ext-ie .x-cal-26-ad,.ext-opera .x-cal-26-ad{color:#83ad47}.ext-cal-day-col .x-cal-26,.ext-dd-drag-proxy .x-cal-26,.x-cal-26-ad,.x-cal-26-ad .ext-cal-evm,.x-cal-26 .ext-cal-picker-icon,.x-cal-26-x dl,.x-calendar-palette .x-cal-26 span{background-color:#83ad47}.x-cal-26-ad,.x-cal-26-ad .ext-cal-evm{border-color:#83ad47}.x-cal-27,.x-cal-27-x .ext-cal-evb,.ext-ie .x-cal-27-ad,.ext-opera .x-cal-27-ad{color:#2e8f0c}.ext-cal-day-col .x-cal-27,.ext-dd-drag-proxy .x-cal-27,.x-cal-27-ad,.x-cal-27-ad .ext-cal-evm,.x-cal-27 .ext-cal-picker-icon,.x-cal-27-x dl,.x-calendar-palette .x-cal-27 span{background-color:#2e8f0c}.x-cal-27-ad,.x-cal-27-ad .ext-cal-evm{border-color:#2e8f0c}.x-cal-28,.x-cal-28-x .ext-cal-evb,.ext-ie .x-cal-28-ad,.ext-opera .x-cal-28-ad{color:#176413}.ext-cal-day-col .x-cal-28,.ext-dd-drag-proxy .x-cal-28,.x-cal-28-ad,.x-cal-28-ad .ext-cal-evm,.x-cal-28 .ext-cal-picker-icon,.x-cal-28-x dl,.x-calendar-palette .x-cal-28 span{background-color:#176413}.x-cal-28-ad,.x-cal-28-ad .ext-cal-evm{border-color:#176413}.x-cal-29,.x-cal-29-x .ext-cal-evb,.ext-ie .x-cal-29-ad,.ext-opera .x-cal-29-ad{color:#0f4c30}.ext-cal-day-col .x-cal-29,.ext-dd-drag-proxy .x-cal-29,.x-cal-29-ad,.x-cal-29-ad .ext-cal-evm,.x-cal-29 .ext-cal-picker-icon,.x-cal-29-x dl,.x-calendar-palette .x-cal-29 span{background-color:#0f4c30}.x-cal-29-ad,.x-cal-29-ad .ext-cal-evm{border-color:#0f4c30}.x-cal-30,.x-cal-30-x .ext-cal-evb,.ext-ie .x-cal-30-ad,.ext-opera .x-cal-30-ad{color:#386651}.ext-cal-day-col .x-cal-30,.ext-dd-drag-proxy .x-cal-30,.x-cal-30-ad,.x-cal-30-ad .ext-cal-evm,.x-cal-30 .ext-cal-picker-icon,.x-cal-30-x dl,.x-calendar-palette .x-cal-30 span{background-color:#386651}.x-cal-30-ad,.x-cal-30-ad .ext-cal-evm{border-color:#386651}.x-cal-31,.x-cal-31-x .ext-cal-evb,.ext-ie .x-cal-31-ad,.ext-opera .x-cal-31-ad{color:#3ea987}.ext-cal-day-col .x-cal-31,.ext-dd-drag-proxy .x-cal-31,.x-cal-31-ad,.x-cal-31-ad .ext-cal-evm,.x-cal-31 .ext-cal-picker-icon,.x-cal-31-x dl,.x-calendar-palette .x-cal-31 span{background-color:#3ea987}.x-cal-31-ad,.x-cal-31-ad .ext-cal-evm{border-color:#3ea987}.x-cal-32,.x-cal-32-x .ext-cal-evb,.ext-ie .x-cal-32-ad,.ext-opera .x-cal-32-ad{color:#7bc3b5}.ext-cal-day-col .x-cal-32,.ext-dd-drag-proxy .x-cal-32,.x-cal-32-ad,.x-cal-32-ad .ext-cal-evm,.x-cal-32 .ext-cal-picker-icon,.x-cal-32-x dl,.x-calendar-palette .x-cal-32 span{background-color:#7bc3b5}.x-cal-32-ad,.x-cal-32-ad .ext-cal-evm{border-color:#7bc3b5}
    </style>
</head>
<body>
</body>
</html>
